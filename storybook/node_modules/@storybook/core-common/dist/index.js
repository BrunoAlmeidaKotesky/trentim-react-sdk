"use strict";var Ve=Object.create;var w=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Xe=Object.getOwnPropertyNames;var Ze=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty;var er=(e,r)=>{for(var t in r)w(e,t,{get:r[t],enumerable:!0})},te=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Xe(r))!Qe.call(e,n)&&n!==t&&w(e,n,{get:()=>r[n],enumerable:!(o=Ge(r,n))||o.enumerable});return e};var f=(e,r,t)=>(t=e!=null?Ve(Ze(e)):{},te(r||!e||!e.__esModule?w(t,"default",{value:e,enumerable:!0}):t,e)),rr=e=>te(w({},"__esModule",{value:!0}),e);var zr={};er(zr,{boost:()=>O,cache:()=>cr,checkAddonOrder:()=>mr,createFileSystemCache:()=>j,filterPresetsConfig:()=>le,findDistEsm:()=>yr,getAutoRefs:()=>je,getDirectoryFromWorkingDir:()=>Ue,getFrameworkName:()=>V,getInterpretedFile:()=>g,getInterpretedFileWithExt:()=>H,getPresets:()=>be,getPreviewBodyTemplate:()=>Dr,getPreviewHeadTemplate:()=>Lr,getPreviewMainTemplate:()=>Mr,getProjectRoot:()=>pr,getRefs:()=>Or,getRendererName:()=>br,getStorybookConfiguration:()=>G,getStorybookInfo:()=>Pr,globToRegexp:()=>Q,handlebars:()=>Rr,interopRequireDefault:()=>R,interpolate:()=>Er,isPreservingSymlinks:()=>Tr,loadAllPresets:()=>ar,loadCustomPresets:()=>U,loadEnvs:()=>lr,loadMainConfig:()=>$r,loadManagerOrAddonsFile:()=>Sr,loadPreset:()=>ge,loadPreviewOrConfigFile:()=>jr,logConfig:()=>Ar,nodePathsToArray:()=>W,normalizeStories:()=>Ir,normalizeStoriesEntry:()=>ze,normalizeStoryPath:()=>Y,readTemplate:()=>Nr,resolveAddonName:()=>ue,resolvePathInStorybookCache:()=>z,satisfies:()=>Ur,serverRequire:()=>b,serverResolve:()=>E,stringifyEnvs:()=>ur,stringifyProcessEnvs:()=>gr,useProgressReporting:()=>Fr,validateConfigurationFiles:()=>v,validateFrameworkName:()=>Jr});module.exports=rr(zr);var pe=require("ts-dedent"),h=require("@storybook/node-logger"),de=require("path");var $=f(require("path"));var M=f(require("fs")),O=new Set([".js",".jsx",".ts",".tsx",".cjs",".mjs"]);function tr(){return[...Array.from(O)]}var oe=tr();function g(e){return oe.map(r=>e.endsWith(r)?e:`${e}${r}`).find(r=>M.default.existsSync(r))}function H(e){return oe.map(r=>({path:e.endsWith(r)?e:`${e}${r}`,ext:r})).find(r=>M.default.existsSync(r.path))}var ne=!1;function R(e){if(ne===!1){let{register:o}=require("esbuild-register/dist/node");ne=!0,o({target:`node${process.version.slice(1)}`,format:"cjs",hookIgnoreNodeModules:!1,tsconfigRaw:`{
      "compilerOptions": {
        "strict": false,
        "skipLibCheck": true,
      },
    }`})}let r=require(e);return typeof r=="object"&&r!==null&&typeof r.default<"u"?r.default:r}function or(e){for(let r=0;r<e.length;r+=1){let t=H(e[r]);if(t)return t}}function b(e){let r=E(e);return r?R(r):null}function E(e){let r=Array.isArray(e)?e:[e],t=or(r);return t?t.path:null}var se=require("ts-dedent"),ie=f(require("glob")),J=f(require("path"));function v(e){let r=`{${Array.from(O).join(",")}}`;if(!(n=>!!ie.default.sync(J.default.resolve(e,`${n}${r}`)).length)("main"))throw new Error(se.dedent`
      No configuration files have been found in your configDir (${J.default.resolve(e)}).
      Storybook needs either a "main" or "config" file.
    `)}function U({configDir:e}){v(e);let r=b($.default.resolve(e,"presets"));if(b($.default.resolve(e,"main"))){let o=E($.default.resolve(e,"main"));if(o)return[o]}return r||[]}var ae=f(require("resolve-from")),ce=(e,r)=>{try{return(0,ae.default)(e,r)}catch{return}},fe=e=>{try{return require.resolve(e)}catch{return}};var C=e=>e!=null&&typeof e=="object"&&Array.isArray(e)===!1,nr=e=>typeof e=="function";function le(e){return e.filter(r=>{let t=typeof r=="string"?r:r.name;return!/@storybook[\\\\/]preset-typescript/.test(t)})}function me(e,r,t){return nr(e)?[...e({...t,...r})]:Array.isArray(e)?[...e]:[]}var ue=(e,r,t)=>{let o=r.startsWith("/")?fe:ce.bind(null,e),n=o(r);if(n){if(r.match(/\/(manager|register(-panel)?)(\.(js|ts|tsx|jsx))?$/))return{type:"virtual",name:r,managerEntries:[n]};if(r.match(/\/(preset)(\.(js|ts|tsx|jsx))?$/))return{type:"presets",name:n}}let s=n&&o(`${r}/package.json`),p=s&&(0,de.dirname)(s),a=u=>{if(o(`${r}${u}`))return`${p}${u}`},m=r,c=a("/manager"),i=a("/register")||a("/register-panel"),l=a("/preview"),d=o(`${m}/preset`);if(!(c||l)&&d)return{type:"presets",name:d};if(c||i||l||d){let u=[];return c&&u.push(c),!c&&i&&!d&&u.push(i),{type:"virtual",name:m,...u.length?{managerEntries:u}:{},...l?{previewAnnotations:[l]}:{},...d?{presets:[{name:d,options:t}]}:{}}}if(n)return{type:"presets",name:n}},sr=({configDir:e})=>r=>{let t=C(r)&&r.options||void 0,o=C(r)?r.name:r;try{let n=ue(e,o,t);return{...t?{options:t}:{},...n}}catch{h.logger.error(`Addon value should end in /manager or /preview or /register OR it should be a valid preset https://storybook.js.org/docs/react/addons/writing-presets/
${r}`)}};async function ir(e){if(e.type==="virtual"){let{type:t,name:o,...n}=e;return n}let r=e.name?e.name:e;return R(r)}async function ge(e,r,t){try{let o=e.name?e.name:e,n=e.options?e.options:{},s=await ir(e);if(typeof s=="function"&&(s=s(t,n)),Array.isArray(s))return await S(s,r+1,t);if(C(s)){let{addons:p,presets:a,...m}=s,c=me(a,n,t),i=me(p,n,t);return[...await S([...c],r+1,t),...await S([...i.map(sr(t))].filter(Boolean),r+1,t),{name:o,preset:m,options:n}]}throw new Error(pe.dedent`
      ${e} is not a valid preset
    `)}catch(o){let n=r>0?`  Failed to load preset: ${JSON.stringify(e)} on level ${r}`:`  Failed to load preset: ${JSON.stringify(e)}`;return h.logger.warn(n),h.logger.error(o),[]}}async function S(e,r,t){return!e||!Array.isArray(e)||!e.length?[]:(r||h.logger.info("=> Loading presets"),(await Promise.all(e.map(async o=>ge(o,r,t)))).reduce((o,n)=>o.concat(n),[]))}function ye(e,r,t,o,n){let s=new Promise(p=>p(t));return e.length?e.reduce((p,{preset:a,options:m})=>{let c=a[r];if(!c)return p;if(typeof c=="function"){let i=c,l={preset:a,combinedOptions:{...n,...o,...m,presetsList:e,presets:{apply:async(d,u,k={})=>ye(e,d,u,k,n)}}};return p.then(d=>i.call(l.preset,d,l.combinedOptions))}return p.then(i=>Array.isArray(i)&&Array.isArray(c)?[...i,...c]:C(i)&&C(c)?{...i,...c}:c)},s):s}async function be(e,r){let t=await S(e,0,r);return{apply:async(o,n,s={})=>ye(t,o,n,s,r)}}async function ar(e){let{corePresets:r=[],overridePresets:t=[],...o}=e,n=[...r,...U(e),...t],s=le(n);return s.length<n.length&&h.logger.warn("Storybook now supports TypeScript natively. You can safely remove `@storybook/preset-typescript`."),be(s,o)}var he=f(require("file-system-cache"));function j(e){return(0,he.default)(e)}var A=f(require("path")),xe=f(require("pkg-dir"));function z(e){let r=process.cwd(),t=xe.default.sync(r),o;return t?o=A.default.resolve(t,"node_modules/.cache/storybook"):o=A.default.resolve(r,".cache/storybook"),A.default.join(o,e)}var cr=j({basePath:z("dev-server"),ns:"storybook"});var _=require("@storybook/node-logger"),B=e=>r=>{let t=r.name||r;return t&&t.includes(e)},fr=(e,r,t)=>{let o=e.findIndex(B("@storybook/addon-essentials")),n=e.findIndex(B(r.name)),s=e.findIndex(B(t.name));return n===-1&&r.inEssentials&&(n=o),s===-1&&t.inEssentials&&(s=o),n!==-1&&s!==-1&&n<=s},mr=async({before:e,after:r,configFile:t,getConfig:o})=>{try{let n=await o(t);if(!(n!=null&&n.addons)){_.logger.warn("Unable to find 'addons' config in main Storybook config");return}if(!fr(n.addons,e,r)){let s=" (or '@storybook/addon-essentials')",p=`'${e.name}'${e.inEssentials?s:""}`,a=`'${r.name}'${r.inEssentials?s:""}`;_.logger.warn(`Expected ${p} to be listed before ${a} in main Storybook config.`)}}catch{_.logger.warn(`Unable to load config file: ${t}`)}};var ve=require("lazy-universal-dotenv");var P=f(require("path")),q=f(require("find-up")),pr=()=>{let e;try{let r=q.default.sync(".git",{type:"directory"});r&&(e=e||P.default.join(r,".."))}catch{}try{let r=q.default.sync(".svn",{type:"directory"});r&&(e=e||P.default.join(r,".."))}catch{}try{e=e||__dirname.split("node_modules")[0]}catch{}return e||process.cwd()},W=e=>e.split(process.platform==="win32"?";":":").filter(Boolean).map(r=>P.default.resolve("./",r)),dr=/^\.{1,2}([/\\]|$)/;function Y(e){return dr.test(e)?e:`.${P.default.sep}${e}`}function lr(e={}){let r=e.production?"production":"development",t={NODE_ENV:process.env.NODE_ENV||r,NODE_PATH:process.env.NODE_PATH||"",STORYBOOK:process.env.STORYBOOK||"true",PUBLIC_URL:e.production?".":""};Object.keys(process.env).filter(a=>/^STORYBOOK_/.test(a)).forEach(a=>{t[a]=process.env[a]});let o=Object.entries(t).reduce((a,[m,c])=>Object.assign(a,{[m]:JSON.stringify(c)}),{}),{stringified:n,raw:s}=(0,ve.getEnvironment)({nodeEnv:t.NODE_ENV}),p={...t,...s};return p.NODE_PATH=W(p.NODE_PATH||""),{stringified:{...o,...n},raw:p}}var ur=e=>Object.entries(e).reduce((r,[t,o])=>(r[t]=JSON.stringify(o),r),{}),gr=e=>Object.entries(e).reduce((t,[o,n])=>(t[`process.env.${o}`]=JSON.stringify(n),t),{"process.env.XSTORYBOOK_EXAMPLE_APP":'""'});var K=f(require("path")),Ce=require("find-up"),yr=(e,r)=>{let t=(0,Ce.sync)("package.json",{cwd:e});if(!t)throw new Error(`Could not find package.json in: ${e}`);let o=K.default.dirname(t);return K.default.join(o,"dist","esm",r)};var Pe=require("ts-dedent");async function V(e){let r=await e.presets.apply("framework","",e);if(!r)throw new Error(Pe.dedent`
      You must specify a framework in '.storybook/main.js' config.

      https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory
    `);return typeof r=="object"?r.name:r}async function br(e){let{renderer:r}=await e.presets.apply("core",{},e);return r||V(e)}function G(e,r,t){if(!e)return null;let o=e.split(/[\s='"]+/),n=o.indexOf(t);return n===-1&&(n=o.indexOf(r)),n===-1?null:o[n+1]}var Oe=f(require("path")),Re=f(require("fs-extra"));var ke={"@storybook/react":"react","@storybook/vue":"vue","@storybook/vue3":"vue3","@storybook/angular":"angular","@storybook/html":"html","@storybook/web-components":"web-components","@storybook/polymer":"polymer","@storybook/ember":"ember","@storybook/marko":"marko","@storybook/mithril":"mithril","@storybook/riot":"riot","@storybook/svelte":"svelte","@storybook/preact":"preact","@storybook/rax":"rax","@storybook/server":"server"},we=console,hr=({dependencies:e,devDependencies:r,peerDependencies:t},o)=>[Object.entries(e||{}).find(o),Object.entries(r||{}).find(o),Object.entries(t||{}).find(o)],xr=e=>{let[r,t,o]=hr(e,([a])=>ke[a]),[n,s]=r||t||o||[],p=n?ke[n]:void 0;return r&&t&&r[0]===t[0]&&we.warn(`Found "${r[0]}" in both "dependencies" and "devDependencies". This is probably a mistake.`),r&&o&&r[0]===o[0]&&we.warn(`Found "${r[0]}" in both "dependencies" and "peerDependencies". This is probably a mistake.`),{version:s,framework:p,frameworkPackage:n,renderer:p,rendererPackage:n}},vr=["ts","js","tsx","jsx","mjs","cjs"],X=(e,r)=>{let t=Oe.default.join(r,e),o=vr.find(n=>Re.default.existsSync(`${t}.${n}`));return o?`${t}.${o}`:null},Cr=e=>{var o;let r=".storybook",t=(o=e.scripts)==null?void 0:o.storybook;if(t){let n=G(t,"-c","--config-dir");n&&(r=n)}return{configDir:r,mainConfig:X("main",r),previewConfig:X("preview",r),managerConfig:X("manager",r)}},Pr=e=>{let r=xr(e),t=Cr(e);return{...r,...t}};var Z=require("fs-extra"),I=require("path"),Ee=f(require("find-up")),$e=f(require("resolve-from")),Se=require("@storybook/node-logger"),je=async e=>{let r=await(0,Ee.default)("package.json",{cwd:e.configDir});if(!r)return{};let t=(0,I.dirname)(r),{dependencies:o=[],devDependencies:n=[]}=await(0,Z.readJSON)(r)||{},s=Object.keys({...o,...n});return(await Promise.all(s.map(async a=>{try{let m=(0,$e.default)(t,(0,I.join)(a,"package.json")),{storybook:c,name:i,version:l}=await(0,Z.readJSON)(m)||{};if(c!=null&&c.url)return{id:i,...c,version:l}}catch(m){if(m.code==="ERR_PACKAGE_PATH_NOT_EXPORTED")return;Se.logger.warn(`unable to find package.json for ${a}`);return}}))).filter(Boolean).reduce((a,m)=>({...a,[m.id]:{id:m.id.toLowerCase(),url:Ae(m.url),title:m.title,version:m.version}}),{})},kr=e=>fetch(`${e}/iframe.html`).then(async({ok:r,status:t})=>{if(r){if(t!==200)return!1;let o=await fetch(`${e}/iframe.html`,{headers:{Accept:"application/json"}});if(o.ok&&(await o.json().catch(n=>({}))).loginUrl)return!1}return r},()=>!1),Ae=e=>e.replace(/\/$/,""),wr=e=>{let r=e.replace(/[A-Z]/g,t=>` ${t}`).replace(/[-_][A-Z]/gi,t=>` ${t.toUpperCase()}`).replace(/-/g," ").replace(/_/g," ");return`${r.substring(0,1).toUpperCase()}${r.substring(1)}`.trim()};async function Or(e){let r=await e.presets.apply("refs",await je(e));return Object.entries(r).forEach(([t,o])=>{if(o.disable){delete r[t];return}r[t.toLowerCase()]={...o,id:t.toLowerCase(),title:o.title||wr(o.id||t),url:Ae(o.url)}}),await Promise.all(Object.entries(r).map(async([t,o])=>{let n=await kr(o.url);r[t]={...o,type:n?"server-checked":"unknown"}})),r}var _e=require("picomatch");function Q(e){let r=(0,_e.makeRe)(e,{fastpaths:!1,noglobstar:!1,bash:!1});if(!r.source.startsWith("^"))throw new Error(`Invalid glob: >> ${e} >> ${r}`);return e.startsWith("./")?new RegExp(["^\\.",e.startsWith("./**")?"":"[\\\\/]",r.source.substring(1)].join("")):r}var Ie=f(require("handlebars"));function Rr(e,r){return Ie.default.compile(e)(r)}var Er=(e,r)=>Object.entries(r).reduce((t,[o,n])=>{let s=n.replace(/\\/g,"/").replace(/\$/g,"$$$");return t.replace(new RegExp(`{{${o}}}`,"g"),s)},e);var Fe=f(require("path"));function $r({configDir:e}){return v(e),b(Fe.default.resolve(e,"main"))}var F=f(require("path")),Ne=require("@storybook/node-logger"),Te=require("ts-dedent");function Sr({configDir:e}){let r=g(F.default.resolve(e,"addons")),t=g(F.default.resolve(e,"manager"));if((r||t)&&Ne.logger.info("=> Loading custom manager config"),r&&t)throw new Error(Te.dedent`
      You have both a "addons.js" and a "manager.js", remove the "addons.js" file from your configDir (${F.default.resolve(e,"addons")})`);return t||r}var N=f(require("path")),De=require("ts-dedent");function jr({configDir:e}){let r=g(N.default.resolve(e,"config")),t=g(N.default.resolve(e,"preview"));if(r&&t)throw new Error(De.dedent`
      You have both a "config.js" and a "preview.js", remove the "config.js" file from your configDir (${N.default.resolve(e,"config")})`);return t||r}var Le=f(require("chalk"));function Ar(e,r){console.log(Le.default.cyan(e)),console.dir(r,{depth:null})}var He=f(require("fs")),x=f(require("path")),Je=require("picomatch"),ee=f(require("slash"));var T="",Me="**/*.@(mdx|stories.mdx|stories.tsx|stories.ts|stories.jsx|stories.js)",_r=(e,r)=>{try{return He.default.lstatSync(x.default.resolve(e,r)).isDirectory()}catch{return!1}},Ue=({configDir:e,workingDir:r,directory:t})=>{let o=x.default.resolve(e,t),n=x.default.relative(r,o);return Y(n)},ze=(e,{configDir:r,workingDir:t})=>{let o;if(typeof e=="string"){let m=(0,Je.scan)(e);if(m.isGlob){let c=m.prefix+m.base,i=m.glob;o={titlePrefix:T,directory:c,files:i}}else _r(r,e)?o={titlePrefix:T,directory:e,files:Me}:o={titlePrefix:T,directory:x.default.dirname(e),files:x.default.basename(e)}}else o={titlePrefix:T,files:Me,...e};let n=(0,ee.default)(o.files),{directory:s}=o,p=(0,ee.default)(Ue({configDir:r,workingDir:t,directory:s})).replace(/\/$/,""),a=Q(`${p}/${n}`);return{...o,directory:p,importPathMatcher:a}},Ir=(e,r)=>e.map(t=>ze(t,r));var Be=f(require("pretty-hrtime")),qe=e=>(0,Be.default)(process.hrtime(e)).replace(" ms"," milliseconds").replace(" s"," seconds").replace(" m"," minutes");var Fr=async(e,r,t)=>{var m;let o=0,n,s=()=>{};e.get("/progress",(c,i)=>{let l=!1,d=()=>{l=!0,i.end()};i.on("close",d),!(l||i.writableEnded)&&(i.setHeader("Cache-Control","no-cache"),i.setHeader("Content-Type","text/event-stream"),i.setHeader("Connection","keep-alive"),i.flushHeaders(),s=u=>{l||i.writableEnded||(i.write(`data: ${JSON.stringify(u)}

`),i.flush(),u.value===1&&d())})});let p=(c,i,l)=>{o=Math.max(c,o);let d={value:o,message:i.charAt(0).toUpperCase()+i.slice(1)};if(i==="building"){let u=l&&l.match(/(\d+)\/(\d+)/)||[],k=parseInt(u[1],10),L=parseInt(u[2],10);!Number.isNaN(k)&&!Number.isNaN(L)&&(d.modules={complete:k,total:L},n=L)}o===1&&(t.cache&&t.cache.set("modulesCount",n),d.message||(d.message=`Completed in ${qe(r)}.`)),s(d)},a=await((m=t.cache)==null?void 0:m.get("modulesCount").catch(()=>{}))||1e3;return{handler:p,modulesCount:a}};var We=f(require("fs-extra"));async function Nr(e){return We.default.readFile(e,{encoding:"utf8"})}function Tr(){let{NODE_OPTIONS:e,NODE_PRESERVE_SYMLINKS:r}=process.env;return!!r||(e==null?void 0:e.includes("--preserve-symlinks"))}var re=f(require("path")),D=require("pkg-dir"),y=f(require("fs")),Ye=(e,r={})=>Object.entries(r).reduce((t,[o,n])=>t.replace(new RegExp(`%${o}%`,"g"),n),e);function Dr(e,r){let t=y.default.readFileSync(`${(0,D.sync)(__dirname)}/templates/base-preview-body.html`,"utf8"),o=re.default.resolve(e,"preview-body.html"),n=t;return y.default.existsSync(o)&&(n=y.default.readFileSync(o,"utf8")+n),Ye(n,r)}function Lr(e,r){let t=y.default.readFileSync(`${(0,D.sync)(__dirname)}/templates/base-preview-head.html`,"utf8"),o=re.default.resolve(e,"preview-head.html"),n=t;return y.default.existsSync(o)&&(n+=y.default.readFileSync(o,"utf8")),Ye(n,r)}function Mr(){return`${(0,D.sync)(__dirname)}/templates/preview.ejs`}var Ke=require("ts-dedent"),Hr=["@storybook/html","@storybook/preact","@storybook/react","@storybook/server","@storybook/svelte","@storybook/vue","@storybook/vue3","@storybook/web-components"];function Jr(e){if(Hr.includes(e))throw new Error(Ke.dedent`
      Invalid value of ${e} in the 'framework' field of Storybook config.

      Please run 'npx sb@next automigrate'

      See the v7 Migration guide for more information: 
      https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory
      `)}function Ur(){return e=>e}0&&(module.exports={boost,cache,checkAddonOrder,createFileSystemCache,filterPresetsConfig,findDistEsm,getAutoRefs,getDirectoryFromWorkingDir,getFrameworkName,getInterpretedFile,getInterpretedFileWithExt,getPresets,getPreviewBodyTemplate,getPreviewHeadTemplate,getPreviewMainTemplate,getProjectRoot,getRefs,getRendererName,getStorybookConfiguration,getStorybookInfo,globToRegexp,handlebars,interopRequireDefault,interpolate,isPreservingSymlinks,loadAllPresets,loadCustomPresets,loadEnvs,loadMainConfig,loadManagerOrAddonsFile,loadPreset,loadPreviewOrConfigFile,logConfig,nodePathsToArray,normalizeStories,normalizeStoriesEntry,normalizeStoryPath,readTemplate,resolveAddonName,resolvePathInStorybookCache,satisfies,serverRequire,serverResolve,stringifyEnvs,stringifyProcessEnvs,useProgressReporting,validateConfigurationFiles,validateFrameworkName});
