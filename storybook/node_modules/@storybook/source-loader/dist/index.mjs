var G={prettierConfig:{printWidth:100,tabWidth:2,bracketSpacing:!0,trailingComma:"es5",singleQuote:!0},uglyCommentsRegex:[/^eslint-.*/,/^global.*/]},O=G;import D from"prettier/parser-babel";function H(t){try{return D.parsers.babel.parse(t)}catch(r){try{return JSON.stringify(t)}catch{throw r}}}function X(t){return D.parsers.babel.format(t)}var M={parse:H,format:X};import j from"prettier/parser-typescript";function Z(t){try{return j.parsers.typescript.parse(t)}catch(r){try{return JSON.stringify(t)}catch{throw r}}}function tt(t){return j.parsers.typescript.format(t)}var v={parse:Z,format:tt};import A from"prettier/parser-flow";function et(t){return A.parsers.flow.parse(t)}function rt(t){return A.parsers.flow.format(t)}var w={parse:et,format:rt};function nt(t){if(t==="javascript"||/\.jsx?/.test(t)||!t)return M;if(t==="typescript"||/\.tsx?/.test(t))return v;if(t==="flow")return w;throw new Error(`Parser of type "${t}" is not supported`)}var h=nt;import{storyNameFromExport as ft,sanitize as dt}from"@storybook/csf";import mt from"lodash/mapKeys";import{sanitize as ot}from"@storybook/csf";var at="storiesOf";function st(t,r,e,n){let o=t.slice(e,n);r.push(o);let a=t.slice(n);r.push(a)}function d(t){if(t.range&&t.range.length===2&&t.start===void 0&&t.end===void 0){let[r,e]=t.range;t.start=r,t.end=e}return!t.range&&t.start!==void 0&&t.end!==void 0&&(t.range=[t.start,t.end]),t}function it(t,r){let e=null;return r.body.find(n=>{let o=null;return n.type==="VariableDeclaration"?o=n.declarations:n.type==="ExportNamedDeclaration"&&n.declaration?.type==="VariableDeclaration"&&(o=n.declaration.declarations),o&&o.find(a=>a.type==="VariableDeclarator"&&a.id.type==="Identifier"&&a.id.name===t?(e=a.init,!0):!1)}),e}function ct(t,r){if(t.type==="CallExpression"){let{callee:e,arguments:n}=t;if(r.type==="Program"&&e.type==="MemberExpression"&&e.object.type==="Identifier"&&e.property.type==="Identifier"&&e.property.name==="bind"&&(n.length===0||n.length===1&&n[0].type==="ObjectExpression"&&n[0].properties.length===0)){let o=e.object.name,a=it(o,r);if(a)return a}}return t}function F(t,r,e){let n=ct(r,e),o={col:n.loc.start.column,line:n.loc.start.line},a={col:n.loc.end.column,line:n.loc.end.line};return{[t]:{startLoc:o,endLoc:a,startBody:o,endBody:a}}}function P(t,r,e){if(!t.property||!t.property.name||t.property.name!=="add")return{};let n=r.arguments;if(!n||n.length<2)return{};let o=t.object;for(;o.callee&&o.callee.object;)o=o.callee.object;let a=o.callee&&o.callee.name&&e[o.callee.name],s=n[0],i=n[1],l=n[n.length-1];if(s.type!=="Literal"&&s.type!=="StringLiteral")return{};if(s.value&&typeof s.value=="string"){let c=ot(s.value),u;return c&&a&&(u={[c]:a}),{toAdd:{[c]:{startLoc:{col:s.loc.start.column,line:s.loc.start.line},endLoc:{col:l.loc.end.column,line:l.loc.end.line},startBody:{col:i.loc.start.column,line:i.loc.start.line},endBody:{col:i.loc.end.column,line:i.loc.end.line}}},idToFramework:u}}return{}}function T(t,r,e,n){return!t.callee||!t.callee.name||t.callee.name!==at?n:(r.pop(),st(e,r,n,t.end),t.end)}import{isExportStory as N}from"@storybook/csf";import y from"estraverse";function _(t,r){let e=0,n=[r];return y.traverse(t,{fallback:"iteration",enter:o=>{d(o),o.type==="CallExpression"&&(e=T(o,n,r,e))}}),n}function lt(t,r){return t&&t.length===1&&t[0].type==="VariableDeclarator"&&t[0].id&&t[0].id.name&&t[0].init&&["CallExpression","ArrowFunctionExpression","FunctionExpression"].includes(t[0].init.type)&&N(t[0].id.name,r)}function ut(t,r){return t.type==="FunctionDeclaration"&&t.id&&t.id.name&&N(t.id.name,r)}function $(t,r){let e=t&&t.declaration&&t.declaration.properties.find(o=>o.key&&o.key.name===r);if(!e)return;let{type:n}=e.value;switch(n){case"ArrayExpression":return e.value.elements.map(o=>{if(!["StringLiteral","Literal"].includes(o.type))throw new Error(`Unexpected descriptor element: ${o.type}`);return o.value});case"Literal":case"RegExpLiteral":return e.value.value;default:throw new Error(`Unexpected descriptor: ${n}`)}}function pt(t){let r=t&&t.program||t,e=r&&r.body&&r.body.find(a=>a.type==="ExportDefaultDeclaration"&&a.declaration.type==="ObjectExpression"&&(a.declaration.properties||[]).length),n=$(e,"includeStories"),o=$(e,"excludeStories");return{includeStories:n,excludeStories:o}}function k(t,r){let e=[],n=0,o=pt(t);return y.traverse(t,{fallback:"iteration",enter:a=>{d(a);let s=a.type==="ExportNamedDeclaration"&&a.declaration,i=s&&lt(a.declaration.declarations,o);if(s&&ut(a.declaration,o)||i){let c=i?a.declaration.declarations[0].init:a.declaration;e.push({source:r.substring(n,c.start-1)}),e.push({source:r.substring(c.start,c.end),declaration:{isVariableDeclaration:i,ident:i?a.declaration.declarations[0].id.name:c.id.name}}),n=c.end}}}),r.length>n+1&&e.push({source:r.substring(n+1)}),e.length===1?[r]:e}function C(t,r){let e={};return y.traverse(t,{fallback:"iteration",enter:(n,o)=>{if(d(n),n.type==="MemberExpression"){let{toAdd:a,idToFramework:s}=P(n,o,r);Object.assign(e,a)}}}),e}function I(t){let r={};return y.traverse(t,{fallback:"iteration",enter:(e,n)=>{d(e);let o=e.type==="ExportNamedDeclaration"&&e.declaration,a=o&&e.declaration.declarations&&e.declaration.declarations.length===1&&e.declaration.declarations[0].type==="VariableDeclarator"&&e.declaration.declarations[0].id&&e.declaration.declarations[0].id.name&&e.declaration.declarations[0].init&&["CallExpression","ArrowFunctionExpression","FunctionExpression"].includes(e.declaration.declarations[0].init.type);if(o&&e.declaration.type==="FunctionDeclaration"&&e.declaration.id&&e.declaration.id.name||a){let i=a?e.declaration.declarations[0]:e.declaration,l=F(i.id.name,i.init||i,n);Object.assign(r,l)}}}),r}function L(t,r){let e=t,n="",o=-1,a=!1;return y.traverse(r,{fallback:"iteration",enter:s=>{d(s);let i=s.type==="ExportDefaultDeclaration",l=s.declaration?.type==="ObjectExpression",c=s.declaration?.type==="TSAsExpression",u=l?s.declaration:s.declaration?.expression;if(i&&(l||c)&&(u.properties||[]).length){let p=u.properties.find(m=>m.key.name==="parameters"&&m.value.type==="ObjectExpression");a=!!p,a?d(p.value):d(u),e=p?t.substring(0,p.value.start)+t.substring(p.value.end+1):e,n=p?t.substring(p.value.start,p.value.end):"{}",o=p?p.value.start:u.start+1}}}),{splicedSource:e,parametersSliceOfCode:n,indexWhereToAppend:o,foundParametersProperty:a}}function R(t,r){let{startBody:e,endBody:n}=t;if(e.line===n.line&&r[e.line-1]!==void 0)return r[e.line-1].substring(e.col,n.col);let o=r[e.line-1],a=r[n.line-1];return o===void 0||a===void 0?null:[o.substring(e.col),...r.slice(e.line,n.line-1),a.substring(0,n.col)].join(`
`)}function E(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function xt(t,r){return r.some(e=>e.test(t))}function yt(t,{comments:r,uglyCommentsRegex:e}){let n=0,o=[t];return r.filter(a=>xt(a.value.trim(),e)).map(d).forEach(a=>{o.pop();let s=t.slice(n,a.start),i=t.slice(a.end);o.push(s,i),n=a.end}),o.join("")}function gt(t,{prettierConfig:r,parser:e,filepath:n}){let o=r,a=null;e==="flow"&&(a="flow"),(e==="javascript"||/jsx?/.test(e))&&(a="javascript"),(e==="typescript"||/tsx?/.test(e))&&(a="typescript"),o.parser?n?o={...r,filepath:n}:o={...r}:o={...r};try{return h(a||"javascript").format(t,o)}catch{return t}}var St=".addParameters({ storySource: { source: __STORY__, locationsMap: __LOCATIONS_MAP__ } })",bt=t=>t.declaration.isVariableDeclaration?` ${t.source};`:` const ${t.declaration.ident} = ${t.source};`;function V(t,r){let{comments:e=[]}=r,n=_(r,t);if(n.length>1){let s=n.join(St);return{storyOfTokenFound:!0,changed:n.length>1,source:s,comments:e}}let o=k(r,t),a=o.map((s,i)=>i%2===0?s.source:bt(s)).join("");return{exportTokenFound:!0,changed:o.length>1,source:a,comments:e}}function W(t,r){let{comments:e=[]}=r;return{changed:!0,source:t,comments:e}}function ht(t,r){return C(t,r)}function B(t,r){let e=ht(t,r);return Object.keys(e).length>0?e:I(t)||e}function J({source:t,...r}){let e=t;return e=yt(e,r),e=gt(e,r),e}function Et(t){if(!t?.locationsMap)return t;let r=mt(t.locationsMap,(e,n)=>dt(ft(n)));return{...t,locationsMap:r}}function U(t,r,e){let{splicedSource:n,parametersSliceOfCode:o,indexWhereToAppend:a,foundParametersProperty:s}=L(t,r);if(a!==-1){let i=JSON.stringify({storySource:Et(e)}).slice(0,-1),l=s?"":"parameters: ",c=s?"":",",u=`${l}${i},${o.substring(1)}${c}`,p=c===","?"":",";return`${n.substring(0,a)}${u}${p}${n.substring(a)}`}return t}function Ot(t,r){let e=E(r);return`${t}.parameters = { storySource: { source: ${e} }, ...${t}.parameters };`}function Y(t,r,e){if(!e||!e.source||!e.locationsMap)return t;let{source:n,locationsMap:o}=e,a=n.split(`
`),s=Object.entries(o).reduce((i,[l,c])=>{let u=R(c,a);if(u){let p=Ot(l,u);return`${i}
${p}`}return i},"");return s?`${t}

${s}`:t}function Dt(t,r,e,n){return{...O,...n,source:t,comments:r,filepath:e}}function Mt(t,r,e={},n=o=>{}){let{injectDecorator:o=!0,injectStoryParameters:a=!1}=e,s=["md","txt","json"].includes(e.parser),i=null;try{i=h(e.parser||r)}catch(b){n(new Error(`(not fatal, only impacting storysource) Could not load a parser (${b})`))}if(s||!i)return{source:t,storySource:{},addsMap:{},changed:!1};let l=i.parse(t),{changed:c,source:u,comments:p,exportTokenFound:m}=o===!0?V(t,l):W(t,l),x=J(Dt(t,p,r,e)),q=i.parse(x),g=B(q,[]),S=u;if(m){let b=i.parse(u);a?S=Y(u,b,{source:x,locationsMap:g}):S=U(u,b,{source:x,locationsMap:g})}return!c&&Object.keys(g||{}).length===0?{source:S,storySource:x,addsMap:{},changed:c}:{source:S,storySource:x,addsMap:g,changed:c}}var z=Mt;function jt(t,r,e){let n=t.getOptions(),o=z(r,t.resourcePath,{...n,parser:n.parser||t.extension},t.emitWarning.bind(t)),a=E(o.storySource||r),s=o.addsMap||{},i=e?o.source:r;return new Promise(l=>l({source:i,sourceJson:a,addsMap:s}))}function K(t,r){return jt(t,r,!0)}async function Q(t){let r=await K(this,t);if(!r.source||r.source.length===0)return t;let{source:e,sourceJson:n,addsMap:o}=r;return`${`
    /* eslint-disable */
    // @ts-nocheck
    // @ts-expect-error (Converted from ts-ignore)
    var __STORY__ = ${n};
    // @ts-expect-error (Converted from ts-ignore)
    var __LOCATIONS_MAP__ = ${JSON.stringify(o)};
    `}
${e}`}var ce=Q;export{ce as default,R as extractSource};
