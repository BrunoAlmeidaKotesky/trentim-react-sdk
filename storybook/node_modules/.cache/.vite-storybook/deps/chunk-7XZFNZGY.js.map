{
  "version": 3,
  "sources": ["../../../@storybook/channel-postmessage/dist/index.mjs"],
  "sourcesContent": ["import g from\"global\";import*as A from\"@storybook/core-events\";import{Channel as L}from\"@storybook/channels\";import{logger as b,pretty as v}from\"@storybook/client-logger\";import{isJSON as H,parse as I,stringify as W}from\"telejson\";import x from\"qs\";var{window:n,document:l,location:d}=g,y=\"storybook-channel\",N={allowFunction:!0,maxDepth:25},h=class{constructor(r){this.config=r;if(this.buffer=[],this.handler=null,n&&n.addEventListener(\"message\",this.handleEvent.bind(this),!1),r.page!==\"manager\"&&r.page!==\"preview\")throw new Error(`postmsg-channel: \"config.page\" cannot be \"${r.page}\"`)}setHandler(r){this.handler=(...e)=>{r.apply(this,e),!this.connected&&this.getLocalFrame().length&&(this.flush(),this.connected=!0)}}send(r,e){let{target:o,allowRegExp:t,allowFunction:a,allowSymbol:s,allowDate:i,allowUndefined:f,allowClass:w,maxDepth:E,space:C,lazyEval:F}=e||{},k=Object.fromEntries(Object.entries({allowRegExp:t,allowFunction:a,allowSymbol:s,allowDate:i,allowUndefined:f,allowClass:w,maxDepth:E,space:C,lazyEval:F}).filter(([p,u])=>typeof u<\"u\")),$={...N,...g.CHANNEL_OPTIONS||{},...k},m=this.getFrames(o),S=x.parse(d.search,{ignoreQueryPrefix:!0}),O=W({key:y,event:r,refId:S.refId},$);return m.length?(this.buffer.length&&this.flush(),m.forEach(p=>{try{p.postMessage(O,\"*\")}catch{console.error(\"sending over postmessage fail\")}}),Promise.resolve(null)):new Promise((p,u)=>{this.buffer.push({event:r,resolve:p,reject:u})})}flush(){let{buffer:r}=this;this.buffer=[],r.forEach(e=>{this.send(e.event).then(e.resolve).catch(e.reject)})}getFrames(r){if(this.config.page===\"manager\"){let o=[...l.querySelectorAll(\"iframe[data-is-storybook][data-is-loaded]\")].filter(t=>{try{return!!t.contentWindow&&t.dataset.isStorybook!==void 0&&t.id===r}catch{return!1}}).map(t=>t.contentWindow);return o.length?o:this.getCurrentFrames()}return n&&n.parent&&n.parent!==n?[n.parent]:[]}getCurrentFrames(){return this.config.page===\"manager\"?[...l.querySelectorAll('[data-is-storybook=\"true\"]')].map(e=>e.contentWindow):n&&n.parent?[n.parent]:[]}getLocalFrame(){return this.config.page===\"manager\"?[...l.querySelectorAll(\"#storybook-preview-iframe\")].map(e=>e.contentWindow):n&&n.parent?[n.parent]:[]}handleEvent(r){try{let{data:e}=r,{key:o,event:t,refId:a}=typeof e==\"string\"&&H(e)?I(e,g.CHANNEL_OPTIONS||{}):e;if(o===y){let s=this.config.page===\"manager\"?'<span style=\"color: #37D5D3; background: black\"> manager </span>':'<span style=\"color: #1EA7FD; background: black\"> preview </span>',i=Object.values(A).includes(t.type)?`<span style=\"color: #FF4785\">${t.type}</span>`:`<span style=\"color: #FFAE00\">${t.type}</span>`;if(a&&(t.refId=a),t.source=this.config.page===\"preview\"?r.origin:q(r),!t.source){v.error(`${s} received ${i} but was unable to determine the source of the event`);return}let f=`${s} received ${i} (${e.length})`;v.debug(d.origin!==t.source?f:`${f} <span style=\"color: gray\">(on ${d.origin} from ${t.source})</span>`,...t.args),this.handler(t)}}catch(e){b.error(e)}}},q=c=>{let r=[...l.querySelectorAll(\"iframe[data-is-storybook]\")],[e,...o]=r.filter(t=>{try{return t.contentWindow===c.source}catch{}let a=t.getAttribute(\"src\"),s;try{({origin:s}=new URL(a,l.location))}catch{return!1}return s===c.origin});if(e&&o.length===0){let t=e.getAttribute(\"src\"),{protocol:a,host:s,pathname:i}=new URL(t,l.location);return`${a}//${s}${i}`}return o.length>0&&b.error(\"found multiple candidates for event source\"),null};function D({page:c}){let r=new h({page:c});return new L({transport:r})}var B=D;export{y as KEY,h as PostmsgTransport,D as createChannel,B as default};\n"],
  "mappings": "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",
  "names": ["g", "r", "o", "i", "x"]
}
