"use strict";var _e=Object.create;var L=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Oe=(o,e)=>{for(var r in e)L(o,r,{get:e[r],enumerable:!0})},J=(o,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Me(e))!ve.call(o,n)&&n!==r&&L(o,n,{get:()=>e[n],enumerable:!(t=Ie(e,n))||t.enumerable});return o};var w=(o,e,r)=>(r=o!=null?_e(De(o)):{},J(e||!o||!o.__esModule?L(r,"default",{value:o,enumerable:!0}):r,o)),Le=o=>J(L({},"__esModule",{value:!0}),o);var Xe={};Oe(Xe,{DocsContext:()=>E,Preview:()=>C,PreviewWeb:()=>U,composeConfigs:()=>Ce.composeConfigs,simulateDOMContentLoaded:()=>Y,simulatePageLoad:()=>xe});module.exports=Le(Xe);var Ce=require("@storybook/store");var z=require("ts-dedent"),x=w(require("global")),H=require("synchronous-promise"),h=require("@storybook/core-events"),I=require("@storybook/client-logger"),j=require("@storybook/addons"),te=require("@storybook/store");var V=w(require("global")),re=require("@storybook/client-logger"),g=require("@storybook/core-events");var f=new Error("prepareAborted");var{AbortController:ee}=V.default;function je(o){try{let{name:e="Error",message:r=String(o),stack:t}=o;return{name:e,message:r,stack:t}}catch{return{name:"Error",message:String(o)}}}var F=class{constructor(e,r,t,n,s,a,d={autoplay:!0},c){this.channel=e;this.store=r;this.renderToScreen=t;this.callbacks=n;this.id=s;this.viewMode=a;this.renderOptions=d;this.type="story";this.notYetRendered=!0;this.disableKeyListeners=!1;this.teardownRender=()=>{};this.torndown=!1;this.abortController=new ee,c&&(this.story=c,this.phase="preparing")}async runPhase(e,r,t){this.phase=r,this.channel.emit(g.STORY_RENDER_PHASE_CHANGED,{newPhase:this.phase,storyId:this.id}),t&&await t(),e.aborted&&(this.phase="aborted",this.channel.emit(g.STORY_RENDER_PHASE_CHANGED,{newPhase:this.phase,storyId:this.id}))}async prepare(){if(await this.runPhase(this.abortController.signal,"preparing",async()=>{this.story=await this.store.loadStory({storyId:this.id})}),this.abortController.signal.aborted)throw this.store.cleanupStory(this.story),f}isEqual(e){return!!(this.id===e.id&&this.story&&this.story===e.story)}isPreparing(){return["preparing"].includes(this.phase)}isPending(){return["rendering","playing"].includes(this.phase)}async renderToElement(e){return this.canvasElement=e,this.render({initial:!0,forceRemount:!0})}storyContext(){if(!this.story)throw new Error("Cannot call storyContext before preparing");return this.store.getStoryContext(this.story)}async render({initial:e=!1,forceRemount:r=!1}={}){let{canvasElement:t}=this;if(!this.story)throw new Error("cannot render when not prepared");if(!t)throw new Error("cannot render when canvasElement is unset");let{id:n,componentId:s,title:a,name:d,tags:c,applyLoaders:l,unboundStoryFn:O,playFunction:m}=this.story;r&&!e&&(this.cancelRender(),this.abortController=new ee);let y=this.abortController.signal;try{let R;if(await this.runPhase(y,"loading",async()=>{R=await l({...this.storyContext(),viewMode:this.viewMode})}),y.aborted)return;let k={...R,...this.storyContext(),abortSignal:y,canvasElement:t},_={componentId:s,title:a,kind:a,id:n,name:d,story:d,tags:c,...this.callbacks,showError:S=>(this.phase="errored",this.callbacks.showError(S)),showException:S=>(this.phase="errored",this.callbacks.showException(S)),forceRemount:r||this.notYetRendered,storyContext:k,storyFn:()=>O(k),unboundStoryFn:O};if(await this.runPhase(y,"rendering",async()=>{let S=await this.renderToScreen(_,t);this.teardownRender=S||(()=>{})}),this.notYetRendered=!1,y.aborted)return;if(this.renderOptions.autoplay&&r&&m&&this.phase!=="errored"){this.disableKeyListeners=!0;try{await this.runPhase(y,"playing",async()=>{await m(_.storyContext)}),await this.runPhase(y,"played")}catch(S){if(re.logger.error(S),await this.runPhase(y,"errored",async()=>{this.channel.emit(g.PLAY_FUNCTION_THREW_EXCEPTION,je(S))}),this.story.parameters.throwPlayFunctionExceptions!==!1)throw S}if(this.disableKeyListeners=!1,y.aborted)return}await this.runPhase(y,"completed",async()=>this.channel.emit(g.STORY_RENDERED,n))}catch(R){this.phase="errored",this.callbacks.showException(R)}}async rerender(){return this.render()}async remount(){return this.render({forceRemount:!0})}cancelRender(){var e;(e=this.abortController)==null||e.abort()}async teardown(){this.torndown=!0,this.cancelRender(),this.story&&this.store.cleanupStory(this.story);for(let e=0;e<3;e+=1){if(!this.isPending()){await this.teardownRender();return}await new Promise(r=>setTimeout(r,0))}V.default.window.location.reload(),await new Promise(()=>{})}};var{fetch:Ne}=x.default,Ge="./index.json",C=class{constructor(e=j.addons.getChannel()){this.channel=e;this.storyRenders=[];var r;((r=x.default.FEATURES)==null?void 0:r.storyStoreV7)&&j.addons.hasServerChannel()&&(this.serverChannel=j.addons.getServerChannel()),this.storyStore=new te.StoryStore}initialize({getStoryIndex:e,importFn:r,getProjectAnnotations:t}){return this.getStoryIndex=e,this.importFn=r,this.setupListeners(),this.getProjectAnnotationsOrRenderError(t).then(n=>this.initializeWithProjectAnnotations(n))}setupListeners(){var e;(e=this.serverChannel)==null||e.on(h.STORY_INDEX_INVALIDATED,this.onStoryIndexChanged.bind(this)),this.channel.on(h.UPDATE_GLOBALS,this.onUpdateGlobals.bind(this)),this.channel.on(h.UPDATE_STORY_ARGS,this.onUpdateArgs.bind(this)),this.channel.on(h.RESET_STORY_ARGS,this.onResetArgs.bind(this)),this.channel.on(h.FORCE_RE_RENDER,this.onForceReRender.bind(this)),this.channel.on(h.FORCE_REMOUNT,this.onForceRemount.bind(this))}getProjectAnnotationsOrRenderError(e){return H.SynchronousPromise.resolve().then(e).then(r=>{if(this.renderToDOM=r.renderToDOM,!this.renderToDOM)throw new Error(z.dedent`
            Expected your framework's preset to export a \`renderToDOM\` field.

            Perhaps it needs to be upgraded for Storybook 6.4?

            More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#mainjs-framework-field
          `);return r}).catch(r=>{throw this.renderPreviewEntryError("Error reading preview.js:",r),r})}initializeWithProjectAnnotations(e){var t;this.storyStore.setProjectAnnotations(e),this.setInitialGlobals();let r;if((t=x.default.FEATURES)!=null&&t.storyStoreV7)r=this.getStoryIndexFromServer();else{if(!this.getStoryIndex)throw new Error("No `getStoryIndex` passed defined in v6 mode");r=H.SynchronousPromise.resolve().then(this.getStoryIndex)}return r.then(n=>this.initializeWithStoryIndex(n)).catch(n=>{throw this.renderPreviewEntryError("Error loading story index:",n),n})}async setInitialGlobals(){this.emitGlobals()}emitGlobals(){if(!this.storyStore.globals||!this.storyStore.projectAnnotations)throw new Error("Cannot emit before initialization");this.channel.emit(h.SET_GLOBALS,{globals:this.storyStore.globals.get()||{},globalTypes:this.storyStore.projectAnnotations.globalTypes||{}})}async getStoryIndexFromServer(){let e=await Ne(Ge);if(e.status===200)return e.json();throw new Error(await e.text())}initializeWithStoryIndex(e){var r;if(!this.importFn)throw new Error("Cannot call initializeWithStoryIndex before initialization");return this.storyStore.initialize({storyIndex:e,importFn:this.importFn,cache:!((r=x.default.FEATURES)!=null&&r.storyStoreV7)})}async onGetProjectAnnotationsChanged({getProjectAnnotations:e}){delete this.previewEntryError;let r=await this.getProjectAnnotationsOrRenderError(e);if(!this.storyStore.projectAnnotations){await this.initializeWithProjectAnnotations(r);return}await this.storyStore.setProjectAnnotations(r),this.emitGlobals()}async onStoryIndexChanged(){if(delete this.previewEntryError,!!this.storyStore.projectAnnotations)try{let e=await this.getStoryIndexFromServer();this.storyStore.storyIndex||await this.initializeWithStoryIndex(e),await this.onStoriesChanged({storyIndex:e})}catch(e){throw this.renderPreviewEntryError("Error loading story index:",e),e}}async onStoriesChanged({importFn:e,storyIndex:r}){await this.storyStore.onStoriesChanged({importFn:e,storyIndex:r})}async onUpdateGlobals({globals:e}){if(!this.storyStore.globals)throw new Error("Cannot call onUpdateGlobals before initialization");this.storyStore.globals.update(e),await Promise.all(this.storyRenders.map(r=>r.rerender())),this.channel.emit(h.GLOBALS_UPDATED,{globals:this.storyStore.globals.get(),initialGlobals:this.storyStore.globals.initialGlobals})}async onUpdateArgs({storyId:e,updatedArgs:r}){this.storyStore.args.update(e,r),await Promise.all(this.storyRenders.filter(t=>t.id===e).map(t=>t.rerender())),this.channel.emit(h.STORY_ARGS_UPDATED,{storyId:e,args:this.storyStore.args.get(e)})}async onResetArgs({storyId:e,argNames:r}){let t=this.storyRenders.find(d=>d.id===e),n=(t==null?void 0:t.story)||await this.storyStore.loadStory({storyId:e}),a=(r||[...new Set([...Object.keys(n.initialArgs),...Object.keys(this.storyStore.args.get(e))])]).reduce((d,c)=>(d[c]=n.initialArgs[c],d),{});await this.onUpdateArgs({storyId:e,updatedArgs:a})}async onForceReRender(){await Promise.all(this.storyRenders.map(e=>e.rerender()))}async onForceRemount({storyId:e}){await Promise.all(this.storyRenders.filter(r=>r.id===e).map(r=>r.remount()))}renderStoryToElement(e,r,t){if(!this.renderToDOM)throw new Error("Cannot call renderStoryToElement before initialization");let n=new F(this.channel,this.storyStore,this.renderToDOM,this.inlineStoryCallbacks(e.id),e.id,"docs",t,e);return n.renderToElement(r),this.storyRenders.push(n),async()=>{await this.teardownRender(n)}}async teardownRender(e,{viewModeChanged:r}={}){var t;this.storyRenders=this.storyRenders.filter(n=>n!==e),await((t=e==null?void 0:e.teardown)==null?void 0:t.call(e,{viewModeChanged:r}))}async extract(e){var r;if(this.previewEntryError)throw this.previewEntryError;if(!this.storyStore.projectAnnotations)throw new Error(z.dedent`Failed to initialize Storybook.

      Do you have an error in your \`preview.js\`? Check your Storybook's browser console for errors.`);return(r=x.default.FEATURES)!=null&&r.storyStoreV7&&await this.storyStore.cacheAllCSFFiles(),this.storyStore.extract(e)}inlineStoryCallbacks(e){return{showMain:()=>{},showError:r=>I.logger.error(`Error rendering docs story (${e})`,r),showException:r=>I.logger.error(`Error rendering docs story (${e})`,r)}}renderPreviewEntryError(e,r){this.previewEntryError=r,I.logger.error(e),I.logger.error(r),this.channel.emit(h.CONFIG_ERROR,r)}};var $=require("ts-dedent"),A=w(require("global")),i=require("@storybook/core-events"),T=require("@storybook/client-logger");var ce=w(require("global")),N=w(require("qs"));var ne=w(require("qs")),se=require("ts-dedent"),ie=require("@storybook/client-logger"),ae=w(require("lodash/isPlainObject")),oe=/^[a-zA-Z0-9 _-]*$/,de=/^-?[0-9]+(\.[0-9]+)?$/,We=/^#([a-f0-9]{3,4}|[a-f0-9]{6}|[a-f0-9]{8})$/i,le=/^(rgba?|hsla?)\(([0-9]{1,3}),\s?([0-9]{1,3})%?,\s?([0-9]{1,3})%?,?\s?([0-9](\.[0-9]{1,2})?)?\)$/i,B=(o="",e)=>o===null||o===""||!oe.test(o)?!1:e==null||e instanceof Date||typeof e=="number"||typeof e=="boolean"?!0:typeof e=="string"?oe.test(e)||de.test(e)||We.test(e)||le.test(e):Array.isArray(e)?e.every(r=>B(o,r)):(0,ae.default)(e)?Object.entries(e).every(([r,t])=>B(r,t)):!1,$e={delimiter:";",allowDots:!0,allowSparse:!0,decoder(o,e,r,t){if(t==="value"&&o.startsWith("!")){if(o==="!undefined")return;if(o==="!null")return null;if(o.startsWith("!date(")&&o.endsWith(")"))return new Date(o.slice(6,-1));if(o.startsWith("!hex(")&&o.endsWith(")"))return`#${o.slice(5,-1)}`;let n=o.slice(1).match(le);if(n)return o.startsWith("!rgba")?`${n[1]}(${n[2]}, ${n[3]}, ${n[4]}, ${n[5]})`:o.startsWith("!hsla")?`${n[1]}(${n[2]}, ${n[3]}%, ${n[4]}%, ${n[5]})`:o.startsWith("!rgb")?`${n[1]}(${n[2]}, ${n[3]}, ${n[4]})`:`${n[1]}(${n[2]}, ${n[3]}%, ${n[4]}%)`}return t==="value"&&de.test(o)?Number(o):e(o,e,r)}},q=o=>{let e=o.split(";").map(r=>r.replace("=","~").replace(":","="));return Object.entries(ne.default.parse(e.join(";"),$e)).reduce((r,[t,n])=>B(t,n)?Object.assign(r,{[t]:n}):(ie.once.warn(se.dedent`
      Omitted potentially unsafe URL args.

      More info: https://storybook.js.org/docs/react/writing-stories/args#setting-args-through-the-url
    `),r),{})};var{history:he,document:b}=ce.default;function Ue(o){let e=(o||"").match(/^\/story\/(.+)/);if(!e)throw new Error(`Invalid path '${o}',  must start with '/story/'`);return e[1]}var ye=({selection:o,extraParams:e})=>{let{search:r=""}=b.location,{path:t,selectedKind:n,selectedStory:s,...a}=N.default.parse(r,{ignoreQueryPrefix:!0});return N.default.stringify({...a,...e,...o&&{id:o.storyId,viewMode:o.viewMode}},{encode:!1,addQueryPrefix:!0})},Ye=o=>{if(!o)return;let e=ye({selection:o}),{hash:r=""}=b.location;b.title=o.storyId,he.replaceState({},"",`${b.location.pathname}${e}${r}`)},Ve=o=>o!=null&&typeof o=="object"&&Array.isArray(o)===!1,M=o=>{if(o!==void 0){if(typeof o=="string")return o;if(Array.isArray(o))return M(o[0]);if(Ve(o))return M(Object.values(o).filter(Boolean))}},ze=()=>{let o=N.default.parse(b.location.search,{ignoreQueryPrefix:!0}),e=typeof o.args=="string"?q(o.args):void 0,r=typeof o.globals=="string"?q(o.globals):void 0,t=M(o.viewMode);(typeof t!="string"||!t.match(/docs|story/))&&(t="story");let n=M(o.path),s=n?Ue(n):M(o.id);return s?{storySpecifier:s,args:e,globals:r,viewMode:t}:null},G=class{constructor(){this.selectionSpecifier=ze()}setSelection(e){this.selection=e,Ye(this.selection)}setQueryParams(e){let r=ye({extraParams:e}),{hash:t=""}=b.location;he.replaceState({},"",`${b.location.pathname}${r}${t}`)}};var Se=w(require("global")),we=require("@storybook/client-logger"),ue=w(require("ansi-to-html")),fe=require("ts-dedent"),Ee=w(require("qs")),{document:p}=Se.default,pe=100,K={centered:"sb-main-centered",fullscreen:"sb-main-fullscreen",padded:"sb-main-padded"},Re=(s=>(s.MAIN="MAIN",s.NOPREVIEW="NOPREVIEW",s.PREPARING_STORY="PREPARING_STORY",s.PREPARING_DOCS="PREPARING_DOCS",s.ERROR="ERROR",s))(Re||{}),Q={PREPARING_STORY:"sb-show-preparing-story",PREPARING_DOCS:"sb-show-preparing-docs",MAIN:"sb-show-main",NOPREVIEW:"sb-show-nopreview",ERROR:"sb-show-errordisplay"},me=new ue.default({escapeXML:!0}),W=class{constructor(){this.testing=!1;let{__SPECIAL_TEST_PARAMETER__:e}=Ee.default.parse(p.location.search,{ignoreQueryPrefix:!0});switch(e){case"preparing-story":{this.showPreparingStory(),this.testing=!0;break}case"preparing-docs":{this.showPreparingDocs(),this.testing=!0;break}default:}}prepareForStory(e){return this.showStory(),this.applyLayout(e.parameters.layout),p.documentElement.scrollTop=0,p.documentElement.scrollLeft=0,this.storyRoot()}storyRoot(){return p.getElementById("storybook-root")}prepareForDocs(){return this.showMain(),this.showDocs(),this.applyLayout("fullscreen"),this.docsRoot()}docsRoot(){return p.getElementById("storybook-docs")}applyLayout(e="padded"){if(e==="none"){p.body.classList.remove(this.currentLayoutClass),this.currentLayoutClass=null;return}this.checkIfLayoutExists(e);let r=K[e];p.body.classList.remove(this.currentLayoutClass),p.body.classList.add(r),this.currentLayoutClass=r}checkIfLayoutExists(e){K[e]||we.logger.warn(fe.dedent`The desired layout: ${e} is not a valid option.
         The possible options are: ${Object.keys(K).join(", ")}, none.`)}showMode(e){clearTimeout(this.preparingTimeout),Object.keys(Re).forEach(r=>{r===e?p.body.classList.add(Q[r]):p.body.classList.remove(Q[r])})}showErrorDisplay({message:e="",stack:r=""}){let t=e,n=r,s=e.split(`
`);s.length>1&&([t]=s,n=s.slice(1).join(`
`)),p.getElementById("error-message").innerHTML=me.toHtml(t),p.getElementById("error-stack").innerHTML=me.toHtml(n),this.showMode("ERROR")}showNoPreview(){var e,r;this.testing||(this.showMode("NOPREVIEW"),(e=this.storyRoot())==null||e.setAttribute("hidden","true"),(r=this.docsRoot())==null||r.setAttribute("hidden","true"))}showPreparingStory({immediate:e=!1}={}){clearTimeout(this.preparingTimeout),e?this.showMode("PREPARING_STORY"):this.preparingTimeout=setTimeout(()=>this.showMode("PREPARING_STORY"),pe)}showPreparingDocs(){clearTimeout(this.preparingTimeout),this.preparingTimeout=setTimeout(()=>this.showMode("PREPARING_DOCS"),pe)}showMain(){this.showMode("MAIN")}showDocs(){this.storyRoot().setAttribute("hidden","true"),this.docsRoot().removeAttribute("hidden")}showStory(){this.docsRoot().setAttribute("hidden","true"),this.storyRoot().removeAttribute("hidden")}showStoryDuringRender(){p.body.classList.add(Q.MAIN)}};var ge=require("@storybook/core-events");var E=class{constructor(e,r,t,n,s=!0){this.channel=e;this.store=r;this.renderStoryToElement=t;this.storyIdByName=e=>{let r=this.nameToStoryId.get(e);if(r)return r;throw new Error(`No story found with that name: ${e}`)};this.componentStories=()=>this.componentStoriesValue;this.storyById=e=>{if(!e){if(!this.primaryStory)throw new Error("No primary story defined for docs entry. Did you forget to use `<Meta>`?");return this.primaryStory}let r=this.storyIdToCSFFile.get(e);if(!r)throw new Error(`Called \`storyById\` for story that was never loaded: ${e}`);return this.store.storyFromCSFFile({storyId:e,csfFile:r})};this.getStoryContext=e=>({...this.store.getStoryContext(e),viewMode:"docs"});this.loadStory=e=>this.store.loadStory({storyId:e});this.storyIdToCSFFile=new Map,this.exportToStoryId=new Map,this.nameToStoryId=new Map,this.componentStoriesValue=[],n.forEach((a,d)=>{this.referenceCSFFile(a,s||d===0)})}referenceCSFFile(e,r){Object.values(e.stories).forEach(t=>{if(this.storyIdToCSFFile.set(t.id,e),this.exportToStoryId.set(t.moduleExport,t.id),r){this.nameToStoryId.set(t.name,t.id);let n=this.storyById(t.id);this.componentStoriesValue.push(n),this.primaryStory||(this.primaryStory=n)}})}setMeta(e){}storyIdByModuleExport(e,r){let t=this.exportToStoryId.get(e);if(t)return t;throw new Error(`No story found with that export: ${e}`)}};var D=class{constructor(e,r,t){this.channel=e;this.store=r;this.entry=t;this.type="docs";this.torndown=!1;this.disableKeyListeners=!1;this.preparing=!1;this.id=t.id}isPreparing(){return this.preparing}async prepare(){this.preparing=!0;let{entryExports:e,csfFiles:r=[]}=await this.store.loadEntry(this.id);if(this.torndown)throw f;let{importPath:t,title:n}=this.entry,s=this.store.processCSFFileWithCache(e,t,n),a=Object.keys(s.stories)[0];this.story=this.store.storyFromCSFFile({storyId:a,csfFile:s}),this.csfFiles=[s,...r],this.preparing=!1}isEqual(e){return!!(this.id===e.id&&this.story&&this.story===e.story)}async renderToElement(e,r){if(!this.story||!this.csfFiles)throw new Error("Cannot render docs before preparing");let t=new E(this.channel,this.store,r,this.csfFiles,!0),{docs:n}=this.story.parameters||{};if(!n)throw new Error("Cannot render a story in viewMode=docs if `@storybook/addon-docs` is not installed");let s=await n.renderer(),{render:a}=s,d=async()=>{await new Promise(c=>a(t,n,e,c)),this.channel.emit(ge.DOCS_RENDERED,this.id)};return this.rerender=async()=>d(),this.teardownRender=async({viewModeChanged:c})=>{!c||!e||s.unmount(e)},d()}async teardown({viewModeChanged:e}={}){var r;(r=this.teardownRender)==null||r.call(this,{viewModeChanged:e}),this.torndown=!0}};var be=require("@storybook/core-events");var v=class{constructor(e,r,t){this.channel=e;this.store=r;this.entry=t;this.type="docs";this.torndown=!1;this.disableKeyListeners=!1;this.preparing=!1;this.id=t.id}isPreparing(){return this.preparing}async prepare(){this.preparing=!0;let{entryExports:e,csfFiles:r=[]}=await this.store.loadEntry(this.id);if(this.torndown)throw f;this.csfFiles=r,this.exports=e,this.preparing=!1}isEqual(e){return!!(this.id===e.id&&this.exports&&this.exports===e.exports)}async renderToElement(e,r){if(!this.exports||!this.csfFiles||!this.store.projectAnnotations)throw new Error("Cannot render docs before preparing");let t=new E(this.channel,this.store,r,this.csfFiles,!1),{docs:n}=this.store.projectAnnotations.parameters||{};if(!n)throw new Error("Cannot render a story in viewMode=docs if `@storybook/addon-docs` is not installed");let s={...n,page:this.exports.default},a=await n.renderer(),{render:d}=a,c=async()=>{await new Promise(l=>d(t,s,e,l)),this.channel.emit(be.DOCS_RENDERED,this.id)};return this.rerender=async()=>c(),this.teardownRender=async({viewModeChanged:l}={})=>{!l||!e||(a.unmount(e),this.torndown=!0)},c()}async teardown({viewModeChanged:e}={}){var r;(r=this.teardownRender)==null||r.call(this,{viewModeChanged:e}),this.torndown=!0}};var{window:He}=A.default;function Be(o){let e=o.target;return/input|textarea/i.test(e.tagName)||e.getAttribute("contenteditable")!==null}function X(o){return o.type==="story"}var U=class extends C{constructor(){super();this.view=new W,this.urlStore=new G}setupListeners(){super.setupListeners(),He.onkeydown=this.onKeydown.bind(this),this.channel.on(i.SET_CURRENT_STORY,this.onSetCurrentStory.bind(this)),this.channel.on(i.UPDATE_QUERY_PARAMS,this.onUpdateQueryParams.bind(this)),this.channel.on(i.PRELOAD_ENTRIES,this.onPreloadStories.bind(this))}initializeWithProjectAnnotations(r){return super.initializeWithProjectAnnotations(r).then(()=>this.setInitialGlobals())}async setInitialGlobals(){if(!this.storyStore.globals)throw new Error("Cannot call setInitialGlobals before initialization");let{globals:r}=this.urlStore.selectionSpecifier||{};r&&this.storyStore.globals.updateFromPersisted(r),this.emitGlobals()}initializeWithStoryIndex(r){return super.initializeWithStoryIndex(r).then(()=>{var t;return(t=A.default.FEATURES)!=null&&t.storyStoreV7||this.channel.emit(i.SET_INDEX,this.storyStore.getSetIndexPayload()),this.selectSpecifiedStory()})}async selectSpecifiedStory(){if(!this.storyStore.storyIndex)throw new Error("Cannot call selectSpecifiedStory before initialization");if(!this.urlStore.selectionSpecifier){this.renderMissingStory();return}let{storySpecifier:r,args:t}=this.urlStore.selectionSpecifier,n=this.storyStore.storyIndex.entryFromSpecifier(r);if(!n){r==="*"?this.renderStoryLoadingException(r,new Error($.dedent`
            Couldn't find any stories in your Storybook.
            - Please check your stories field of your main.js config.
            - Also check the browser console and terminal for error messages.
          `)):this.renderStoryLoadingException(r,new Error($.dedent`
            Couldn't find story matching '${r}'.
            - Are you sure a story with that id exists?
            - Please check your stories field of your main.js config.
            - Also check the browser console and terminal for error messages.
          `));return}let{id:s,type:a}=n;this.urlStore.setSelection({storyId:s,viewMode:a}),this.channel.emit(i.STORY_SPECIFIED,this.urlStore.selection),this.channel.emit(i.CURRENT_STORY_WAS_SET,this.urlStore.selection),await this.renderSelection({persistedArgs:t})}async onGetProjectAnnotationsChanged({getProjectAnnotations:r}){await super.onGetProjectAnnotationsChanged({getProjectAnnotations:r}),this.urlStore.selection&&this.renderSelection()}async onStoriesChanged({importFn:r,storyIndex:t}){var n;await super.onStoriesChanged({importFn:r,storyIndex:t}),(n=A.default.FEATURES)!=null&&n.storyStoreV7||this.channel.emit(i.SET_INDEX,await this.storyStore.getSetIndexPayload()),this.urlStore.selection?await this.renderSelection():await this.selectSpecifiedStory()}onKeydown(r){if(!this.storyRenders.find(t=>t.disableKeyListeners)&&!Be(r)){let{altKey:t,ctrlKey:n,metaKey:s,shiftKey:a,key:d,code:c,keyCode:l}=r;this.channel.emit(i.PREVIEW_KEYDOWN,{event:{altKey:t,ctrlKey:n,metaKey:s,shiftKey:a,key:d,code:c,keyCode:l}})}}async onSetCurrentStory(r){await this.storyStore.initializationPromise,this.urlStore.setSelection({viewMode:"story",...r}),this.channel.emit(i.CURRENT_STORY_WAS_SET,this.urlStore.selection),this.renderSelection()}onUpdateQueryParams(r){this.urlStore.setQueryParams(r)}async onUpdateGlobals({globals:r}){var t,n;super.onUpdateGlobals({globals:r}),(this.currentRender instanceof v||this.currentRender instanceof D)&&await((n=(t=this.currentRender).rerender)==null?void 0:n.call(t))}async onUpdateArgs({storyId:r,updatedArgs:t}){super.onUpdateArgs({storyId:r,updatedArgs:t})}async onPreloadStories({ids:r}){await Promise.allSettled(r.map(t=>this.storyStore.loadEntry(t)))}async renderSelection({persistedArgs:r}={}){var R,k,_,S;let{renderToDOM:t}=this;if(!t)throw new Error("Cannot call renderSelection before initialization");let{selection:n}=this.urlStore;if(!n)throw new Error("Cannot call renderSelection as no selection was made");let{storyId:s}=n,a;try{a=await this.storyStore.storyIdToEntry(s)}catch(u){this.currentRender&&await this.teardownRender(this.currentRender),this.renderStoryLoadingException(s,u);return}let d=((R=this.currentSelection)==null?void 0:R.storyId)!==s,c=((k=this.currentRender)==null?void 0:k.type)!==a.type;a.type==="story"?this.view.showPreparingStory({immediate:c}):this.view.showPreparingDocs(),(_=this.currentRender)!=null&&_.isPreparing()&&await this.teardownRender(this.currentRender);let l;a.type==="story"?l=new F(this.channel,this.storyStore,(...u)=>(this.view.showStoryDuringRender(),t(...u)),this.mainStoryCallbacks(s),s,"story"):a.standalone?l=new v(this.channel,this.storyStore,a):l=new D(this.channel,this.storyStore,a);let O=this.currentSelection;this.currentSelection=n;let m=this.currentRender;this.currentRender=l;try{await l.prepare()}catch(u){u!==f&&(m&&await this.teardownRender(m),this.renderStoryLoadingException(s,u));return}let y=!d&&m&&!l.isEqual(m);if(r&&X(l)){if(!l.story)throw new Error("Render has not been prepared!");this.storyStore.args.updateFromPersisted(l.story,r)}if(m&&!m.torndown&&!d&&!y&&!c){this.currentRender=m,this.channel.emit(i.STORY_UNCHANGED,s),this.view.showMain();return}if(m&&await this.teardownRender(m,{viewModeChanged:c}),O&&(d||c)&&this.channel.emit(i.STORY_CHANGED,s),X(l)){if(!l.story)throw new Error("Render has not been prepared!");let{parameters:u,initialArgs:Ae,argTypes:ke,args:Z}=this.storyStore.getStoryContext(l.story);(S=A.default.FEATURES)!=null&&S.storyStoreV7&&this.channel.emit(i.STORY_PREPARED,{id:s,parameters:u,initialArgs:Ae,argTypes:ke,args:Z}),(y||r)&&this.channel.emit(i.STORY_ARGS_UPDATED,{storyId:s,args:Z})}if(X(l)){if(!l.story)throw new Error("Render has not been prepared!");this.storyRenders.push(l),this.currentRender.renderToElement(this.view.prepareForStory(l.story))}else this.currentRender.renderToElement(this.view.prepareForDocs(),this.renderStoryToElement.bind(this))}async teardownRender(r,{viewModeChanged:t=!1}={}){var n;this.storyRenders=this.storyRenders.filter(s=>s!==r),await((n=r==null?void 0:r.teardown)==null?void 0:n.call(r,{viewModeChanged:t}))}async extract(r){var t;if(this.previewEntryError)throw this.previewEntryError;if(!this.storyStore.projectAnnotations)throw new Error($.dedent`Failed to initialize Storybook.

      Do you have an error in your \`preview.js\`? Check your Storybook's browser console for errors.`);return(t=A.default.FEATURES)!=null&&t.storyStoreV7&&await this.storyStore.cacheAllCSFFiles(),this.storyStore.extract(r)}mainStoryCallbacks(r){return{showMain:()=>this.view.showMain(),showError:t=>this.renderError(r,t),showException:t=>this.renderException(r,t)}}inlineStoryCallbacks(r){return{showMain:()=>{},showError:t=>T.logger.error(`Error rendering docs story (${r})`,t),showException:t=>T.logger.error(`Error rendering docs story (${r})`,t)}}renderPreviewEntryError(r,t){super.renderPreviewEntryError(r,t),this.view.showErrorDisplay(t)}renderMissingStory(){this.view.showNoPreview(),this.channel.emit(i.STORY_MISSING)}renderStoryLoadingException(r,t){T.logger.error(t),this.view.showErrorDisplay(t),this.channel.emit(i.STORY_MISSING,r)}renderException(r,t){var d;let{name:n="Error",message:s=String(t),stack:a}=t;this.channel.emit(i.STORY_THREW_EXCEPTION,{name:n,message:s,stack:a}),this.channel.emit(i.STORY_RENDER_PHASE_CHANGED,{newPhase:"errored",storyId:r}),(d=t.message)!=null&&d.startsWith("ignoredException")||(this.view.showErrorDisplay(t),T.logger.error(`Error rendering story '${r}':`),T.logger.error(t))}renderError(r,{title:t,description:n}){T.logger.error(`Error rendering story ${t}: ${n}`),this.channel.emit(i.STORY_ERRORED,{title:t,description:n}),this.channel.emit(i.STORY_RENDER_PHASE_CHANGED,{newPhase:"errored",storyId:r}),this.view.showErrorDisplay({message:t,stack:n})}};var Pe=w(require("global")),{document:P}=Pe.default,qe=["application/javascript","application/ecmascript","application/x-ecmascript","application/x-javascript","text/ecmascript","text/javascript","text/javascript1.0","text/javascript1.1","text/javascript1.2","text/javascript1.3","text/javascript1.4","text/javascript1.5","text/jscript","text/livescript","text/x-ecmascript","text/x-javascript","module"],Ke="script",Te="scripts-root";function Y(){let o=P.createEvent("Event");o.initEvent("DOMContentLoaded",!0,!0),P.dispatchEvent(o)}function Qe(o,e,r){let t=P.createElement("script");t.type=o.type==="module"?"module":"text/javascript",o.src?(t.onload=e,t.onerror=e,t.src=o.src):t.textContent=o.innerText,r?r.appendChild(t):P.head.appendChild(t),o.parentNode.removeChild(o),o.src||e()}function Fe(o,e,r=0){o[r](()=>{r++,r===o.length?e():Fe(o,e,r)})}function xe(o){let e=P.getElementById(Te);e?e.innerHTML="":(e=P.createElement("div"),e.id=Te,P.body.appendChild(e));let r=Array.from(o.querySelectorAll(Ke));if(r.length){let t=[];r.forEach(n=>{let s=n.getAttribute("type");(!s||qe.includes(s))&&t.push(a=>Qe(n,a,e))}),t.length&&Fe(t,Y,void 0)}else Y()}0&&(module.exports={DocsContext,Preview,PreviewWeb,composeConfigs,simulateDOMContentLoaded,simulatePageLoad});
