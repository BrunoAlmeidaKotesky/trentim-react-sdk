var et=Object.create;var E=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,at=Object.prototype.hasOwnProperty;var it=(t,r)=>{for(var e in r)E(t,e,{get:r[e],enumerable:!0})},P=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of nt(r))!at.call(t,o)&&o!==e&&E(t,o,{get:()=>r[o],enumerable:!(n=rt(r,o))||n.enumerable});return t};var S=(t,r,e)=>(e=t!=null?et(ot(t)):{},P(r||!t||!t.__esModule?E(e,"default",{value:t,enumerable:!0}):e,t)),st=t=>P(E({},"__esModule",{value:!0}),t);var kt={};it(kt,{default:()=>_t,extractSource:()=>w});module.exports=st(kt);var ct={prettierConfig:{printWidth:100,tabWidth:2,bracketSpacing:!0,trailingComma:"es5",singleQuote:!0},uglyCommentsRegex:[/^eslint-.*/,/^global.*/]},T=ct;var M=S(require("prettier/parser-babel"));function lt(t){try{return M.default.parsers.babel.parse(t)}catch(r){try{return JSON.stringify(t)}catch{throw r}}}function ut(t){return M.default.parsers.babel.format(t)}var $={parse:lt,format:ut};var j=S(require("prettier/parser-typescript"));function pt(t){try{return j.default.parsers.typescript.parse(t)}catch(r){try{return JSON.stringify(t)}catch{throw r}}}function ft(t){return j.default.parsers.typescript.format(t)}var N={parse:pt,format:ft};var v=S(require("prettier/parser-flow"));function dt(t){return v.default.parsers.flow.parse(t)}function mt(t){return v.default.parsers.flow.format(t)}var _={parse:dt,format:mt};function xt(t){if(t==="javascript"||/\.jsx?/.test(t)||!t)return $;if(t==="typescript"||/\.tsx?/.test(t))return N;if(t==="flow")return _;throw new Error(`Parser of type "${t}" is not supported`)}var O=xt;var D=require("@storybook/csf"),Y=S(require("lodash/mapKeys"));var k=require("@storybook/csf"),yt="storiesOf";function gt(t,r,e,n){let o=t.slice(e,n);r.push(o);let a=t.slice(n);r.push(a)}function f(t){if(t.range&&t.range.length===2&&t.start===void 0&&t.end===void 0){let[r,e]=t.range;t.start=r,t.end=e}return!t.range&&t.start!==void 0&&t.end!==void 0&&(t.range=[t.start,t.end]),t}function St(t,r){let e=null;return r.body.find(n=>{var a;let o=null;return n.type==="VariableDeclaration"?o=n.declarations:n.type==="ExportNamedDeclaration"&&((a=n.declaration)==null?void 0:a.type)==="VariableDeclaration"&&(o=n.declaration.declarations),o&&o.find(i=>i.type==="VariableDeclarator"&&i.id.type==="Identifier"&&i.id.name===t?(e=i.init,!0):!1)}),e}function bt(t,r){if(t.type==="CallExpression"){let{callee:e,arguments:n}=t;if(r.type==="Program"&&e.type==="MemberExpression"&&e.object.type==="Identifier"&&e.property.type==="Identifier"&&e.property.name==="bind"&&(n.length===0||n.length===1&&n[0].type==="ObjectExpression"&&n[0].properties.length===0)){let o=e.object.name,a=St(o,r);if(a)return a}}return t}function C(t,r,e){let n=bt(r,e),o={col:n.loc.start.column,line:n.loc.start.line},a={col:n.loc.end.column,line:n.loc.end.line};return{[t]:{startLoc:o,endLoc:a,startBody:o,endBody:a}}}function I(t,r,e){if(!t.property||!t.property.name||t.property.name!=="add")return{};let n=r.arguments;if(!n||n.length<2)return{};let o=t.object;for(;o.callee&&o.callee.object;)o=o.callee.object;let a=o.callee&&o.callee.name&&e[o.callee.name],i=n[0],s=n[1],l=n[n.length-1];if(i.type!=="Literal"&&i.type!=="StringLiteral")return{};if(i.value&&typeof i.value=="string"){let c=(0,k.sanitize)(i.value),u;return c&&a&&(u={[c]:a}),{toAdd:{[c]:{startLoc:{col:i.loc.start.column,line:i.loc.start.line},endLoc:{col:l.loc.end.column,line:l.loc.end.line},startBody:{col:s.loc.start.column,line:s.loc.start.line},endBody:{col:s.loc.end.column,line:s.loc.end.line}}},idToFramework:u}}return{}}function L(t,r,e,n){return!t.callee||!t.callee.name||t.callee.name!==yt?n:(r.pop(),gt(e,r,n,t.end),t.end)}var A=require("@storybook/csf"),y=S(require("estraverse"));function V(t,r){let e=0,n=[r];return y.default.traverse(t,{fallback:"iteration",enter:o=>{f(o),o.type==="CallExpression"&&(e=L(o,n,r,e))}}),n}function ht(t,r){return t&&t.length===1&&t[0].type==="VariableDeclarator"&&t[0].id&&t[0].id.name&&t[0].init&&["CallExpression","ArrowFunctionExpression","FunctionExpression"].includes(t[0].init.type)&&(0,A.isExportStory)(t[0].id.name,r)}function Et(t,r){return t.type==="FunctionDeclaration"&&t.id&&t.id.name&&(0,A.isExportStory)(t.id.name,r)}function R(t,r){let e=t&&t.declaration&&t.declaration.properties.find(o=>o.key&&o.key.name===r);if(!e)return;let{type:n}=e.value;switch(n){case"ArrayExpression":return e.value.elements.map(o=>{if(!["StringLiteral","Literal"].includes(o.type))throw new Error(`Unexpected descriptor element: ${o.type}`);return o.value});case"Literal":case"RegExpLiteral":return e.value.value;default:throw new Error(`Unexpected descriptor: ${n}`)}}function Ot(t){let r=t&&t.program||t,e=r&&r.body&&r.body.find(a=>a.type==="ExportDefaultDeclaration"&&a.declaration.type==="ObjectExpression"&&(a.declaration.properties||[]).length),n=R(e,"includeStories"),o=R(e,"excludeStories");return{includeStories:n,excludeStories:o}}function W(t,r){let e=[],n=0,o=Ot(t);return y.default.traverse(t,{fallback:"iteration",enter:a=>{f(a);let i=a.type==="ExportNamedDeclaration"&&a.declaration,s=i&&ht(a.declaration.declarations,o);if(i&&Et(a.declaration,o)||s){let c=s?a.declaration.declarations[0].init:a.declaration;e.push({source:r.substring(n,c.start-1)}),e.push({source:r.substring(c.start,c.end),declaration:{isVariableDeclaration:s,ident:s?a.declaration.declarations[0].id.name:c.id.name}}),n=c.end}}}),r.length>n+1&&e.push({source:r.substring(n+1)}),e.length===1?[r]:e}function B(t,r){let e={};return y.default.traverse(t,{fallback:"iteration",enter:(n,o)=>{if(f(n),n.type==="MemberExpression"){let{toAdd:a,idToFramework:i}=I(n,o,r);Object.assign(e,a)}}}),e}function J(t){let r={};return y.default.traverse(t,{fallback:"iteration",enter:(e,n)=>{f(e);let o=e.type==="ExportNamedDeclaration"&&e.declaration,a=o&&e.declaration.declarations&&e.declaration.declarations.length===1&&e.declaration.declarations[0].type==="VariableDeclarator"&&e.declaration.declarations[0].id&&e.declaration.declarations[0].id.name&&e.declaration.declarations[0].init&&["CallExpression","ArrowFunctionExpression","FunctionExpression"].includes(e.declaration.declarations[0].init.type);if(o&&e.declaration.type==="FunctionDeclaration"&&e.declaration.id&&e.declaration.id.name||a){let s=a?e.declaration.declarations[0]:e.declaration,l=C(s.id.name,s.init||s,n);Object.assign(r,l)}}}),r}function U(t,r){let e=t,n="",o=-1,a=!1;return y.default.traverse(r,{fallback:"iteration",enter:i=>{var d,g,m;f(i);let s=i.type==="ExportDefaultDeclaration",l=((d=i.declaration)==null?void 0:d.type)==="ObjectExpression",c=((g=i.declaration)==null?void 0:g.type)==="TSAsExpression",u=l?i.declaration:(m=i.declaration)==null?void 0:m.expression;if(s&&(l||c)&&(u.properties||[]).length){let p=u.properties.find(x=>x.key.name==="parameters"&&x.value.type==="ObjectExpression");a=!!p,a?f(p.value):f(u),e=p?t.substring(0,p.value.start)+t.substring(p.value.end+1):e,n=p?t.substring(p.value.start,p.value.end):"{}",o=p?p.value.start:u.start+1}}}),{splicedSource:e,parametersSliceOfCode:n,indexWhereToAppend:o,foundParametersProperty:a}}function w(t,r){let{startBody:e,endBody:n}=t;if(e.line===n.line&&r[e.line-1]!==void 0)return r[e.line-1].substring(e.col,n.col);let o=r[e.line-1],a=r[n.line-1];return o===void 0||a===void 0?null:[o.substring(e.col),...r.slice(e.line,n.line-1),a.substring(0,n.col)].join(`
`)}function F(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function Dt(t,r){return r.some(e=>e.test(t))}function Mt(t,{comments:r,uglyCommentsRegex:e}){let n=0,o=[t];return r.filter(a=>Dt(a.value.trim(),e)).map(f).forEach(a=>{o.pop();let i=t.slice(n,a.start),s=t.slice(a.end);o.push(i,s),n=a.end}),o.join("")}function jt(t,{prettierConfig:r,parser:e,filepath:n}){let o=r,a=null;e==="flow"&&(a="flow"),(e==="javascript"||/jsx?/.test(e))&&(a="javascript"),(e==="typescript"||/tsx?/.test(e))&&(a="typescript"),o.parser?n?o={...r,filepath:n}:o={...r}:o={...r};try{return O(a||"javascript").format(t,o)}catch{return t}}var vt=".addParameters({ storySource: { source: __STORY__, locationsMap: __LOCATIONS_MAP__ } })",At=t=>t.declaration.isVariableDeclaration?` ${t.source};`:` const ${t.declaration.ident} = ${t.source};`;function z(t,r){let{comments:e=[]}=r,n=V(r,t);if(n.length>1){let i=n.join(vt);return{storyOfTokenFound:!0,changed:n.length>1,source:i,comments:e}}let o=W(r,t),a=o.map((i,s)=>s%2===0?i.source:At(i)).join("");return{exportTokenFound:!0,changed:o.length>1,source:a,comments:e}}function K(t,r){let{comments:e=[]}=r;return{changed:!0,source:t,comments:e}}function wt(t,r){return B(t,r)}function Q(t,r){let e=wt(t,r);return Object.keys(e).length>0?e:J(t)||e}function q({source:t,...r}){let e=t;return e=Mt(e,r),e=jt(e,r),e}function Ft(t){if(!(t!=null&&t.locationsMap))return t;let r=(0,Y.default)(t.locationsMap,(e,n)=>(0,D.sanitize)((0,D.storyNameFromExport)(n)));return{...t,locationsMap:r}}function G(t,r,e){let{splicedSource:n,parametersSliceOfCode:o,indexWhereToAppend:a,foundParametersProperty:i}=U(t,r);if(a!==-1){let s=JSON.stringify({storySource:Ft(e)}).slice(0,-1),l=i?"":"parameters: ",c=i?"":",",u=`${l}${s},${o.substring(1)}${c}`,d=c===","?"":",";return`${n.substring(0,a)}${u}${d}${n.substring(a)}`}return t}function Pt(t,r){let e=F(r);return`${t}.parameters = { storySource: { source: ${e} }, ...${t}.parameters };`}function H(t,r,e){if(!e||!e.source||!e.locationsMap)return t;let{source:n,locationsMap:o}=e,a=n.split(`
`),i=Object.entries(o).reduce((s,[l,c])=>{let u=w(c,a);if(u){let d=Pt(l,u);return`${s}
${d}`}return s},"");return i?`${t}

${i}`:t}function Tt(t,r,e,n){return{...T,...n,source:t,comments:r,filepath:e}}function $t(t,r,e={},n=o=>{}){let{injectDecorator:o=!0,injectStoryParameters:a=!1}=e,i=["md","txt","json"].includes(e.parser),s=null;try{s=O(e.parser||r)}catch(h){n(new Error(`(not fatal, only impacting storysource) Could not load a parser (${h})`))}if(i||!s)return{source:t,storySource:{},addsMap:{},changed:!1};let l=s.parse(t),{changed:c,source:u,comments:d,exportTokenFound:g}=o===!0?z(t,l):K(t,l),m=q(Tt(t,d,r,e)),p=s.parse(m),x=Q(p,[]),b=u;if(g){let h=s.parse(u);a?b=H(u,h,{source:m,locationsMap:x}):b=G(u,h,{source:m,locationsMap:x})}return!c&&Object.keys(x||{}).length===0?{source:b,storySource:m,addsMap:{},changed:c}:{source:b,storySource:m,addsMap:x,changed:c}}var X=$t;function Nt(t,r,e){let n=t.getOptions(),o=X(r,t.resourcePath,{...n,parser:n.parser||t.extension},t.emitWarning.bind(t)),a=F(o.storySource||r),i=o.addsMap||{},s=e?o.source:r;return new Promise(l=>l({source:s,sourceJson:a,addsMap:i}))}function Z(t,r){return Nt(t,r,!0)}async function tt(t){let r=await Z(this,t);if(!r.source||r.source.length===0)return t;let{source:e,sourceJson:n,addsMap:o}=r;return`${`
    /* eslint-disable */
    // @ts-nocheck
    // @ts-expect-error (Converted from ts-ignore)
    var __STORY__ = ${n};
    // @ts-expect-error (Converted from ts-ignore)
    var __LOCATIONS_MAP__ = ${JSON.stringify(o)};
    `}
${e}`}var _t=tt;0&&(module.exports={extractSource});
