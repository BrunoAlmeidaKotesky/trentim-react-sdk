var jo=Object.freeze,Ro=Object.defineProperty;var M=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(o,t)=>(typeof require!="undefined"?require:o)[t]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var Lr=(e,o)=>{for(var t in o)Ro(e,t,{get:o[t],enumerable:!0})};var Do=(e,o)=>jo(Ro(e,"raw",{value:jo(o||e.slice())}));var p={};import k from"commander";import Fi from"path";import Ye from"chalk";import $i from"envinfo";import Ji from"leven";import{sync as Ii}from"read-pkg-up";import{logger as _}from"@storybook/node-logger";import he from"chalk";import yo from"prompts";import{telemetry as Ks}from"@storybook/telemetry";import{withTelemetry as Hs}from"@storybook/core-server";import{minVersion as qe,validRange as Xe}from"semver";function Te(e,o){return Xe(e)&&qe(e).major<o}function Wr(e,o){return Xe(e)&&qe(e).major>o}function He(e,o){return Xe(e)&&qe(e).major===o}var Ao=["react","react-native","vue","vue3","angular","mithril","riot","ember","marionette","marko","preact","svelte","rax","aurelia"],je=(b=>(b.UNDETECTED="UNDETECTED",b.UNSUPPORTED="UNSUPPORTED",b.REACT_SCRIPTS="REACT_SCRIPTS",b.REACT="REACT",b.REACT_NATIVE="REACT_NATIVE",b.REACT_PROJECT="REACT_PROJECT",b.WEBPACK_REACT="WEBPACK_REACT",b.NEXTJS="NEXTJS",b.VUE="VUE",b.VUE3="VUE3",b.SFC_VUE="SFC_VUE",b.ANGULAR="ANGULAR",b.EMBER="EMBER",b.ALREADY_HAS_STORYBOOK="ALREADY_HAS_STORYBOOK",b.WEB_COMPONENTS="WEB_COMPONENTS",b.MITHRIL="MITHRIL",b.MARIONETTE="MARIONETTE",b.MARKO="MARKO",b.HTML="HTML",b.RIOT="RIOT",b.PREACT="PREACT",b.SVELTE="SVELTE",b.RAX="RAX",b.AURELIA="AURELIA",b.SERVER="SERVER",b))(je||{});var Eo=[{preset:"SFC_VUE",dependencies:{"vue-loader":e=>Te(e,16),vuetify:e=>Te(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"VUE",dependencies:{vue:e=>Te(e,3),nuxt:e=>Te(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"VUE3",dependencies:{vue:e=>e==="next"||He(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"EMBER",dependencies:["ember-cli"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"NEXTJS",dependencies:{next:e=>He(e,9)||Wr(e,9)},matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"REACT_PROJECT",peerDependencies:["react"],matcherFunction:({peerDependencies:e})=>e.every(Boolean)},{preset:"REACT_NATIVE",dependencies:["react-native","react-native-scripts"],matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"REACT_SCRIPTS",files:["/node_modules/.bin/react-scripts"],dependencies:["react-scripts"],matcherFunction:({dependencies:e,files:o})=>e.every(Boolean)||o.every(Boolean)},{preset:"WEBPACK_REACT",dependencies:["react","webpack"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"REACT",dependencies:["react"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"ANGULAR",dependencies:["@angular/core"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"WEB_COMPONENTS",dependencies:["lit-element","lit-html","lit"],matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"MITHRIL",dependencies:["mithril"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"MARIONETTE",dependencies:["backbone.marionette"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"MARKO",dependencies:["marko"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"RIOT",dependencies:["riot"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"PREACT",dependencies:["preact"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"SVELTE",dependencies:["svelte"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"RAX",dependencies:["rax"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"AURELIA",dependencies:["aurelia-bootstrapper"],matcherFunction:({dependencies:e})=>e.every(Boolean)}],Oo={preset:"UNSUPPORTED",dependencies:{nuxt:e=>He(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},Yr=["UNDETECTED","UNSUPPORTED","ALREADY_HAS_STORYBOOK"],Re=Object.values(je).filter(e=>!Yr.includes(e)).map(e=>e.toLowerCase());import zr from"path";import Zr from"fs";import Qr from"find-up";import Vo from"semver";import De,{join as oe}from"path";import H from"fs";import I from"fs-extra";import K from"chalk";import{satisfies as Hr}from"semver";import qr from"strip-json-comments";import{dirname as Fo}from"path";function A(){return Fo(M.resolve("@storybook/cli/package.json"))}function $o(e){return Fo(M.resolve(`@storybook/${e}/package.json`,{paths:[process.cwd()]}))}var j={"@storybook/addon-a11y":"7.0.0-alpha.48","@storybook/addon-actions":"7.0.0-alpha.48","@storybook/addon-backgrounds":"7.0.0-alpha.48","@storybook/addon-controls":"7.0.0-alpha.48","@storybook/addon-docs":"7.0.0-alpha.48","@storybook/addon-essentials":"7.0.0-alpha.48","@storybook/addon-highlight":"7.0.0-alpha.48","@storybook/addon-interactions":"7.0.0-alpha.48","@storybook/addon-jest":"7.0.0-alpha.48","@storybook/addon-links":"7.0.0-alpha.48","@storybook/addon-measure":"7.0.0-alpha.48","@storybook/addon-outline":"7.0.0-alpha.48","@storybook/addon-storyshots":"7.0.0-alpha.48","@storybook/addon-storyshots-puppeteer":"7.0.0-alpha.48","@storybook/addon-storysource":"7.0.0-alpha.48","@storybook/addon-toolbars":"7.0.0-alpha.48","@storybook/addon-viewport":"7.0.0-alpha.48","@storybook/addons":"7.0.0-alpha.48","@storybook/angular":"7.0.0-alpha.48","@storybook/api":"7.0.0-alpha.48","@storybook/blocks":"7.0.0-alpha.48","@storybook/builder-manager":"7.0.0-alpha.48","@storybook/builder-vite":"7.0.0-alpha.48","@storybook/builder-webpack5":"7.0.0-alpha.48","@storybook/channel-postmessage":"7.0.0-alpha.48","@storybook/channel-websocket":"7.0.0-alpha.48","@storybook/channels":"7.0.0-alpha.48","@storybook/cli":"7.0.0-alpha.48","@storybook/client-api":"7.0.0-alpha.48","@storybook/client-logger":"7.0.0-alpha.48","@storybook/codemod":"7.0.0-alpha.48","@storybook/components":"7.0.0-alpha.48","@storybook/core-client":"7.0.0-alpha.48","@storybook/core-common":"7.0.0-alpha.48","@storybook/core-events":"7.0.0-alpha.48","@storybook/core-server":"7.0.0-alpha.48","@storybook/core-webpack":"7.0.0-alpha.48","@storybook/csf-tools":"7.0.0-alpha.48","@storybook/docs-tools":"7.0.0-alpha.48","@storybook/ember":"7.0.0-alpha.48","@storybook/html":"7.0.0-alpha.48","@storybook/html-webpack5":"7.0.0-alpha.48","@storybook/instrumenter":"7.0.0-alpha.48","@storybook/nextjs":"7.0.0-alpha.48","@storybook/node-logger":"7.0.0-alpha.48","@storybook/postinstall":"7.0.0-alpha.48","@storybook/preact":"7.0.0-alpha.48","@storybook/preact-webpack5":"7.0.0-alpha.48","@storybook/preset-html-webpack":"7.0.0-alpha.48","@storybook/preset-preact-webpack":"7.0.0-alpha.48","@storybook/preset-react-webpack":"7.0.0-alpha.48","@storybook/preset-server-webpack":"7.0.0-alpha.48","@storybook/preset-svelte-webpack":"7.0.0-alpha.48","@storybook/preset-vue-webpack":"7.0.0-alpha.48","@storybook/preset-vue3-webpack":"7.0.0-alpha.48","@storybook/preset-web-components-webpack":"7.0.0-alpha.48","@storybook/preview-web":"7.0.0-alpha.48","@storybook/react":"7.0.0-alpha.48","@storybook/react-vite":"7.0.0-alpha.48","@storybook/react-webpack5":"7.0.0-alpha.48","@storybook/router":"7.0.0-alpha.48","@storybook/server":"7.0.0-alpha.48","@storybook/server-webpack5":"7.0.0-alpha.48","@storybook/source-loader":"7.0.0-alpha.48","@storybook/store":"7.0.0-alpha.48","@storybook/svelte":"7.0.0-alpha.48","@storybook/svelte-vite":"7.0.0-alpha.48","@storybook/svelte-webpack5":"7.0.0-alpha.48","@storybook/telemetry":"7.0.0-alpha.48","@storybook/theming":"7.0.0-alpha.48","@storybook/manager":"7.0.0-alpha.48","@storybook/vue":"7.0.0-alpha.48","@storybook/vue-vite":"7.0.0-alpha.48","@storybook/vue-webpack5":"7.0.0-alpha.48","@storybook/vue3":"7.0.0-alpha.48","@storybook/vue3-vite":"7.0.0-alpha.48","@storybook/vue3-webpack5":"7.0.0-alpha.48","@storybook/web-components":"7.0.0-alpha.48","@storybook/web-components-webpack5":"7.0.0-alpha.48","@storybook/web-components-vite":"7.0.0-alpha.48",sb:"7.0.0-alpha.48",storybook:"7.0.0-alpha.48"};var ue=console;function ze(){let e=De.resolve("bower.json");if(!H.existsSync(e))return!1;let o=H.readFileSync(e,"utf8");return JSON.parse(o)}function q(e,o){let t=De.resolve(e);if(!H.existsSync(t))return!1;let r=H.readFileSync(t,"utf8"),n=o?qr(r):r;try{return JSON.parse(n)}catch(s){throw ue.error(K.red(`Invalid json in file: ${t}`)),s}}var te=(e,o)=>{let t=De.resolve(e);return H.existsSync(t)?(H.writeFileSync(t,`${JSON.stringify(o,null,2)}
`),!0):!1},y=e=>(process.stdout.write(K.cyan(" \u2022 ")+e),(o,t)=>{if(o){if(process.stdout.write(`. ${K.red("\u2716")}
`),ue.error(`
     ${K.red(o)}`),!t)return;let r=t.split(`
`).map(n=>`     ${K.dim(n)}`).join(`
`);ue.error(`${r}
`);return}process.stdout.write(`. ${K.green("\u2713")}
`)});function S(e){let o=e.split(`
`).map(t=>`    ${t}`).join(`
`);ue.log(o)}function Jo(e,o){let t="";for(let r=0;r<o;r+=1)t+=e;return t}function Ae(e,o){let t=0,n=e.map(s=>(t=s.length>t?s.length:t,s)).map(s=>{let a=t-s.length,c=s+Jo(" ",a);return c=Jo(" ",o||2)+K.inverse(` ${c} `),c}).join(`
`);ue.log(n)}async function Ee(e,o){let t=[],r="^8.0.0-0",n=o.dependencies["babel-core"]||o.devDependencies["babel-core"];if(n){let s=await e.latestVersion("babel-core",n);Hr(s,"^6.0.0")&&(r="^7.0.0")}else if(!o.dependencies["@babel/core"]&&!o.devDependencies["@babel/core"]){let s=await e.getVersion("@babel/core");t.push(`@babel/core@${s}`)}if(!o.dependencies["babel-loader"]&&!o.devDependencies["babel-loader"]){let s=await e.getVersion("babel-loader",r);t.push(`babel-loader@${s}`)}return t}function G(e){let o=De.resolve(e,"template-csf/");if(!H.existsSync(o))throw new Error("Couldn't find template dir");I.copySync(o,".",{overwrite:!0})}async function Io(e,o){let t={["javascript"]:"js",["typescript"]:"ts",["typescript-legacy"]:"ts-legacy"},r=async()=>{let a=$o(e),c=oe(a,"template/cli"),i=oe(c,t[o]),l=oe(c,t["javascript"]),m=oe(c,t["typescript-legacy"]),d=oe(c,t["typescript"]);if(await I.pathExists(i))return i;if(o==="typescript"&&await I.pathExists(m))return m;if(o==="typescript-legacy"&&await I.pathExists(d))return d;if(await I.pathExists(l))return l;if(await I.pathExists(c))return c;throw new Error(`Unsupported renderer: ${e}`)},s=await(async()=>await I.pathExists("./src")?"./src/stories":"./stories")();await I.copy(oe(A(),"rendererAssets/common"),s,{overwrite:!0}),await I.copy(await r(),s,{overwrite:!0})}function Oe(e){let o={...e.dependencies,...e.devDependencies},t=Object.keys(o).find(r=>j[r]);if(!t)throw new Error("Couldn't find any official storybook packages in package.json");return o[t]}var Xr=/[\s"\n]next.*?(\d+).*/,No=e=>{try{let o="";if(e.type==="npm")try{o=e.executeCommand("npm",["ls","next"])}catch{o=e.executeCommand("npm",["why","next"])}else o=e.executeCommand("yarn",["why","next"]);let[,t]=o.match(Xr);return t&&parseInt(t,10)?parseInt(t,10):!1}catch{}return!1};var en=["vite.config.ts","vite.config.js","vite.config.mjs"],Ze=(e,o,t)=>{let r=e.dependencies?.[o]||e.devDependencies?.[o];return r&&typeof t=="function"?t(r):!!r},on=(e,o,t)=>{let r=e.peerDependencies?.[o];return r&&typeof t=="function"?t(r):!!r},tn=(e,o)=>{let t={dependencies:[!1],peerDependencies:[!1],files:[!1]},{preset:r,files:n,dependencies:s,peerDependencies:a,matcherFunction:c}=o,i=[];Array.isArray(s)?i=s.map(m=>[m,void 0]):typeof s=="object"&&(i=Object.entries(s)),i.length>0&&(t.dependencies=i.map(([m,d])=>Ze(e,m,d)));let l=[];return Array.isArray(a)?l=a.map(m=>[m,void 0]):typeof a=="object"&&(l=Object.entries(a)),l.length>0&&(t.peerDependencies=l.map(([m,d])=>on(e,m,d))),Array.isArray(n)&&n.length>0&&(t.files=n.map(m=>Zr.existsSync(zr.join(process.cwd(),m)))),c(t)?r:null};function rn(e={}){let o=[...Eo,Oo].find(t=>tn(e,t)!==null);return o?o.preset:"UNDETECTED"}function _o(e){if(Qr.sync(en))return S("Detected vite project, setting builder to @storybook/builder-vite"),"vite";let t=No(e);return t&&t>=11?"webpack5":"webpack5"}function Qe(e,o){return e&&!o&&e.devDependencies&&Ao.reduce((t,r)=>t||!!e.devDependencies[`@storybook/${r}`],!1)?"ALREADY_HAS_STORYBOOK":!1}function Mo(e){let o="javascript",t=ze();return!e&&!t||(Ze(e||t,"typescript",r=>Vo.gte(Vo.coerce(r),"4.9.0"))?o="typescript":Ze(e||t,"typescript")&&(o="typescript-legacy")),o}function Go(e,o={}){let t=ze();if(!e&&!t)return"UNDETECTED";let r=Qe(e,o.force);return r||(o.html?"HTML":rn(e||t))}import jn,{join as Rn}from"path";import rt from"semver";import*as Bo from"path";import*as Lo from"fs";import{pathExists as nn}from"fs-extra";function Fe(){let e=q("angular.json",!0),o=an(e),t=e.projects[o].architect.build.options.tsConfig;return!t||!Lo.existsSync(Bo.resolve(t))?!1:t}function Uo(){let e=Fe();return e?q(e,!0):!1}function sn(e){let o=Fe(),t={...e};return t.extends=`../${o}`,t}function Wo(e){let o;try{o=q(e)}catch(t){throw t.name==="SyntaxError"&&t.message.indexOf("Unexpected token /")>-1?new Error(`Comments are disallowed in ${e}`):t}o=sn(o),te(e,o)}function an(e){let{defaultProject:o,projects:t}=e;if(t?.storybook)return"storybook";if(o)return o;let r=t?Object.keys(t)[0]:void 0;if(r)return r}function Yo(){let{projects:e}=q("angular.json",!0);if(!e||Object.keys(e).length===0)throw new Error(`Could not find a project in your Angular workspace. 
Add a project and re-run the installation`)}async function Ko(){return await nn("./tsconfig.base.json")?"tsconfig.base.json":"tsconfig.json"}import vn from"path";import no from"fs-extra";import{dedent as et}from"ts-dedent";import $e from"fs-extra";import{dedent as eo}from"ts-dedent";async function Ho({addons:e,extensions:o=["js","jsx","ts","tsx"],commonJs:t=!1,...r}){let n=await $e.pathExists("./src")?"../src":"../stories",s={stories:[`${n}/**/*.stories.mdx`,`${n}/**/*.stories.@(${o.join("|")})`],addons:e,...r},a=`module.exports = ${JSON.stringify(s,null,2).replace(/\\"/g,'"').replace(/['"]%%/g,"").replace(/%%['"]/g,"").replace(/\\n/g,`\r
`)}`;await $e.writeFile(`./.storybook/main.${t?"cjs":"js"}`,eo`
      const path = require('path');
      ${a}
    `,{encoding:"utf8"})}var cn={angular:{prefix:eo`
      import { setCompodocJson } from "@storybook/addon-docs/angular";
      import docJson from "../documentation.json";
      setCompodocJson(docJson);
      
      `.trimStart(),extraParameters:"docs: { inlineStories: true },"}};async function qo(e){let{prefix:o="",extraParameters:t=""}=cn[e]||{},r="./.storybook/preview.js";if(await $e.pathExists(r))return;let n=eo`
    ${o}
    export const parameters = {
      actions: { argTypesRegex: "^on[A-Z].*" },
      controls: {
        matchers: {
          color: /(background|color)$/i,
          date: /Date$/,
        },
      },
      ${t}
    }`.replace(`  
`,"").trim();await $e.writeFile(r,n,{encoding:"utf8"})}import pn from"util-deprecate";var ne=pn(()=>{},"`--use-npm` is deprecated and will be removed in Storybook 8.0. \nPlease use the `--package-manager=npm` option instead.\nRead more at https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#cli-option---use-npm-deprecated");import{sync as to}from"cross-spawn";import{sync as Qo}from"find-up";import mn from"semver";import Xo from"chalk";import{gt as ln,satisfies as zo}from"semver";import{sync as dn}from"cross-spawn";import Zo from"path";import oo from"fs";var B=console;function X(e){let o=e.lastIndexOf("@");if(o<=0)return[e,void 0];let t=e.slice(0,o),r=e.slice(o+1);return[t,r]}var E=class{setRegistryURL(o){o?this.executeCommand("npm",["config","set","registry",o]):this.executeCommand("npm",["config","delete","registry"])}getRegistryURL(){let o=this.executeCommand("npm",["config","get","registry"]).trim();return o==="undefined"?void 0:o}constructor(o){this.cwd=o?.cwd}installDependencies(){let o=y("Preparing to install dependencies");o(),B.log(),B.log(),o=y("Installing dependencies");try{this.runInstall()}catch{o("An error occurred while installing dependencies."),process.exit(1)}o()}packageJsonPath(){return this.cwd?Zo.resolve(this.cwd,"package.json"):Zo.resolve("package.json")}readPackageJson(){let o=this.packageJsonPath();if(!oo.existsSync(o))throw new Error(`Could not read package.json file at ${o}`);let t=oo.readFileSync(o,"utf8");return JSON.parse(t)}writePackageJson(o){let t=`${JSON.stringify(o,null,2)}
`;oo.writeFileSync(this.packageJsonPath(),t,"utf8")}retrievePackageJson(){let o;try{o=this.readPackageJson()}catch{this.initPackageJson(),o=this.readPackageJson()}return{...o,dependencies:{...o.dependencies},devDependencies:{...o.devDependencies}}}addDependencies(o,t){let{skipInstall:r}=o;if(r){let{packageJson:n}=o,s=t.reduce((a,c)=>{let[i,l]=X(c);return{...a,[i]:l}},{});o.installAsDevDependencies?n.devDependencies={...n.devDependencies,...s}:n.dependencies={...n.dependencies,...s},this.writePackageJson(n)}else try{this.runAddDeps(t,o.installAsDevDependencies)}catch(n){B.error("An error occurred while installing dependencies."),B.log(n.message),process.exit(1)}}removeDependencies(o,t){let{skipInstall:r}=o;if(r){let{packageJson:n}=o;t.forEach(s=>{n.devDependencies&&delete n.devDependencies[s],n.dependencies&&delete n.dependencies[s]}),this.writePackageJson(n)}else try{this.runRemoveDeps(t)}catch(n){B.error("An error occurred while removing dependencies."),B.log(n.message),process.exit(1)}}getVersionedPackages(o){return Promise.all(o.map(async t=>{let[r,n]=X(t);return`${r}@${await this.getVersion(r,n)}`}))}getVersions(...o){return Promise.all(o.map(t=>this.getVersion(t)))}async getVersion(o,t){let r;/(@storybook|^sb$|^storybook$)/.test(o)&&(r=j[o]);let n;try{n=await this.latestVersion(o,t)}catch(a){if(r)return B.warn(`
     ${Xo.yellow(a.message)}`),r;B.error(`
     ${Xo.red(a.message)}`),process.exit(1)}return`^${r&&(!t||zo(r,t))&&ln(r,n)?r:n}`}async latestVersion(o,t){return t?(await this.runGetVersions(o,!0)).reverse().find(n=>zo(n,t)):this.runGetVersions(o,!1)}addStorybookCommandInScripts(o){let r=`storybook dev -p ${o?.port??6006}`,n="storybook build",s=o?.preCommand?this.getRunCommand(o.preCommand):void 0;this.addScripts({storybook:[s,r].filter(Boolean).join(" && "),"build-storybook":[s,n].filter(Boolean).join(" && ")})}addESLintConfig(){let o=this.retrievePackageJson();this.writePackageJson({...o,eslintConfig:{...o.eslintConfig,overrides:[...o.eslintConfig?.overrides||[],{files:["**/*.stories.*"],rules:{"import/no-anonymous-default-export":"off"}}]}})}addScripts(o){let t=this.retrievePackageJson();this.writePackageJson({...t,scripts:{...t.scripts,...o}})}addPackageResolutions(o){let t=this.retrievePackageJson(),r=this.getResolutions(t,o);this.writePackageJson({...t,...r})}executeCommand(o,t,r){let n=dn(o,t,{cwd:this.cwd,stdio:r??"pipe",encoding:"utf-8",shell:!0});if(n.status!==0)throw new Error(n.stderr??"");return n.stdout??""}};var ge=class extends E{constructor(){super(...arguments);this.type="npm"}initPackageJson(){return this.executeCommand("npm",["init","-y"])}getRunStorybookCommand(){return"npm run storybook"}getRunCommand(t){return`npm run ${t}`}getNpmVersion(){return this.executeCommand("npm",["--version"])}hasLegacyPeerDeps(){return this.executeCommand("npm",["config","get","legacy-peer-deps","--location=project"]).trim()==="true"}setLegacyPeerDeps(){this.executeCommand("npm",["config","set","legacy-peer-deps=true","--location=project"])}needsLegacyPeerDeps(t){return mn.gte(t,"7.0.0")&&!this.hasLegacyPeerDeps()}getInstallArgs(){return this.installArgs||(this.installArgs=this.needsLegacyPeerDeps(this.getNpmVersion())?["install","--legacy-peer-deps"]:["install"]),this.installArgs}getUninstallArgs(){return this.uninstallArgs||(this.uninstallArgs=this.needsLegacyPeerDeps(this.getNpmVersion())?["uninstall","--legacy-peer-deps"]:["uninstall"]),this.uninstallArgs}getResolutions(t,r){return{overrides:{...t.overrides,...r}}}runInstall(){this.executeCommand("npm",this.getInstallArgs(),"inherit")}runAddDeps(t,r){let n=[...t];r&&(n=["-D",...n]),this.executeCommand("npm",[...this.getInstallArgs(),...n],"inherit")}runRemoveDeps(t){let r=[...t];this.executeCommand("npm",[...this.getUninstallArgs(),...r],"inherit")}runGetVersions(t,r){let n=[r?"versions":"version","--json"],s=this.executeCommand("npm",["info",t,...n]);try{let a=JSON.parse(s);if(a.error)throw new Error(a.error.summary);return a}catch{throw new Error(`Unable to find versions of ${t} using npm`)}}};var ye=class extends E{constructor(){super(...arguments);this.type="pnpm"}initPackageJson(){return this.executeCommand("pnpm",["init","-y"])}getRunStorybookCommand(){return"pnpm run storybook"}getRunCommand(t){return`pnpm run ${t}`}getPnpmVersion(){return this.executeCommand("pnpm",["--version"])}getResolutions(t,r){return{overrides:{...t.overrides,...r}}}runInstall(){this.executeCommand("pnpm",["install"],"inherit")}runAddDeps(t,r){let n=[...t];r&&(n=["-D",...n]),this.executeCommand("pnpm",["add",...n],"inherit")}runRemoveDeps(t){let r=[...t];this.executeCommand("pnpm",["remove",...r],"inherit")}runGetVersions(t,r){let n=[r?"versions":"version","--json"],s=this.executeCommand("pnpm",["info",t,...n]);try{let a=JSON.parse(s);if(a.error)throw new Error(a.error.summary);return a}catch{throw new Error(`Unable to find versions of ${t} using pnpm`)}}};var fe=class extends E{constructor(){super(...arguments);this.type="yarn2"}initPackageJson(){return this.executeCommand("yarn",["init"])}getRunStorybookCommand(){return"yarn storybook"}getRunCommand(t){return`yarn ${t}`}getResolutions(t,r){return{resolutions:{...t.resolutions,...r}}}runInstall(){this.executeCommand("yarn",[],"inherit")}runAddDeps(t,r){let n=[...t];r&&(n=["-D",...n]),this.executeCommand("yarn",["add",...n],"inherit")}runRemoveDeps(t){let r=[...t];this.executeCommand("yarn",["remove",...r],"inherit")}runGetVersions(t,r){let n=r?"versions":"version",s=["--fields",n,"--json"],a=this.executeCommand("yarn",["npm","info",t,...s]);try{return JSON.parse(a)[n]}catch{throw new Error(`Unable to find versions of ${t} using yarn 2`)}}};var be=class extends E{constructor(){super(...arguments);this.type="yarn1"}initPackageJson(){return this.executeCommand("yarn",["init","-y"])}getRunStorybookCommand(){return"yarn storybook"}getRunCommand(t){return`yarn ${t}`}getResolutions(t,r){return{resolutions:{...t.resolutions,...r}}}runInstall(){this.executeCommand("yarn",[],"inherit")}runAddDeps(t,r){let n=["--ignore-workspace-root-check",...t];r&&(n=["-D",...n]),this.executeCommand("yarn",["add",...n],"inherit")}runRemoveDeps(t){let r=["--ignore-workspace-root-check",...t];this.executeCommand("yarn",["remove",...r],"inherit")}runGetVersions(t,r){let n=[r?"versions":"version","--json"],s=this.executeCommand("yarn",["info",t,...n]);try{let a=JSON.parse(s);if(a.type==="inspect")return a.data;throw new Error(`Unable to find versions of ${t} using yarn`)}catch{throw new Error(`Unable to find versions of ${t} using yarn`)}}};var O=class{static getPackageManager({force:o,useNpm:t}={},r){if(t||o==="npm")return new ge({cwd:r});if(o==="pnpm")return new ye({cwd:r});if(o==="yarn1")return new be({cwd:r});if(o==="yarn2")return new fe({cwd:r});let n=yn(r),s=Boolean(Qo("yarn.lock",{cwd:r})),a=Boolean(Qo("pnpm-lock.yaml",{cwd:r})),c=un(r),i=gn(r);if(n&&(s||!c&&!i))return n===1?new be({cwd:r}):new fe({cwd:r});if(i&&a)return new ye({cwd:r});if(c)return new ge({cwd:r});throw new Error("Unable to find a usable package manager within NPM, PNPM, Yarn and Yarn 2")}};function un(e){return to("npm",["--version"],{cwd:e,shell:!0}).status===0}function gn(e){return to("pnpm",["--version"],{cwd:e,shell:!0}).status===0}function yn(e){let o=to("yarn",["--version"],{cwd:e,shell:!0});if(o.status!==0)return;let t=o.output.toString().replace(/,/g,"").replace(/"/g,"");return/^1\.+/.test(t)?1:2}import{writeFile as fn,access as bn}from"fs-extra";import{logger as ro}from"@storybook/node-logger";import kn from"path";import hn from"prompts";var Je=async()=>{let e=process.cwd();return wn({target:e})},wn=async({target:e})=>{ro.info(`Generating the storybook default babel config at ${e}`);let o=JSON.stringify({sourceType:"unambiguous",presets:[],plugins:[]},null,2),t=".babelrc.json",r=kn.join(e,t);if(await bn(r).then(()=>!0,()=>!1)){let{overwrite:s}=await hn({type:"confirm",initial:!0,name:"overwrite",message:`${t} already exists. Would you like overwrite it?`});if(s===!1){ro.warn("Cancelled, babel config file was NOT written to file-system.");return}}ro.info(`Writing file to ${r}`),await fn(r,o)};var ot={extraPackages:[],extraAddons:[],staticDir:void 0,addScripts:!0,addComponents:!0,addBabel:!1,addESLint:!1,extraMain:void 0,framework:void 0,extensions:void 0,commonJs:!1},xn=e=>{let o=j;if(o[e])return e;let t=`@storybook/${e}`;return o[t]?t:e},Ie=e=>`%%path.dirname(require.resolve(path.join('${e}', 'package.json')))%%`,Pn=(e,o,t,r)=>{let n=r?`@storybook/${r}`:`@storybook/${e}-${o}`,s=t?Ie(n):n,a=`@storybook/${e}`,c=t?Ie(a):a,i=xn(o),l=t?Ie(i):i,m=!!j[n],d=!!j[a];if(m)return{packages:[n],framework:s,rendererId:e,type:"framework"};if(d)return{packages:[a,i],builder:l,renderer:c,rendererId:e,type:"renderer"};throw new Error(`Could not find the framework (${n}) or renderer (${a}) package`)},Sn=e=>e.map(o=>X(o)[0]),Cn=e=>["react","angular","preact","svelte","vue","vue3","html"].includes(e),Tn=e=>["angular","nextjs"].includes(e),tt;async function g(e,o,{language:t,builder:r="webpack5",pnp:n,commonJs:s},a,c=ot,i){let{extraAddons:l,extraPackages:m,staticDir:d,addScripts:f,addComponents:u,addBabel:h,addESLint:J,extraMain:me,extensions:$r}={...ot,...c},{packages:Co,type:To,renderer:Ni,rendererId:Se,framework:Jr,builder:Ir}=Pn(a,r,n,i),Ke=["@storybook/addon-links","@storybook/addon-essentials",...Sn(l)],b=["@storybook/addon-links","@storybook/addon-essentials",...l];Cn(Se)&&(Ke.push("@storybook/addon-interactions"),b.push("@storybook/addon-interactions","@storybook/testing-library"));let Nr=e.type==="yarn2"?["@storybook/addon-docs"]:[],Vr=await no.readdir(process.cwd()),Ce=e.retrievePackageJson(),_r=new Set(Object.keys({...Ce.dependencies,...Ce.devDependencies}));if(To==="renderer")throw new Error(et`
        Sorry, for now, you can not do this, please use a framework such as @storybook/react-webpack5

        https://github.com/storybookjs/storybook/issues/18360
      `);let Mr=["storybook",`@storybook/${Se}`,...Co,...b,...m,...Nr].filter(Boolean).filter(T=>!_r.has(X(T)[0])),Gr=await e.getVersionedPackages(Mr);if(await no.ensureDir("./.storybook"),await Ho({framework:{name:Jr,options:c.framework||{}},docs:{docsPage:!0},addons:n?Ke.map(Ie):Ke,extensions:$r,commonJs:s,...d?{staticDirs:[vn.join("..",d)]}:null,...me,...To!=="framework"?{core:{builder:Ir}}:{}}),await qo(Se),Co.find(T=>T.match(/^@storybook\/.*-vite$/))){let T=et(tt||(tt=Do([`
      <script>
        window.global = window;
      <\/script>
    `])));await no.writeFile(".storybook/preview-head.html",T,{encoding:"utf8"})}let Br=h&&r!=="vite"?await Ee(e,Ce):[];if(!Vr.some(T=>T.startsWith(".babel")||T.startsWith("babel")||T==="package.json")&&await Je(),e.addDependencies({...o,packageJson:Ce},[...Gr,...Br]),f&&e.addStorybookCommandInScripts({port:6006}),J&&e.addESLintConfig(),u){let T=Tn(i)?i:Se;await Io(T,t)}}function Dn(){let e=Uo(),o="**/*.stories.*";if(!e)return;let{exclude:t=[]}=e;t.includes(o)||(e.exclude=[...t,o],te(Fe(),e))}var An=async(e,o,t)=>{Yo();let r=rt.coerce(e.retrievePackageJson().dependencies["@angular/core"])?.version,s=rt.gte(r,"12.0.0")?{...t,builder:"webpack5"}:t;await g(e,o,s,"angular",{extraPackages:["@compodoc/compodoc"],addScripts:!1},"angular");let a=Rn(A(),"templates","angular");G(a),Dn(),Wo(jn.resolve("./.storybook/tsconfig.json"));let c=await Ko();e.addScripts({"docs:json":`compodoc -p ./${c} -e json -d .`}),e.addStorybookCommandInScripts({port:6006,preCommand:"docs:json"})},nt=An;import{join as En}from"path";function On(){let e=q("tsconfig.json",!0),o="**/*.stories.ts";if(!e)return;let{exclude:t=[]}=e;t.includes(o)||(e.exclude=[...t,o],te("tsconfig.json",e))}var Fn=async(e,o,t)=>{On(),await g(e,o,t,"aurelia",{extraPackages:["aurelia"]});let r=En(A(),"templates","aurelia");G(r)},st=Fn;var $n=async(e,o,t)=>{await g(e,o,t,"ember",{extraPackages:["babel-plugin-ember-modules-api-polyfill","babel-plugin-htmlbars-inline-precompile"],staticDir:"dist"})},at=$n;var Jn=async(e,o,t)=>{await g(e,o,t,"react")},so=Jn;import{join as In}from"path";import Nn from"chalk";import it from"shelljs";var Vn=async(e,o,t)=>{let r=it.ls("-d","ios/*.xcodeproj").stdout;if(r){let h=r.slice(4,r.length-10-1);h?it.sed("-i","%APP_NAME%",h,"storybook/index.js"):S(Nn.red("ERR: Could not determine project name, to fix: https://github.com/storybookjs/storybook/issues/1277"))}let n=e.retrievePackageJson(),s=!n.dependencies["react-dom"]&&!n.devDependencies["react-dom"],a=n.dependencies.react,c=["@storybook/addon-links@^5.3","@storybook/addon-knobs@^5.3","@storybook/addon-actions@^5.3"],l=[...["@storybook/addon-ondevice-knobs","@storybook/addon-ondevice-actions"],"@storybook/react-native",t&&"@storybook/react-native-server"].filter(Boolean),m=await e.getVersionedPackages(l),f=[...await Ee(e,n),...m,...c,s&&a&&`react-dom@${a}`].filter(Boolean);e.addDependencies({...o,packageJson:n},f),t&&e.addStorybookCommandInScripts({port:7007});let u=In(A(),"templates","react-native");G(u)},ct=Vn;import pt from"path";import _n from"fs";import lt from"semver";var Mn=async(e,o,t)=>{let r=pt.join(__dirname,"..","..","..","..","..",".."),n=t.linkable?{webpackFinal:`%%(config) => {
      // add monorepo root as a valid directory to import modules from
      config.resolve.plugins.forEach((p) => {
        if (Array.isArray(p.appSrcs)) {
          p.appSrcs.push('${r}');
              }
            });
          return config;
          }
    %%`}:{},s=lt.coerce(e.retrievePackageJson().dependencies["react-scripts"])?.version,a=s&&lt.gte(s,"5.0.0"),c=a?{...t,builder:"webpack5"}:t,i=["@storybook/node-logger"];a&&(i.push("webpack"),i.push("babel-plugin-named-exports-order"),i.push("prop-types")),await g(e,o,c,"react",{extraAddons:[`@storybook/preset-create-react-app${a?"":"@3"}`],extraPackages:i,staticDir:_n.existsSync(pt.resolve("./public"))?"public":void 0,addBabel:!1,addESLint:!0,extraMain:n})},dt=Mn;var Gn=async(e,o,t)=>{await g(e,o,t,"react",void 0,"nextjs")},mt=Gn;var Bn=async(e,o,t)=>{await g(e,o,t,"vue")},ut=Bn;var Ln=async(e,o,t)=>{let r=t.builder==="webpack5"?["vue-loader@^15.7.0"]:[];await g(e,o,t,"vue",{extraPackages:r})},gt=Ln;var Un=async(e,o,t)=>{let r=t.builder==="webpack5"?["vue-loader@^17.0.0","@vue/compiler-sfc@^3.2.0"]:[];await g(e,o,t,"vue3",{extraPackages:r})},yt=Un;var Wn=async(e,o,t)=>{await g(e,o,t,"react")},ft=Wn;var Yn=async(e,o,t)=>{await g(e,o,t,"mithril")},bt=Yn;var Kn=async(e,o,t)=>{await g(e,o,t,"marionette")},kt=Kn;var Hn=async(e,o,t)=>{await g(e,o,t,"marko")},ht=Hn;var qn=async(e,o,t)=>{await g(e,o,t,"html")},wt=qn;var Xn=async(e,o,t)=>g(e,o,t,"web-components",{extraPackages:["lit-html"]}),vt=Xn;var zn=async(e,o,t)=>{await g(e,o,t,"riot",{extraPackages:["riot-tag-loader"]})},xt=zn;var Zn=async(e,o,t)=>{await g(e,o,t,"preact")},Pt=Zn;var Qn=async(e,o,t)=>{let r=t.builder==="webpack5"?["svelte","svelte-loader"]:[];await g(e,o,t,"svelte",{extraPackages:r,extensions:["js","jsx","ts","tsx","svelte"],commonJs:!0})},St=Qn;var es=async(e,o,t)=>{let[r]=await e.getVersions("rax"),n=e.retrievePackageJson(),s=n.dependencies.rax||r;n.dependencies.rax=n.dependencies.rax||s,n.dependencies["rax-image"]=n.dependencies["rax-image"]||s,n.dependencies["rax-link"]=n.dependencies["rax-link"]||s,n.dependencies["rax-text"]=n.dependencies["rax-text"]||s,n.dependencies["rax-view"]=n.dependencies["rax-view"]||s,e.writePackageJson(n),await g(e,o,t,"rax",{extraPackages:["rax"]})},Ct=es;import{join as os}from"path";var ts=async(e,o,t)=>{await g(e,o,t,"server",{extensions:["json"]});let r=os(A(),"templates","server");G(r)},Tt=ts;import Ws from"prompts";import pe from"chalk";import Ys from"boxen";import io from"chalk";import{dedent as as}from"ts-dedent";import jt from"semver";import se from"chalk";import{dedent as ao}from"ts-dedent";import ae from"semver";import{readConfig as rs,writeConfig as ns}from"@storybook/csf-tools";import{getStorybookInfo as ss}from"@storybook/core-common";var ie=console,R={id:"webpack5",async checkWebpack5Builder(e){let{mainConfig:o,version:t}=ss(e),r=t&&ae.coerce(t)?.version;if(!r)return ie.warn(ao`
        ❌ Unable to determine storybook version, skipping ${se.cyan("webpack5")} fix.
        🤔 Are you running automigrate from your project directory?
      `),null;if(ae.lt(r,"6.3.0"))return ie.warn(ao`
          Detected SB 6.3 or below, please upgrade storybook to use webpack5.

          To upgrade to the latest stable release, run this from your project directory:

          ${se.cyan("npx storybook upgrade")}

          Add the ${se.cyan("--prerelease")} flag to get the latest prerelease.
        `.trim()),null;if(ae.gte(r,"7.0.0"))return null;if(!o)return ie.warn("Unable to find storybook main.js config"),null;let n=await rs(o),s=n.getFieldValue(["core","builder"]);return s&&s!=="webpack4"?(ie.info(`Found builder ${s}, skipping`),null):{storybookVersion:t,main:n}},async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t.webpack||r.webpack,s=ae.coerce(n)?.version;if(!s||ae.lt(s,"5.0.0")||ae.gte(s,"6.0.0"))return null;let a=await this.checkWebpack5Builder(o);return a?{webpackVersion:n,...a}:null},prompt({webpackVersion:e}){let o=se.cyan(`webpack ${e}`);return ao`
      We've detected you're running ${o}.
      Your Storybook's main.js files specifies webpack4, which is incompatible.
      
      To run Storybook in webpack5-mode, we can install Storybook's ${se.cyan("@storybook/builder-webpack5")} for you.

      More info: ${se.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#webpack-5-manager-build")}
    `},async run({result:{main:e,storybookVersion:o,webpackVersion:t},packageManager:r,dryRun:n}){let s=[`@storybook/builder-webpack5@${o}`];t||s.push("webpack@5"),ie.info(`\u2705 Adding dependencies: ${s}`),n||r.addDependencies({installAsDevDependencies:!0},s),ie.info("\u2705 Setting `core.builder` to `@storybook/builder-webpack5` in main.js"),n||(e.setFieldValue(["core","builder"],"@storybook/builder-webpack5"),await ns(e))}};var Rt={id:"cra5",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["react-scripts"]||r["react-scripts"],s=jt.coerce(n)?.version;if(!s||jt.lt(s,"5.0.0"))return null;let a=await R.checkWebpack5Builder(o);return a?{craVersion:n,...a}:null},prompt({craVersion:e,...o}){let t=io.cyan(`Create React App (CRA) ${e}`);return console.log({...o}),as`
      We've detected you are running ${t} which is powered by webpack5.
      Your Storybook's main.js files specifies webpack4, which is incompatible.

      In order to work with your version of CRA, we need to install Storybook's ${io.cyan("@storybook/builder-webpack5")}.

      More info: ${io.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#cra5-upgrade")}
    `},async run(e){return R.run({...e,result:{webpackVersion:null,...e.result}})}};import co from"chalk";import{dedent as is}from"ts-dedent";import Dt from"semver";var At={id:"angular12",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["@angular/core"]||r["@angular/core"],s=Dt.coerce(n)?.version;if(!s||Dt.lt(s,"12.0.0"))return null;let a=await R.checkWebpack5Builder(o);return a?{angularVersion:n,...a}:null},prompt({angularVersion:e}){let o=co.cyan(`Angular ${e}`);return is`
      We've detected you are running ${o} which is powered by webpack5.
      Your Storybook's main.js files specifies webpack4, which is incompatible.

      In order to work with your version of Angular, we need to install Storybook's ${co.cyan("@storybook/builder-webpack5")}.

      More info: ${co.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#angular12-upgrade")}
    `},async run(e){return R.run({...e,result:{webpackVersion:null,...e.result}})}};import Ne from"chalk";import{dedent as cs}from"ts-dedent";import Et from"semver";var Ot={id:"vue3",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t.vue||r.vue,s=Et.coerce(n)?.version;if(!s||Et.lt(s,"3.0.0"))return null;let a=await R.checkWebpack5Builder(o);return a?{vueVersion:n,...a}:null},prompt({vueVersion:e,storybookVersion:o}){let t=Ne.cyan(`Vue ${e}`),r=Ne.cyan(`Storybook ${o}`);return cs`
      We've detected you are running ${t} with Storybook.
      ${r} runs webpack4 by default, which is incompatible.

      In order to work with your version of Vue, we need to install Storybook's ${Ne.cyan("webpack5 builder")}.

      More info: ${Ne.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#vue3-upgrade")}
    `},async run(e){return R.run({...e,result:{webpackVersion:null,...e.result}})}};import po from"chalk";import{dedent as Ft}from"ts-dedent";import $t from"semver";import{readConfig as ps,writeConfig as ls}from"@storybook/csf-tools";import{getStorybookInfo as ds}from"@storybook/core-common";var lo=console,Jt={id:"mainjsFramework",async check({packageManager:e}){let o=e.retrievePackageJson(),{mainConfig:t,framework:r,version:n}=ds(o);if(!t)return lo.warn("Unable to find storybook main.js config, skipping"),null;let s=n&&$t.coerce(n)?.version;if(!s)return lo.warn(Ft`
        ❌ Unable to determine storybook version, skipping ${po.cyan("mainjsFramework")} fix.
        🤔 Are you running automigrate from your project directory?
      `),null;let a=await ps(t),c=a.getFieldValue(["framework"]),i=a.getFieldValue(["features"]);return c?null:i?.breakingChangesV7||i?.storyStoreV7||$t.gte(s,"7.0.0")?{main:a,framework:`@storybook/${r}`}:null},prompt({framework:e}){let o=po.cyan(`framework: '${e}'`);return Ft`
      We've detected that your main.js configuration file does not specify the
      'framework' field, which is a requirement in SB7.0 and above. We can add one
      for you automatically:

      ${o}

      More info: ${po.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#mainjs-framework-field")}
    `},async run({result:{main:e,framework:o},dryRun:t}){lo.info(`\u2705 Setting 'framework' to '${o}' in main.js`),t||(e.setFieldValue(["framework"],o),await ls(e))}};import us from"chalk";import{dedent as Vt}from"ts-dedent";import{readConfig as _t,writeConfig as gs}from"@storybook/csf-tools";import{getStorybookInfo as ys}from"@storybook/core-common";import{readFile as fs,readJson as bs,writeJson as ks}from"fs-extra";import hs from"detect-indent";import It from"fs-extra";var mo=["js","cjs","json"],ms=["yaml","yml"],Nt=()=>{let e=".eslintrc",o=ms.find(r=>It.existsSync(`${e}.${r}`));if(o)throw new Error(o);let t=mo.find(r=>It.existsSync(`${e}.${r}`));return t?`${e}.${t}`:null};var ke=console,Mt={id:"eslintPlugin",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["eslint-plugin-storybook"]||r["eslint-plugin-storybook"],s=t.eslint||r.eslint;if(n||!s)return null;let{mainConfig:a}=ys(o);if(!a)return ke.warn("Unable to find storybook main.js config, skipping"),null;let c,i;try{c=Nt()}catch(m){i=m.message}if(!c&&!i)return ke.warn("Unable to find .eslintrc config file, skipping"),null;let l=await _t(a);return{eslintFile:c,main:l,unsupportedExtension:i}},prompt(){return Vt`
      We've detected you are not using our eslint-plugin.

      In order to have the best experience with Storybook and follow best practices, we advise you to install eslint-plugin-storybook.

      More info: ${us.yellow("https://github.com/storybookjs/eslint-plugin-storybook#readme")}
    `},async run({result:{eslintFile:e,unsupportedExtension:o},packageManager:t,dryRun:r}){let n=["eslint-plugin-storybook"];if(ke.info(`\u2705 Adding dependencies: ${n}`),r||t.addDependencies({installAsDevDependencies:!0},n),!r&&o){ke.info(Vt`
          ⚠️ The plugin was successfully installed but failed to configure.
          
          Found an eslint config file with an unsupported automigration format: .eslintrc.${o}.
          The supported formats for this automigration are: ${mo.join(", ")}.

          Please refer to https://github.com/storybookjs/eslint-plugin-storybook#usage to finish setting up the plugin manually.
      `);return}if(ke.info(`\u2705 Adding Storybook plugin to ${e}`),!r)if(e.endsWith("json")){let s=await bs(e),a=Array.isArray(s.extends)?s.extends:[s.extends];s.extends=[...a||[],"plugin:storybook/recommended"];let c=await fs(e,"utf8"),i=hs(c).amount||2;await ks(e,s,{spaces:i})}else{let s=await _t(e),a=s.getFieldValue(["extends"])||[],c=Array.isArray(a)?a:[a];s.setFieldValue(["extends"],[...c,"plugin:storybook/recommended"]),await gs(s)}}};import uo from"chalk";import{dedent as ws}from"ts-dedent";import{readConfig as vs,writeConfig as xs}from"@storybook/csf-tools";import{getStorybookInfo as Ps}from"@storybook/core-common";var Ve=console,Gt={id:"builder-vite",async check({packageManager:e}){let o=e.retrievePackageJson(),{mainConfig:t}=Ps(o);if(!t)return Ve.warn("Unable to find storybook main.js config"),null;let r=await vs(t),n=r.getFieldValue(["core","builder"]);return(typeof n=="string"?n:n?.name)!=="storybook-builder-vite"?null:{builder:n,main:r,packageJson:o}},prompt({builder:e}){let o=uo.cyan(JSON.stringify(e,null,2));return ws`
      We've detected you're using the community vite builder: ${o}
      
      'storybook-builder-vite' is deprecated and now located at ${uo.cyan("@storybook/builder-vite")}.

      We can upgrade your project to use the new builder automatically.
      
      More info: ${uo.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#vite-builder-renamed")}
    `},async run({result:{builder:e,main:o,packageJson:t},packageManager:r,dryRun:n}){let{dependencies:s={},devDependencies:a={}}=t;if(Ve.info("Removing existing 'storybook-builder-vite' dependency"),n||(delete s["storybook-builder-vite"],delete a["storybook-builder-vite"],r.writePackageJson(t)),Ve.info("Adding '@storybook/builder-vite' as dev dependency"),n||r.addDependencies({installAsDevDependencies:!0},["@storybook/builder-vite"]),Ve.info("Updating main.js to use vite builder"),!n){let c=typeof e=="string"?"@storybook/builder-vite":{name:"@storybook/builder-vite",options:e.options};o.setFieldValue(["core","builder"],c),await xs(o)}}};import Bt from"chalk";import{dedent as Ss}from"ts-dedent";var Lt={id:"npm7",async check({packageManager:e}){if(e.type!=="npm")return null;let o=e.getNpmVersion();return e.needsLegacyPeerDeps(o)?{npmVersion:o}:null},prompt({npmVersion:e}){let o=Bt.cyan(`npm ${e}`);return Ss`
      We've detected you are running ${o} which has peer dependency semantics which Storybook is incompatible with.

      In order to work with Storybook's package structure, you'll need to run \`npm\` with the
      \`--legacy-peer-deps=true\` flag. We can generate an \`.npmrc\` which will do that automatically.
      
      More info: ${Bt.yellow("https://github.com/storybookjs/storybook/issues/18298")}
    `},async run({packageManager:e}){e.setLegacyPeerDeps()}};import D from"chalk";import{dedent as Cs}from"ts-dedent";import Ut from"semver";import{getStorybookInfo as Ts}from"@storybook/core-common";var F=console,js=e=>{let o={custom:{},official:{}};return Object.keys(e).forEach(t=>{t==="storybook"||t==="build-storybook"?o.official[t]=e[t]:(e[t].match(/start-storybook/)||e[t].match(/build-storybook/))&&(o.custom[t]=e[t])}),o},Wt={id:"sb-scripts",async check({packageManager:e}){let o=e.retrievePackageJson(),{scripts:t={},devDependencies:r,dependencies:n}=o,{version:s}=Ts(o),a={...n,...r},c=s&&Ut.coerce(s)?.version;if(!c)return F.warn(Cs`
        ❌ Unable to determine storybook version, skipping ${D.cyan("sb-scripts")} fix.
        🤔 Are you running automigrate from your project directory?
      `),null;if(a.sb||a.storybook)return null;let i=js(t);return Object.keys(i.official).length===0&&Object.keys(i.custom).length===0?null:(Object.keys(i.official).forEach(l=>{i.official[l]=i.official[l].replace("start-storybook","storybook dev").replace("build-storybook","storybook build")}),Ut.gte(c,"7.0.0")?{packageJson:o,storybookScripts:i,storybookVersion:s}:null)},prompt({storybookVersion:e}){let o=D.cyan(`Storybook ${e}`),t=[`Starting in Storybook 7, the ${D.yellow("start-storybook")} and ${D.yellow("build-storybook")} binaries have changed to ${D.magenta("storybook dev")} and ${D.magenta("storybook build")} respectively.`,`In order to work with ${o}, Storybook's ${D.magenta("storybook")} binary has to be installed and your storybook scripts have to be adjusted to use the binary. We can install the storybook binary and attempt to adjust your scripts for you.`].join(`
`);return[`We've detected you are using ${o} with scripts from previous versions of Storybook.`,t,`More info: ${D.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed")}`].filter(Boolean).join(`

`)},async run({result:{storybookScripts:e,packageJson:o},packageManager:t,dryRun:r}){if(F.log(),F.info("Adding 'storybook' as dev dependency"),F.log(),!r){let n=Oe(o);t.addDependencies({installAsDevDependencies:!0},[`storybook@${n}`])}if(F.info("Updating scripts in package.json"),F.log(),!r&&Object.keys(e.official).length>0){let n=["Migrating your scripts to:",D.yellow(JSON.stringify(e.official,null,2))].join(`
`);F.log(n),F.log(),t.addScripts(e.official)}if(!r&&Object.keys(e.custom).length>0){let n=["We detected custom scripts that we can't automigrate:",D.yellow(JSON.stringify(e.custom,null,2)),`
`,`Please manually migrate the ones applicable and use the documentation below for reference: ${D.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed")}`].join(`
`);F.log(n),F.log()}}};import z from"chalk";import go from"ts-dedent";import _e from"semver";import{readConfig as Rs,writeConfig as Ds}from"@storybook/csf-tools";import{getStorybookInfo as As}from"@storybook/core-common";var ce=console,Yt={"@storybook/react":{webpack5:"@storybook/react-webpack5",vite:"@storybook/react-vite"},"@storybook/preact":{webpack5:"@storybook/preact-webpack5"},"@storybook/server":{webpack5:"@storybook/server-webpack5"},"@storybook/angular":{webpack5:"@storybook/angular"},"@storybook/vue":{webpack5:"@storybook/vue-webpack5"},"@storybook/vue3":{webpack5:"@storybook/vue3-webpack5",vite:"@storybook/vue3-vite"},"@storybook/svelte":{webpack5:"@storybook/svelte-webpack5",vite:"@storybook/svelte-vite"},"@storybook/web-components":{webpack5:"@storybook/web-components-webpack5",vite:"@storybook/web-components-vite"},"@storybook/html":{webpack5:"@storybook/html-webpack5"}},Es=e=>typeof e=="string"?e.includes("vite")?"vite":"webpack5":e?.name.includes("vite")?"vite":"webpack5",Os=(e,o)=>o.getFieldValue([`${e}Options`])||{},Kt={id:"newFrameworks",async check({packageManager:e}){let o=e.retrievePackageJson(),t={...o.dependencies,...o.devDependencies},{mainConfig:r,version:n,framework:s}=As(o);if(!r)return ce.warn("Unable to find storybook main.js config, skipping"),null;let a=n&&_e.coerce(n)?.version;if(!a)return ce.warn(go`
        ❌ Unable to determine storybook version, skipping ${z.cyan("newFrameworks")} fix.
        🤔 Are you running automigrate from your project directory?
      `),null;if(!_e.gte(a,"7.0.0"))return null;let c=await Rs(r),i=c.getFieldValue(["framework"]),l=c.getFieldValue(["core","builder"]);if(!i||!Object.keys(Yt).includes(i))return null;let d={name:Es(l),options:c.getFieldValue(["core","builder","options"])||{}},f=Yt[i][d.name];if(!f)return null;if(t.vite&&_e.lt(_e.coerce(t.vite).version,"3.0.0"))return ce.warn(go`
        ❌ Detected Vite ${t.vite}, which is unsupported in Storybook 7.0, so the ${z.cyan("newFrameworks")} fix will be skipped.
      Please upgrade vite to 3.0.0 or higher and rerun this automigration with "npx storybook@future automigrate".
      `),null;let u=Os(s,c),h=["@storybook/builder-webpack5","@storybook/manager-webpack5","@storybook/builder-webpack4","@storybook/manager-webpack4","@storybook/builder-vite","storybook-builder-vite"].filter(me=>t[me]),J=[];return f!==i&&J.push(f),{main:c,dependenciesToAdd:J,dependenciesToRemove:h,frameworkPackage:f,frameworkOptions:u,builderInfo:d,packageJson:o}},prompt(){return go`
      We've detected you are using an older format of Storybook frameworks and builders.

      In Storybook 7, frameworks also specify the builder to be used.

      We can remove the dependencies that are no longer needed and install the new framework that already includes the builder.

      To learn more about the framework field, see: ${z.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory")}

      ${z.underline(z.bold(z.cyan("Webpack4 users")))}

      Unless you're using Storybook's Vite builder, this automigration will install a Webpack5-based framework.
      
      If you were using Storybook's Webpack4 builder (default in 6.x, discontinued in 7.0), this could be a breaking
      change--especially if your project has a custom webpack configuration.
      
      To learn more about migrating from Webpack4, see: ${z.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#webpack4-support-discontinued")}
    `},async run({result:{dependenciesToAdd:e,dependenciesToRemove:o,main:t,frameworkPackage:r,frameworkOptions:n,builderInfo:s,packageJson:a},packageManager:c,dryRun:i}){if(ce.info(`\u2705 Removing legacy dependencies: ${o.join(", ")}`),i||c.removeDependencies({skipInstall:e.length>0,packageJson:a},o),e.length>0&&(ce.info(`\u2705 Installing new dependencies: ${e.join(", ")}`),!i)){let l=Oe(a),m=e.map(d=>`${d}@${l}`);c.addDependencies({installAsDevDependencies:!0},m)}if(!i){ce.info("\u2705 Updating framework field in main.js");let l=t.getFieldValue(["core"]);t.setFieldValue(["framework","name"],r),t.setFieldValue(["framework","options"],n),l?.builder&&delete l.builder,Object.keys(s.options).length>0&&t.setFieldValue(["framework","options","builder"],s.options),l&&(Object.keys(l).length===0?t.setFieldValue(["core"],{}):t.setFieldValue(["core"],l)),await Ds(t)}}};import Me from"chalk";import Fs from"ts-dedent";import{getStorybookInfo as $s}from"@storybook/core-common";import{readFile as Js}from"fs-extra";var Ht=(a=>(a.addDecorator="addDecorator",a.addParameters="addParameters",a.addLoader="addLoader",a.getStorybook="getStorybook",a.setAddon="setAddon",a.clearDecorators="clearDecorators",a))(Ht||{}),qt={id:"removedglobalclientapis",async check({packageManager:e}){let o=e.retrievePackageJson(),{previewConfig:t}=$s(o);if(t){let r=await Js(t,"utf8"),n=Object.values(Ht).reduce((s,a)=>(r.includes(a)&&s.push(a),s),[]);if(n.length)return{usedAPIs:n,previewPath:t}}return null},prompt({usedAPIs:e,previewPath:o}){return Fs`
      The following APIs (used in "${Me.yellow(o)}") have been removed from Storybook:
      ${e.map(Me.cyan).join(", ")}

      You'll need to update "${Me.yellow(o)}" manually.

      Please see the migration guide for more information:
      ${Me.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#removed-global-client-apis")}
    `},async run(){console.log("Skipping automatic fix for removed global client APIs")}};import Xt from"chalk";import{dedent as Is}from"ts-dedent";import{basename as zt}from"path";import Zt from"fs-extra";import Ns from"globby";var Vs=/<style>{`/g,_s=/`}<\/style>/g,Ms=e=>e.replace(Vs,"<style>\n  {`").replace(_s,"  `}\n</style>"),Qt=console,er={id:"mdx1to2",async check(){let e=await Ns("./!(node_modules)**/*.(story|stories).mdx");return e.length?{storiesMdxFiles:e}:void 0},prompt({storiesMdxFiles:e}){return Is`
      We've found ${Xt.yellow(e.length)} '.stories.mdx' files in your project.
      
      Storybook has upgraded to MDX2 (https://mdxjs.com/blog/v2/), which contains breaking changes from V1.

      We can try to automatically upgrade your MDX files to MDX2 format using some common patterns.
      
      For a full guide for how to manually upgrade your files, see the MDX2 migration guide:
      
      ${Xt.cyan("https://mdxjs.com/migrating/v2/#update-mdx-files")}
    `},async run({result:{storiesMdxFiles:e},dryRun:o}){await Promise.all(e.map(async t=>{let r=await Zt.readFile(t,"utf-8"),n=Ms(r);n===r?Qt.info(`\u{1F197} Unmodified ${zt(t)}`):(Qt.info(`\u2705 Modified ${zt(t)}`),o||await Zt.writeFile(t,n))}))}};import or from"chalk";import{dedent as Gs}from"ts-dedent";import{readConfig as Bs,writeConfig as Ls}from"@storybook/csf-tools";import{getStorybookInfo as Us}from"@storybook/core-common";var tr=console,rr={id:"docsPageAutomatic",async check({packageManager:e}){let o=e.retrievePackageJson(),{mainConfig:t}=Us(o);if(!t)return tr.warn("Unable to find storybook main.js config, skipping"),null;let r=await Bs(t);return r.getFieldValue(["docs"])?.docsPage===void 0?{main:r}:null},prompt(){let e=or.cyan("docs: { docsPage: 'automatic' }");return Gs`
      We've detected that your main.js configuration file has not configured docsPage. In 6.x we
      we defaulted to having a docsPage for every story, in 7.x you need to opt in per-component.
      However, we can set the \`docs.docsPage\` to 'automatic' to approximate the old behaviour:

      ${e}

      More info: ${or.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#docs-page")}
    `},async run({result:{main:e},dryRun:o}){tr.info("\u2705 Setting 'docs.docsPage' to 'automatic' in main.js"),o||(e.setFieldValue(["docsPage","docs"],"automatic"),await Ls(e))}};var Ge=[Rt,R,At,Ot,Jt,Mt,Gt,Lt,Wt,Kt,qt,er,rr];var x=console,le=async({fixId:e,dryRun:o,yes:t,useNpm:r,force:n}={})=>{let s=O.getPackageManager({useNpm:r,force:n}),a=e?Ge.filter(c=>c.id===e):Ge;x.info("\u{1F50E} checking possible migrations..");for(let c=0;c<a.length;c+=1){let i=Ge[c],l;try{l=await i.check({packageManager:s})}catch{x.info(`failed to check fix: ${i.id}`)}if(l){x.info(`\u{1F50E} found a '${pe.cyan(i.id)}' migration:`),x.info();let m=i.prompt(l);x.info(Ys(m,{borderStyle:"round",padding:1,borderColor:"#F1618C"}));let d;if(o?d={fix:!1}:t?d={fix:!0}:d=await Ws({type:"confirm",name:"fix",message:`Do you want to run the '${pe.cyan(i.id)}' migration on your project?`}),d.fix)try{await i.run({result:l,packageManager:s,dryRun:o}),x.info(`\u2705 ran ${pe.cyan(i.id)} migration`)}catch(f){x.info(`\u274C error when running ${pe.cyan(i.id)} migration:`),x.info(f),x.info()}else x.info(`Skipping the ${pe.cyan(i.id)} migration.`),x.info(),x.info(`If you change your mind, run '${pe.cyan("npx storybook@next automigrate")}'`)}}x.info(),x.info("\u2705 migration check successfully ran"),x.info()};var v=console,nr=(e,o,t)=>{let r={installAsDevDependencies:!0,skipInstall:t.skipInstall},n;try{n=o.readPackageJson()}catch{}let a={language:Mo(n),builder:t.builder||_o(o),linkable:!!t.linkable,commonJs:t.commonJs,pnp:t.usePnp};return(async()=>{switch(e){case"ALREADY_HAS_STORYBOOK":return v.log(),S("There seems to be a Storybook already available in this project."),S(`Apply following command to force:
`),Ae(["sb init [options] -f"]),v.log(),Promise.resolve();case"REACT_SCRIPTS":return dt(o,r,a).then(y('Adding Storybook support to your "Create React App" based project'));case"REACT":return so(o,r,a).then(y(`Adding Storybook support to your "React" app
`));case"REACT_NATIVE":return(t.yes?Promise.resolve({server:!0}):yo([{type:"confirm",name:"server",message:"Do you want to install dependencies necessary to run Storybook server? You can manually do it later by install @storybook/react-native-server",initial:!1}])).then(({server:i})=>ct(o,r,i)).then(y(`Adding Storybook support to your "React Native" app
`));case"WEBPACK_REACT":return ft(o,r,a).then(y(`Adding Storybook support to your "Webpack React" app
`));case"REACT_PROJECT":return so(o,r,a).then(y(`Adding Storybook support to your "React" library
`));case"NEXTJS":return mt(o,r,a).then(y(`Adding Storybook support to your "Next" app
`));case"SFC_VUE":return ut(o,r,a).then(y(`Adding Storybook support to your "Single File Components Vue" app
`));case"VUE":return gt(o,r,a).then(y(`Adding Storybook support to your "Vue" app
`));case"VUE3":return yt(o,r,a).then(y(`Adding Storybook support to your "Vue 3" app
`));case"ANGULAR":return nt(o,r,a).then(y(`Adding Storybook support to your "Angular" app
`));case"EMBER":return at(o,r,a).then(y(`Adding Storybook support to your "Ember" app
`));case"MITHRIL":return bt(o,r,a).then(y(`Adding Storybook support to your "Mithril" app
`));case"MARIONETTE":return kt(o,r,a).then(y(`Adding Storybook support to your "Marionette.js" app
`));case"MARKO":return ht(o,r,a).then(y(`Adding Storybook support to your "Marko" app
`));case"HTML":return wt(o,r,a).then(y(`Adding Storybook support to your "HTML" app
`));case"WEB_COMPONENTS":return vt(o,r,a).then(y(`Adding Storybook support to your "web components" app
`));case"RIOT":return xt(o,r,a).then(y(`Adding Storybook support to your "riot.js" app
`));case"PREACT":return Pt(o,r,a).then(y(`Adding Storybook support to your "Preact" app
`));case"SVELTE":return St(o,r,a).then(y(`Adding Storybook support to your "Svelte" app
`));case"RAX":return Ct(o,r,a).then(y(`Adding Storybook support to your "Rax" app
`));case"AURELIA":return st(o,r,a).then(y(`Adding Storybook support to your "Aurelia" app
`));case"SERVER":return Tt(o,r,a).then(y(`Adding Storybook support to your "Server" app
`));case"UNSUPPORTED":return S("We detected a project type that we don't support yet."),S("If you'd like your framework to be supported, please let use know about it at https://github.com/storybookjs/storybook/issues"),v.log(),Promise.resolve();default:return S(`We couldn't detect your project type. (code: ${e})`),S("You can specify a project type explicitly via `sb init --type <type>`, see our docs on how to configure Storybook for your framework: https://storybook.js.org/docs/react/get-started/install"),v.log(),qs(t,o)}})().catch(i=>{v.error(`
     ${he.red(i.stack)}`),process.exit(1)})},qs=async(e,o)=>{let t=e.yes?!0:await yo([{type:"confirm",name:"manual",message:"Do you want to manually choose a Storybook project type to install?"}]);if(t!==!0&&t.manual){let r=await yo([{type:"select",name:"manualFramework",message:"Please choose a project type from the following list:",choices:Re.map(n=>({title:n,value:n.toUpperCase()}))}]);return nr(r.manualFramework,o,e)}return Promise.resolve()};async function Xs(e,o){let{useNpm:t,packageManager:r}=e;t&&ne();let n=O.getPackageManager({useNpm:t,force:r}),s="storybook init - the simplest way to add a Storybook to your project.";v.log(he.inverse(`
 ${s} 
`)),e.disableTelemetry||Ks("init",{},{stripMetadata:!0});let{default:a}=await import("update-notifier");a({pkg:o,updateCheckInterval:1e3*60*60}).notify();let c,i=e.type,l=i?`Installing Storybook for user specified project type: ${i}`:"Detecting project type",m=y(l),d=n.retrievePackageJson(),f=d&&d.type==="module";try{i?Re.includes(i)?c=Qe(d,e.force)?"ALREADY_HAS_STORYBOOK":i.toUpperCase():(m(`The provided project type was not recognized by Storybook: ${i}`),v.log(`
The project types currently supported by Storybook are:
`),Re.sort().forEach(u=>S(`- ${u}`)),v.log(),process.exit(1)):c=Go(d,e)}catch(u){m(u.message),process.exit(1)}if(m(),await nr(c,n,{...e,...f?{commonJs:!0}:void 0}),e.skipInstall||n.installDependencies(),await le({yes:e.yes||p.CI==="true",useNpm:t,force:r}),v.log(`
To run your Storybook, type:
`),Ae([n.getRunStorybookCommand()]),v.log(`
For more information visit:`,he.cyan("https://storybook.js.org")),c==="REACT_NATIVE"){let u="https://github.com/storybookjs/react-native";v.log(),v.log(he.red("NOTE: installation is not 100% automated.")),v.log(`To quickly run Storybook, replace contents of your app entry with:
`),Ae(["export {default} from './storybook';"]),v.log(`
 For more in information, see the github readme:
`),v.log(he.cyan(u)),v.log()}v.log()}async function sr(e,o){await Hs("init",{cliOptions:e},()=>Xs(e,o))}import ar from"path";import Be from"fs";import{sync as zs}from"cross-spawn";import{getStorybookInfo as Zs}from"@storybook/core-common";import{readConfig as Qs,writeConfig as ea}from"@storybook/csf-tools";var de=console,oa=["addons","config","presets"],ta=async(e,o)=>{let t=null;o?Be.existsSync(".storybook")?(t="no codmods found",oa.forEach(r=>{try{let n=M.resolve(`${getPackageName(e,o)}/postinstall/${r}.js`);y(`Running postinstall script for ${e}`)();let s=ar.join(".storybook",`${r}.ts`);Be.existsSync(s)||(s=ar.join(".storybook",`${r}.js`),Be.existsSync(s)||Be.writeFileSync(s,"","utf8")),zs("npx",["jscodeshift","-t",n,s],{stdio:"inherit",shell:!0}),t=null}catch{}})):t="no .storybook config":t="unofficial addon",t&&y(`Skipping postinstall for ${e}, ${t}`)()},ra=e=>{let o=/^(...*)@(.*)$/.exec(e);return o?[o[1],o[2]]:[e,void 0]};async function ir(e,o){let{useNpm:t,packageManager:r}=o;t&&ne();let n=O.getPackageManager({useNpm:t,force:r}),s=n.retrievePackageJson(),[a,c]=ra(e),{mainConfig:i,version:l}=Zs(s);if(!i){de.error("Unable to find storybook main.js config");return}let m=await Qs(i),d=m.getFieldValue(["addons"]);d&&!Array.isArray(d)&&de.error("Expected addons array in main.js config"),de.log(`Verifying ${a}`);let f=n.latestVersion(a);f||de.error(`Unknown addon ${a}`);let u=a.startsWith("@storybook/"),J=`${a}@${c||(u?l:f)}`;de.log(`Installing ${J}`),n.addDependencies({installAsDevDependencies:!0},[J]),de.log(`Adding '${e}' to main.js addons field.`);let me=[...d||[],a];m.setFieldValue(["addons"],me),await ea(m),o.skipPostinstall||await ta(e,u)}import{listCodemods as na,runCodemod as sa}from"@storybook/codemod";async function cr(e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,logger:a,parser:c}){if(n)na().forEach(i=>a.log(i));else if(e)await sa(e,{configDir:o,glob:t,dryRun:r,logger:a,rename:s,parser:c});else throw new Error("Migrate: please specify a migration name or --list")}import dr from"path";import{writeFile as aa,stat as ia}from"fs-extra";import pr from"puppeteer-core";import lr from"express";import ca from"get-port";import{logger as mr}from"@storybook/node-logger";var pa=async e=>{let o=await da(),t=await o.newPage();await t.goto(e),await t.waitForFunction(`
    (window.__STORYBOOK_PREVIEW__ && window.__STORYBOOK_PREVIEW__.extract && window.__STORYBOOK_PREVIEW__.extract()) ||
    (window.__STORYBOOK_STORY_STORE__ && window.__STORYBOOK_STORY_STORE__.extract && window.__STORYBOOK_STORY_STORE__.extract())
  `);let r=JSON.parse(await t.evaluate(async()=>JSON.stringify(window.__STORYBOOK_STORY_STORE__.getStoriesJsonData(),null,2)));return setImmediate(()=>{o.close()}),r},la=async e=>{if(await ia(dr.resolve(e)),e.match(/^http/))return[e,async()=>{}];let o=lr();o.use(lr.static(e));let t=await ca();return new Promise(r=>{let n=o.listen(t,()=>{let s=`http://localhost:${t}/iframe.html`;mr.info(`connecting to: ${s}`),r([s,n.close.bind(n)])})})},da=async()=>{let e=["--no-sandbox ","--disable-setuid-sandbox"];try{return await pr.launch({args:e,executablePath:p.SB_CHROMIUM_PATH})}catch{return mr.info("installing puppeteer..."),new Promise((t,r)=>{M("child_process").exec(`node ${M.resolve(dr.join("puppeteer-core","install.js"))}`,n=>n?r(n):t(pr.launch({args:e})))})}};async function ur(e,o){if(e&&o){let[t,r]=await la(e),n=await pa(t);await aa(o,JSON.stringify(n,null,2)),await r()}else throw new Error("Extract: please specify a path where your built-storybook is (can be a public url) and a target directory")}import{sync as yr}from"cross-spawn";import{telemetry as ma}from"@storybook/telemetry";import we from"semver";import{logger as L}from"@storybook/node-logger";import{withTelemetry as ua}from"@storybook/core-server";var ga=/(@storybook\/[^@]+)@(\S+)/,ya=e=>{if(e.startsWith("npm "))return null;let o=ga.exec(e);return!o||!we.clean(o[2])?null:{package:o[1],version:o[2]}},fa=["@storybook/addon-bench","@storybook/addon-console","@storybook/addon-postcss","@storybook/babel-plugin-require-context-hook","@storybook/bench","@storybook/builder-vite","@storybook/csf","@storybook/design-system","@storybook/ember-cli-storybook","@storybook/eslint-config-storybook","@storybook/expect","@storybook/jest","@storybook/linter-config","@storybook/mdx1-csf","@storybook/mdx2-csf","@storybook/react-docgen-typescript-plugin","@storybook/storybook-deployer","@storybook/test-runner","@storybook/testing-library","@storybook/testing-react"],ba=e=>e.startsWith("@storybook/")&&!e.startsWith("@storybook/preset-")&&!fa.includes(e),ka=[{minVersion:"6.0.0-alpha.0",url:"https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#60-deprecations",deprecations:["@storybook/addon-notes","@storybook/addon-info","@storybook/addon-contexts","@storybook/addon-options","@storybook/addon-centered"]}],fr=e=>`${e.package}@${e.version}`,gr=e=>e.forEach(o=>L.warn(`- ${fr(o)}`)),ha=()=>{let o=yr("npm",["ls"],{stdio:"pipe",shell:!0}).output.toString().split(`
`).map(ya).filter(Boolean).filter(n=>ba(n.package));if(!o.length){L.warn("No storybook core packages found."),L.warn("'npm ls | grep storybook' can show if multiple versions are installed.");return}o.sort((n,s)=>we.rcompare(n.version,s.version));let t=o[0].version,r=o.filter(n=>n.version!==t);r.length>0&&(L.warn(`Found ${r.length} outdated packages (relative to '${fr(o[0])}')`),L.warn("Please make sure your packages are updated to ensure a consistent experience."),gr(r)),ka.forEach(({minVersion:n,url:s,deprecations:a})=>{if(we.gte(t,n)){let c=o.filter(i=>a.includes(i.package));c.length>0&&(L.warn(`Found ${c.length} deprecated packages since ${n}`),L.warn(`See ${s}`),gr(c))}})},wa={"react-scripts@<5":["--reject","/preset-create-react-app/"]},va=(e,o,{dependencies:t,devDependencies:r})=>Object.entries(e).reduce((n,s)=>{let[a,c]=s,[i,l]=X(a),m=t[i]||r[i];return m&&we.satisfies(we.coerce(m),l)?[...n,...c]:n},[...o]),xa=async({prerelease:e,skipCheck:o,useNpm:t,packageManager:r,dryRun:n,yes:s,...a})=>{t&&ne();let c=O.getPackageManager({useNpm:t,force:r});y("Checking for latest versions of '@storybook/*' packages"),a.disableTelemetry||ma("upgrade",{prerelease:e});let i=[];n||i.push("--upgrade"),i.push("--target"),i.push(e?"greatest":"latest"),i=va(wa,i,c.retrievePackageJson());let l=yr("npx",["npm-check-updates@latest","/storybook/",...i],{stdio:"pipe",shell:!0}).output.toString();L.info(l),n||(y("Installing upgrades"),c.installDependencies()),o||(ha(),await le({dryRun:n,yes:s,useNpm:t,force:r}))};async function br(e){await ua("upgrade",{cliOptions:e},()=>xa(e))}import wo from"prompts";import oi from"fs";import vr from"path";import ve from"chalk";import xr from"boxen";import{dedent as Pr}from"ts-dedent";import C from"path";import{readJSON as kr,writeJSON as ho,outputFile as Ga}from"fs-extra";import hr from"shelljs";import Ba from"chalk";import{command as La}from"execa";var Ue={};Lr(Ue,{angular:()=>Oa,angular12:()=>Da,angular13:()=>Ea,angular130:()=>Aa,cra:()=>fo,cra_typescript:()=>bo,html:()=>Na,nextjs:()=>Ta,nextjs_typescript:()=>ja,preact:()=>Va,react:()=>Pa,react_in_yarn_workspace:()=>Ra,react_legacy_root_api:()=>Sa,react_typescript:()=>Ca,sfcVue:()=>_a,svelte:()=>Ma,vue:()=>Ja,vue3:()=>Ia,web_components:()=>ko,web_components_lit2:()=>$a,web_components_typescript:()=>Fa});var Z=(...e)=>["mkdir {{appName}}","cd {{appName}}","touch yarn.lock","yarn init --yes",e.length&&`yarn add ${e.join(" ")}`].filter(Boolean).join(" && "),fo={renderer:"react",name:"cra",version:"latest",generator:["npm_config_user_agent=npm npx -p create-react-app@{{version}} create-react-app {{appName}}","cd {{appName}}",'echo "FAST_REFRESH=true" > .env','echo "SKIP_PREFLIGHT_CHECK=true" > .env'].join(" && ")},bo={renderer:"react",name:"cra_typescript",version:"latest",generator:["npm_config_user_agent=npm npx -p create-react-app@{{version}} create-react-app {{appName}} --template typescript"].join(" && ")},Pa={renderer:"react",name:"react",version:"latest",generator:Z("react","react-dom","@babel/preset-react"),additionalDeps:["prop-types"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react"] }'}]},Sa={renderer:"react",name:"react_legacy_root_api",version:"latest",generator:Z("react","react-dom"),additionalDeps:["prop-types","@babel/preset-react"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react"] }'}],mainOverrides:{reactOptions:{legacyRootApi:!0}}},Ca={renderer:"react",name:"react_typescript",version:"latest",generator:Z("react","react-dom"),typescript:!0,additionalDeps:["@babel/preset-react","@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react", "@babel/preset-typescript"] }'}]},Ta={renderer:"react",name:"nextjs",version:"latest",generator:["npm_config_user_agent=npm npx -p create-next-app@{{version}} create-next-app {{appName}}","cd {{appName}}"].join(" && ")},ja={renderer:"react",name:"nextjs_typescript",version:"latest",generator:["npm_config_user_agent=npm npx -p create-next-app@{{version}} create-next-app {{appName}} --typescript","cd {{appName}}"].join(" && ")},Ra={renderer:"react",name:"react_in_yarn_workspace",version:"latest",generator:["mkdir {{appName}}","cd {{appName}}",'echo "{ \\"name\\": \\"workspace-root\\", \\"private\\": true, \\"workspaces\\": [] }" > package.json',"touch yarn.lock","yarn add react react-dom"].join(" && ")},Le={renderer:"angular",name:"angular",version:"latest",generator:"npx -p @angular/cli@{{version}} ng new {{appName}} --routing=true --minimal=true --style=scss --skip-install=true --strict"},Da={...Le,name:"angular12",version:"v12-lts"},Aa={...Le,name:"angular130",version:"13.0.x"},Ea={...Le,name:"angular13",version:"13.1.x"},Oa=Le,ko={renderer:"web-components",name:"web_components",version:"2",generator:Z("lit-element")},Fa={...ko,name:"web_components_typescript",typescript:!0,additionalDeps:["@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-typescript"] }'}]},$a={...ko,version:"next",name:"web_components_lit2",generator:Z("lit"),typescript:!0,additionalDeps:["@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-typescript"] }'}]},Ja={renderer:"vue",name:"vue",version:"latest",generator:['npx -p @vue/cli vue create {{appName}} --default --packageManager=yarn --force --merge --preset="Default (Vue 2)"'].join(" && ")},Ia={renderer:"vue3",name:"vue3",version:"next",generator:["npx -p @vue/cli@^4 vue create {{appName}} --preset=__default_vue_3__ --packageManager=npm --no-git --force"].join(" && ")},Na={renderer:"html",name:"html",version:"latest",generator:Z(),autoDetect:!1},Va={renderer:"preact",name:"preact",version:"latest",generator:"npx preact-cli@{{version}} create preactjs-templates/default {{appName}} --install=false --git=false"},_a={renderer:"vue",name:"sfcVue",version:"latest",generator:Z("vue@2.6","vue-loader@15.9","vue-template-compiler@2.6","webpack")},Ma={renderer:"svelte",name:"svelte",version:"latest",generator:"npx degit sveltejs/template {{appName}}"};var P=console,w=async(e,o={},{startMessage:t,errorMessage:r,dryRun:n}={})=>{if(t&&P.info(t),n){P.info(`
> ${e}
`);return}return P.debug(e),new Promise((s,a)=>{let c={silent:!1},i=hr.exec(e,{...c,...o,async:!0,silent:!1});i.stderr.pipe(process.stderr),i.on("exit",l=>{l===0?s(void 0):(P.error(Ba.red(`An error occurred while executing: \`${e}\``)),P.log(r),a(new Error(`command exited with code: ${l}: `)))})})},Ua=async({cwd:e})=>{P.info("\u{1F522} Adding package resolutions:");let o=C.join(e,"package.json"),t=await kr(o);t.resolutions=j,await ho(o,t,{spaces:2})},Wa=async({cwd:e})=>{P.info("\u{1F522} Adding package resolutions:");let o=C.join(e,"package.json"),t=await kr(o),r=C.join(__dirname,"..","..","..","..",".."),{stdout:n}=await La("yarn workspaces list --json",{cwd:r});console.log({stdout:n,workspaceDir:r});let s=JSON.parse(`[${n.split(`
`).join(",")}]`);console.log({workspaces:s}),t.resolutions=Object.keys(j).reduce((a,c)=>({...a,[c]:C.join(r,s.find(i=>i.name===c).location)}),{}),await ho(o,t,{spaces:2})},Ya=async({cwd:e,pnp:o,name:t})=>{let r=["yarn set version berry","yarn config set enableGlobalCache true",`yarn config set nodeLinker ${o?"pnp":"node-modules"}`];[fo.name,bo.name].includes(t)&&r.push(`yarn config set packageExtensions --json '{ "babel-preset-react-app@10.0.x": { "dependencies": { "@babel/plugin-proposal-private-property-in-object": "^7.16.0" } } }'`),await w(r.join(" && "),{cwd:e},{startMessage:"\u{1F9F6} Installing Yarn 2",errorMessage:"\u{1F6A8} Installing Yarn 2 failed"})},Ka=async({cwd:e})=>{let o=[`yarn config set npmScopes --json '{ "storybook": { "npmRegistryServer": "http://localhost:6001/" } }'`,`yarn config set unsafeHttpWhitelist --json '["localhost"]'`,"yarn config set pnpFallbackMode none","yarn config set enableImmutableInstalls false",`yarn config set logFilters --json '[ { "code": "YN0013", "level": "discard" } ]'`].join(" && ");await w(o,{cwd:e},{startMessage:"\u{1F39B} Configuring Yarn 2",errorMessage:"\u{1F6A8} Configuring Yarn 2 failed"})},Ha=async({cwd:e,name:o,appName:t,version:r,generator:n})=>{let s=n.replace(/{{appName}}/g,t).replace(/{{version}}/g,r);await w(s,{cwd:e},{startMessage:`\u{1F3D7} Bootstrapping ${o} project (this might take a few minutes)`,errorMessage:`\u{1F6A8} Bootstrapping ${o} failed`})},qa=async({additionalFiles:e,cwd:o})=>{P.info("\u2935\uFE0F Adding required files"),await Promise.all(e.map(async t=>{await Ga(C.resolve(o,t.path),t.contents,{encoding:"UTF-8"})}))},Xa=async({cwd:e,autoDetect:o=!0,name:t,e2e:r,pnp:n})=>{let s=["--yes"];o||s.push(`--type ${t}`),r&&s.push("--linkable"),n&&s.push("--use-pnp");let c=`${`node ${__filename}`} init ${s.join(" ")}`;await w(c,{cwd:e},{startMessage:"\u{1F3A8} Initializing Storybook with @storybook/cli",errorMessage:"\u{1F6A8} Storybook initialization failed"})},za=async({cwd:e,additionalDeps:o})=>{hr.rm("-f",C.join(e,"package-lock.json"),C.join(e,"yarn.lock"));let t=o&&o.length>0?`yarn add -D ${o.join(" ")}`:"yarn install";await w(t,{cwd:e},{startMessage:"\u{1F30D} Adding needed deps & installing all deps",errorMessage:"\u{1F6A8} Dependencies installation failed"})},Za=async({cwd:e})=>{P.info("\u{1F46E} Adding typescript and tsconfig.json");try{await w("yarn add -D typescript@latest",{cwd:e});let o={compilerOptions:{baseUrl:".",esModuleInterop:!0,jsx:"preserve",skipLibCheck:!0,strict:!0},include:["src/*"]},t=C.resolve(e,"tsconfig.json");await ho(t,o,{encoding:"utf8",spaces:2})}catch(o){throw P.error("\u{1F6A8} Creating tsconfig.json failed"),o}},N=async(e,o,t=!0)=>{t&&(await e(o),P.log())},Qa=e=>w(`npm ${["config","set","registry",e].join(" ")}`,{cwd:C.join(process.cwd(),"..")}),ei=e=>w(`yarn ${["config","set","npmRegistryServer",e].join(" ")}`,{cwd:C.join(__dirname,"..")}),wr=async(e,{name:o,version:t,...r},{e2e:n,pnp:s,local:a,registry:c})=>{let i={name:o,version:t,appName:C.basename(e),creationPath:C.join(e,".."),cwd:e,e2e:n,pnp:s,...r};P.log(),P.info(`\u{1F3C3} Starting for ${o} ${t}`),P.log(),await N(Ha,{...i,cwd:i.creationPath}),await N(qa,{...i,cwd:e},!!i.additionalFiles),n&&await N(Ua,i),a&&await N(Wa,i),await N(Ya,i),n&&await N(Ka,i,n),await N(Za,i,!!i.typescript),await N(za,i),c&&(await Qa(c),await ei(c)),await N(Xa,i)};var U=console,ti=Ue,ri=Object.fromEntries(Object.entries(Ue).filter(e=>e[0]!=="react_in_yarn_workspace")),vo=Object.values(ri).reduce((e,o)=>(e[o.renderer]=[...e[o.renderer]||[],o],e),{}),Sr=async({outputDirectory:e,list:o,template:t,renderer:r,generator:n,e2e:s,local:a,registry:c,pnp:i})=>{if(U.info(xr(Pr`
        🤗 Welcome to ${ve.yellow("sb repro")}! 🤗 

        Create a ${ve.green("new project")} to minimally reproduce Storybook issues.
        
        1. select an environment that most closely matches your project setup.
        2. select a location for the reproduction, outside of your project.
        
        After the reproduction is ready, we'll guide you through the next steps.
        `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),o){U.info("\u{1F308} Available templates"),Object.entries(vo).forEach(([u,h])=>{U.info(u),h.forEach(J=>U.info(`- ${J.name}`)),u==="other"&&U.info("- blank")});return}let l=t,m=r;if(!l&&!n){if(!m){let{renderer:u}=await wo({type:"select",message:"\u{1F308} Select the repro renderer",name:"renderer",choices:Object.keys(vo).map(h=>({title:h,value:h}))});m=u}if(!m)throw new Error("\u{1F6A8} Repro: please select a renderer!");l=(await wo({type:"select",message:"\u{1F4DD} Select the repro base template",name:"template",choices:vo[m].map(u=>({title:u.name,value:u.name}))})).template}let d=n?{name:"custom",version:"custom",generator:n}:ti[l];if(!d)throw new Error("\u{1F6A8} Repro: please specify a valid template type");let f=e;if(!f){let{directory:u}=await wo({type:"text",message:"Enter the output directory",name:"directory",initial:d.name,validate:h=>oi.existsSync(h)?`${h} already exists. Please choose another name.`:!0});f=u}try{let u=vr.isAbsolute(f)?f:vr.join(process.cwd(),f);U.info(`\u{1F3C3} Running ${l} into ${u}`),await wr(u,d,{registry:c,e2e:!!s,pnp:!!i,local:!!a}),s||await ni(u),U.info(xr(Pr`
        🎉 Your Storybook reproduction project is ready to use! 🎉

        ${ve.yellow(`cd ${f}`)}
        ${ve.yellow("yarn storybook")}

        Once you've recreated the problem you're experiencing, please:
        
        1. Document any additional steps in ${ve.cyan("README.md")}
        2. Publish the repository to github
        3. Link to the repro repository in your issue

        Having a clean repro helps us solve your issue faster! 🙏
      `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"}))}catch(u){throw U.error("\u{1F6A8} Failed to create repro"),u}},ni=async e=>{await w("git init",{cwd:e}),await w('echo "node_modules" >> .gitignore',{cwd:e}),await w("git add --all",{cwd:e}),await w('git commit -am "added storybook"',{cwd:e}),await w("git tag repro-base",{cwd:e})};import jr from"prompts";import Cr from"path";import W from"chalk";import xo from"boxen";import{dedent as Po}from"ts-dedent";import hi from"degit";import{existsSync as Tr}from"fs-extra";var si={"cra/default-js":{name:"Create React App (Javascript)",script:"npx create-react-app .",cadence:["daily","weekly"],expected:{framework:"@storybook/react-webpack5",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}},"cra/default-ts":{name:"Create React App (Typescript)",script:"npx create-react-app . --template typescript",cadence:["ci","daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/react-webpack5",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}}},ai={"nextjs/default-js":{name:"Next.js (JavaScript)",script:"npx create-next-app {{beforeDir}}",cadence:["daily","weekly"],expected:{framework:"@storybook/nextjs",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}},"nextjs/default-ts":{name:"Next.js (TypeScript)",script:"npx create-next-app {{beforeDir}} --typescript",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/nextjs",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}}},ii={"react-vite/default-js":{name:"React Vite (JS)",script:"yarn create vite . --template react",cadence:["daily","weekly"],expected:{framework:"@storybook/react-vite",renderer:"@storybook/react",builder:"@storybook/builder-vite"}},"react-vite/default-ts":{name:"React Vite (TS)",script:"yarn create vite . --template react-ts",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/react-vite",renderer:"@storybook/react",builder:"@storybook/builder-vite"}}},ci={"react-webpack/18-ts":{name:"React Webpack5 (TS)",script:"yarn create webpack5-react .",cadence:["daily","weekly"],expected:{framework:"@storybook/react-webpack5",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}},"react-webpack/17-ts":{name:"React Webpack5 (TS)",script:'yarn create webpack5-react . --version-react="17" --version-react-dom="17"',cadence:["daily","weekly"],expected:{framework:"@storybook/react-webpack5",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}}},pi={"vue3-vite/default-js":{name:"Vue3 Vite (JS)",script:"yarn create vite . --template vue",cadence:["daily","weekly"],expected:{framework:"@storybook/vue3-vite",renderer:"@storybook/vue3",builder:"@storybook/builder-vite"}},"vue3-vite/default-ts":{name:"Vue3 Vite (TS)",script:"yarn create vite . --template vue-ts",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/vue3-vite",renderer:"@storybook/vue3",builder:"@storybook/builder-vite"}}},li={"vue2-vite/2.7-js":{name:"Vue2 Vite (vue 2.7 JS)",script:`yarn create vite . --template vanilla && yarn add --dev @vitejs/plugin-vue2 vue-template-compiler vue@2 && echo "import vue2 from '@vitejs/plugin-vue2';

export default {
	plugins: [vue2()]
};" > vite.config.js`,cadence:["daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/vue-vite",renderer:"@storybook/vue",builder:"@storybook/builder-vite"}}},di={"html-webpack/default":{name:"HTML Webpack5",script:"yarn create webpack5-html .",cadence:["daily","weekly"],expected:{framework:"@storybook/html-webpack5",renderer:"@storybook/html",builder:"@storybook/builder-webpack5"}}},mi={"svelte-vite/default-js":{name:"Svelte Vite (JS)",script:"yarn create vite . --template svelte",cadence:["daily","weekly"],expected:{framework:"@storybook/svelte-vite",renderer:"@storybook/svelte",builder:"@storybook/builder-vite"}},"svelte-vite/default-ts":{name:"Svelte Vite (TS)",script:"yarn create vite . --template svelte-ts",cadence:["ci","daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/svelte-vite",renderer:"@storybook/svelte",builder:"@storybook/builder-vite"}}},ui={"angular-cli/default-ts":{name:"Angular CLI (latest)",script:"npx -p @angular/cli ng new angular-latest --directory . --routing=true --minimal=true --style=scss --strict --skip-git --skip-install --package-manager=yarn",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/angular",renderer:"@storybook/angular",builder:"@storybook/builder-webpack5"}},"angular-cli/13-ts":{name:"Angular CLI (Version 13)",script:"npx -p @angular/cli@13 ng new angular-v13 --directory . --routing=true --minimal=true --style=scss --strict --skip-git --skip-install --package-manager=yarn",cadence:["daily","weekly"],expected:{framework:"@storybook/angular",renderer:"@storybook/angular",builder:"@storybook/builder-webpack5"}}},gi={"svelte-kit/skeleton-js":{name:"Svelte Kit (JS)",script:"yarn create svelte-with-args --name=svelte-kit/skeleton-js --directory=. --template=skeleton --types=null --no-prettier --no-eslint --no-playwright",cadence:["daily","weekly"],expected:{framework:"@storybook/svelte-vite",renderer:"@storybook/svelte",builder:"@storybook/builder-vite"}},"svelte-kit/skeleton-ts":{name:"Svelte Kit (TS)",script:"yarn create svelte-with-args --name=svelte-kit/skeleton-ts --directory=. --template=skeleton --types=typescript --no-prettier --no-eslint --no-playwright",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/svelte-vite",renderer:"@storybook/svelte",builder:"@storybook/builder-vite"}}},yi={"lit-vite/default-js":{name:"Lit Vite (JS)",script:"yarn create vite . --template lit",cadence:["daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/web-components-vite",renderer:"@storybook/web-components",builder:"@storybook/builder-vite"}},"lit-vite/default-ts":{name:"Lit Vite (TS)",script:"yarn create vite . --template lit-ts",cadence:["ci","daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/web-components-vite",renderer:"@storybook/web-components",builder:"@storybook/builder-vite"}}},fi={"vue-cli/default-js":{name:"Vue-CLI (Default JS)",script:"npx -p @vue/cli vue create . --default --packageManager=yarn --force --merge",cadence:["daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/vue3-webpack5",renderer:"@storybook/vue3",builder:"@storybook/builder-webpack5"}},"vue-cli/vue2-default-js":{name:"Vue-CLI (Vue2 JS)",script:'npx -p @vue/cli vue create . --default --packageManager=yarn --force --merge --preset="Default (Vue 2)"',cadence:["ci","daily","weekly"],skipTasks:["smoke-test"],expected:{framework:"@storybook/vue-webpack5",renderer:"@storybook/vue",builder:"@storybook/builder-webpack5"}}},bi={"preact-webpack5/default-js":{name:"Preact CLI (Default JS)",script:"npx preact-cli create default {{beforeDir}} --name preact-app --yarn --no-install",cadence:["daily","weekly"],expected:{framework:"@storybook/preact-webpack5",renderer:"@storybook/preact",builder:"@storybook/builder-webpack5"}},"preact-webpack5/default-ts":{name:"Preact CLI (Default TS)",script:"npx preact-cli create typescript {{beforeDir}} --name preact-app --yarn --no-install",cadence:["daily","weekly"],expected:{framework:"@storybook/preact-webpack5",renderer:"@storybook/preact",builder:"@storybook/builder-webpack5"}}},ki={...si,...ii,...ci,...li,...pi,...mi,...gi,...ui,...yi,...fi,...di,...bi,...ai},xe=ki;var V=console,wi=e=>({title:xe[e].name,value:e}),Rr=async({output:e,filterValue:o,branch:t,init:r})=>{let n=Object.keys(xe),s=n.reduce((d,f)=>{let u=xe[f],h=new RegExp(o,"i");return(!o||u.name.match(h)||f.match(h)||u.expected.builder.match(h)||u.expected.framework.match(h)||u.expected.renderer.match(h))&&d.push(f),d},[]);s.length===0&&(V.info(xo(Po`
          🔎 You filtered out all templates. 🔍
          
          After filtering all the templates with "${W.yellow(o)}", we found no results. Please try again with a different filter.

          Available templates:
          ${n.map(d=>W.blue`- ${d}`).join(`
`)}
          `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),process.exit(1));let a=null;if(s.length===1?[a]=s:(V.info(xo(Po`
          🤗 Welcome to ${W.yellow("sb repro NEXT")}! 🤗 
  
          Create a ${W.green("new project")} to minimally reproduce Storybook issues.
          
          1. select an environment that most closely matches your project setup.
          2. select a location for the reproduction, outside of your project.
          
          After the reproduction is ready, we'll guide you through the next steps.
          `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),a=await vi(s)),!!!(a??null)){V.error("Somehow we got no templates. Please rerun this command!");return}let i=xe[a];if(!i)throw new Error("\u{1F6A8} Repro: please specify a valid template type");let l=e,m=e||a;if(l&&Tr(`${l}`)&&V.info(`\u26A0\uFE0F  ${l} already exists! Overwriting...`),!l){let{directory:d}=await jr({type:"text",message:"Enter the output directory",name:"directory",initial:m,validate:async f=>Tr(f)?`${f} already exists. Please choose another name.`:!0});l=d}try{let d=Cr.isAbsolute(l)?l:Cr.join(process.cwd(),l);V.info(`\u{1F3C3} Adding ${i.name} into ${d}`),V.log("\u{1F4E6} Downloading repro template...");try{await hi(`storybookjs/repro-templates-temp/${a}/${r?"after-storybook":"before-storybook"}#${t}`,{force:!0}).clone(d)}catch(u){throw V.error(`\u{1F6A8} Failed to download repro template: ${u.message}`),u}let f=r?W.yellow("yarn storybook"):`Recreate your setup, then ${W.yellow("run npx storybook init")}`;V.info(xo(Po`
        🎉 Your Storybook reproduction project is ready to use! 🎉

        ${W.yellow(`cd ${l}`)}
        ${f}

        Once you've recreated the problem you're experiencing, please:
        
        1. Document any additional steps in ${W.cyan("README.md")}
        2. Publish the repository to github
        3. Link to the repro repository in your issue

        Having a clean repro helps us solve your issue faster! 🙏
      `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"}))}catch(d){throw V.error("\u{1F6A8} Failed to create repro"),d}};async function vi(e){let{template:o}=await jr({type:"select",message:"\u{1F308} Select the template",name:"template",choices:e.map(wi)});return o||null}import Dr from"fs-extra";import Pe from"path";import{sync as xi}from"cross-spawn";import{logger as $}from"@storybook/node-logger";var Ar=async({target:e,local:o,start:t})=>{let r=process.cwd();try{if(JSON.parse(Dr.readFileSync("package.json","utf8")).name!=="@storybook/root")throw new Error}catch{throw new Error("Expected to run link from the root of the storybook monorepo")}let n=e,s=Pe.basename(e);if(!o){let c=Pe.join(r,"../storybook-repros");$.info(`Ensuring directory ${c}`),Dr.ensureDirSync(c),$.info(`Cloning ${e}`),await w(`git clone ${e}`,{cwd:c}),s=Pe.basename(e,Pe.extname(e)),n=Pe.join(c,s)}let a=xi("yarn",["--version"],{cwd:n,stdio:"pipe",shell:!0}).stdout.toString();if(!/^[23]\./.test(a)){$.warn(`\u{1F6A8} Expected yarn 2 or 3 in ${n}!`),$.warn(""),$.warn("Please set it up with `yarn set version berry`,"),$.warn(`then link '${n}' with the '--local' flag.`);return}$.info(`Linking ${n}`),await w(`yarn link --all ${r}`,{cwd:n}),$.info(`Installing ${s}`),await w("yarn install",{cwd:n}),$.info("Magic stuff related to @storybook/preset-create-react-app, we need to fix peerDependencies"),await w("yarn add -D webpack-hot-middleware",{cwd:n}),t&&($.info(`Running ${s} storybook`),await w("yarn run storybook",{cwd:n}))};import{dedent as Er}from"ts-dedent";import{sync as Pi}from"read-pkg-up";import{logger as Q,instance as Si}from"@storybook/node-logger";import{buildDevStandalone as Ci,withTelemetry as Ti}from"@storybook/core-server";import{cache as ji}from"@storybook/core-common";var Or=async e=>{"production"="production";try{let o={...e,configDir:e.configDir||"./.storybook",configType:"DEVELOPMENT",ignorePreview:!!e.previewUrl&&!e.forceBuildPreview,docsMode:!!e.docs,cache:ji,packageJson:Pi({cwd:__dirname}).packageJson};await Ti("dev",{presetOptions:o},()=>Ci(o))}catch(o){Si.heading="",o instanceof Error?o.error?Q.error(o.error):o.stats&&o.stats.compilation.errors?o.stats.compilation.errors.forEach(t=>Q.plain(t)):Q.error(o):o.compilation?.errors&&o.compilation.errors.forEach(t=>Q.plain(t)),Q.line(),Q.warn(o.close?Er`
          FATAL broken build!, will close the process,
          Fix the error below and restart storybook.
        `:Er`
          Broken build, fix the error above.
          You may need to refresh the browser.
        `),Q.line(),process.exit(1)}};import{sync as Ri}from"read-pkg-up";import{logger as Di}from"@storybook/node-logger";import{buildStaticStandalone as Ai,withTelemetry as Ei}from"@storybook/core-server";import{cache as Oi}from"@storybook/core-common";var Fr=async e=>{try{let o={...e,configDir:e.configDir||"./.storybook",outputDir:e.outputDir||"./storybook-static",ignorePreview:!!e.previewUrl&&!e.forceBuildPreview,docsMode:!!e.docs,configType:"PRODUCTION",cache:Oi,packageJson:Ri({cwd:__dirname}).packageJson};await Ei("build",{presetOptions:o},()=>Ai(o))}catch(o){Di.error(o),process.exit(1)}};function We(e){return e.split(",").map(o=>o.trim()).filter(o=>o.length>0)}function So(e,o){Object.keys(o).forEach(t=>{let r=o[t],n=p[r];n&&(e[t]=n)})}var Y=Ii({cwd:__dirname}).packageJson,ee=console;k.option("--disable-telemetry","disable sending telemetry data",p.STORYBOOK_DISABLE_TELEMETRY&&p.STORYBOOK_DISABLE_TELEMETRY!=="false");k.option("--enable-crash-reports","enable sending crash reports to telemetry data");k.command("init").description("Initialize Storybook into your project.").option("-f --force","Force add Storybook").option("-s --skip-install","Skip installing deps").option("--package-manager <npm|pnpm|yarn1|yarn2>","Force package manager for installing deps").option("-N --use-npm","Use npm to install deps (deprecated)").option("--use-pnp","Enable pnp mode for Yarn 2+").option("-p --parser <babel | babylon | flow | ts | tsx>","jscodeshift parser").option("-t --type <type>","Add Storybook for a specific project type").option("-y --yes","Answer yes to all prompts").option("-b --builder <webpack5 | vite>","Builder library").option("-l --linkable","Prepare installation for link (contributor helper)").action(e=>sr(e,Y).catch(o=>{_.error(o),process.exit(1)}));k.command("add <addon>").description("Add an addon to your Storybook").option("--package-manager <npm|pnpm|yarn1|yarn2>","Force package manager for installing dependencies").option("-N --use-npm","Use NPM to install dependencies (deprecated)").option("-s --skip-postinstall","Skip package specific postinstall config modifications").action((e,o)=>ir(e,o));k.command("babelrc").description("generate the default storybook babel config into your current working directory").action(()=>Je());k.command("upgrade").description("Upgrade your Storybook packages to the latest").option("--package-manager <npm|pnpm|yarn1|yarn2>","Force package manager for installing dependencies").option("-N --use-npm","Use NPM to install dependencies (deprecated)").option("-y --yes","Skip prompting the user").option("-n --dry-run","Only check for upgrades, do not install").option("-p --prerelease","Upgrade to the pre-release packages").option("-s --skip-check","Skip postinstall version and automigration checks").action(e=>br(e));k.command("info").description("Prints debugging information about the local environment").action(()=>{ee.log(Ye.bold(`
Environment Info:`)),$i.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Edge","Firefox","Safari"],npmPackages:"@storybook/*",npmGlobalPackages:"@storybook/*"}).then(ee.log)});k.command("migrate [migration]").description("Run a Storybook codemod migration on your source files").option("-l --list","List available migrations").option("-g --glob <glob>","Glob for files upon which to apply the migration","**/*.js").option("-p --parser <babel | babylon | flow | ts | tsx>","jscodeshift parser").option("-n --dry-run","Dry run: verify the migration exists and show the files to which it will be applied").option("-r --rename <from-to>",'Rename suffix of matching files after codemod has been applied, e.g. ".js:.ts"').action((e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,parser:a})=>{cr(e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,parser:a,logger:ee}).catch(c=>{_.error(c),process.exit(1)})});k.command("extract [location] [output]").description("extract stories.json from a built version").action((e="storybook-static",o=Fi.join(e,"stories.json"))=>ur(e,o).catch(t=>{_.error(t),process.exit(1)}));k.command("repro [outputDirectory]").description("Create a reproduction from a set of possible templates").option("-f --renderer <renderer>","Filter on given renderer").option("-t --template <template>","Use the given template").option("-l --list","List available templates").option("-g --generator <generator>","Use custom generator command").option("--registry <registry>","which registry to use for storybook packages").option("--pnp","Use Yarn Plug'n'Play mode instead of node_modules one").option("--local","use storybook's local packages instead of yarn's registry").option("--e2e","Used in e2e context").action((e,{renderer:o,template:t,list:r,e2e:n,generator:s,pnp:a,local:c})=>Sr({outputDirectory:e,renderer:o,template:t,list:r,e2e:n,local:c,generator:s,pnp:a}).catch(i=>{_.error(i),process.exit(1)}));k.command("repro-next [filterValue]").description("Create a reproduction from a set of possible templates").option("-o --output <outDir>","Define an output directory").option("-b --branch <branch>","Define the branch to degit from","next").option("--no-init","Whether to download a template without an initialized Storybook",!1).action((e,o)=>Rr({filterValue:e,...o}).catch(t=>{_.error(t),process.exit(1)}));k.command("link <repo-url-or-directory>").description("Pull down a repro from a URL (or a local directory), link it, and run storybook").option("--local","Link a local directory already in your file system").option("--no-start","Start the storybook",!0).action((e,{local:o,start:t})=>Ar({target:e,local:o,start:t}).catch(r=>{_.error(r),process.exit(1)}));k.command("automigrate [fixId]").description("Check storybook for known problems or migrations and apply fixes").option("-y --yes","Skip prompting the user").option("-n --dry-run","Only check for fixes, do not actually run them").option("--package-manager <npm|pnpm|yarn1|yarn2>","Force package manager").option("-N --use-npm","Use npm as package manager (deprecated)").action((e,o)=>le({fixId:e,...o}).catch(t=>{_.error(t),process.exit(1)}));k.command("dev").option("-p, --port <number>","Port to run Storybook",e=>parseInt(e,10)).option("-h, --host <string>","Host to run Storybook").option("-s, --static-dir <dir-names>","Directory where to load static files from",We).option("-c, --config-dir <dir-name>","Directory where to load Storybook configurations from").option("--https","Serve Storybook over HTTPS. Note: You must provide your own certificate information.").option("--ssl-ca <ca>","Provide an SSL certificate authority. (Optional with --https, required if using a self-signed certificate)",We).option("--ssl-cert <cert>","Provide an SSL certificate. (Required with --https)").option("--ssl-key <key>","Provide an SSL key. (Required with --https)").option("--smoke-test","Exit after successful start").option("--ci","CI mode (skip interactive prompts, don't open browser)").option("--no-open","Do not open Storybook automatically in the browser").option("--loglevel <level>","Control level of logging during build").option("--quiet","Suppress verbose build output").option("--no-version-updates","Suppress update check",!0).option("--no-release-notes","Suppress automatic redirects to the release notes after upgrading",!0).option("--no-manager-cache","Do not cache the manager UI").option("--debug-webpack","Display final webpack configurations for debugging purposes").option("--webpack-stats-json [directory]","Write Webpack Stats JSON to disk").option("--preview-url <string>","Disables the default storybook preview and lets your use your own").option("--force-build-preview","Build the preview iframe even if you are using --preview-url").option("--docs","Build a documentation-only site using addon-docs").action(e=>{_.setLevel(k.loglevel),ee.log(Ye.bold(`${Y.name} v${Y.version}`)+Ye.reset(`
`)),So(k,{port:"SBCONFIG_PORT",host:"SBCONFIG_HOSTNAME",staticDir:"SBCONFIG_STATIC_DIR",configDir:"SBCONFIG_CONFIG_DIR",ci:"CI"}),typeof k.port=="string"&&k.port.length>0&&(k.port=parseInt(k.port,10)),Or({...e,packageJson:Y})});k.command("build").option("-s, --static-dir <dir-names>","Directory where to load static files from",We).option("-o, --output-dir <dir-name>","Directory where to store built files").option("-c, --config-dir <dir-name>","Directory where to load Storybook configurations from").option("--quiet","Suppress verbose build output").option("--loglevel <level>","Control level of logging during build").option("--debug-webpack","Display final webpack configurations for debugging purposes").option("--webpack-stats-json [directory]","Write Webpack Stats JSON to disk").option("--preview-url <string>","Disables the default storybook preview and lets your use your own").option("--force-build-preview","Build the preview iframe even if you are using --preview-url").option("--docs","Build a documentation-only site using addon-docs").option("--no-manager-cache","Do not cache the manager UI").action(e=>{"production"="production",_.setLevel(k.loglevel),ee.log(Ye.bold(`${Y.name} v${Y.version}
`)),So(k,{staticDir:"SBCONFIG_STATIC_DIR",outputDir:"SBCONFIG_OUTPUT_DIR",configDir:"SBCONFIG_CONFIG_DIR"}),Fr({...e,packageJson:Y})});k.on("command:*",([e])=>{ee.error(` Invalid command: %s.
 See --help for a list of available commands.`,e);let t=k.commands.map(r=>r._name).find(r=>Ji(r,e)<3);t&&ee.info(`
 Did you mean ${t}?`),process.exit(1)});k.usage("<command> [options]").version(Y.version).parse(process.argv);
