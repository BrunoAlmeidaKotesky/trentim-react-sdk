import{a as E}from"./chunk-PN7NPRFU.mjs";import d,{useCallback as $,useEffect as L,useMemo as X,useState as y}from"react";import{HexColorPicker as I,HslaStringColorPicker as O,RgbaStringColorPicker as F}from"react-colorful";import u from"color-convert";import V from"lodash/throttle";import{styled as f}from"@storybook/theming";import{TooltipNote as z,WithTooltip as B,Form as W,Icons as M}from"@storybook/components";var N=f.div({position:"relative",maxWidth:250}),j=f(B)({position:"absolute",zIndex:1,top:4,left:4}),A=f.div({width:200,margin:5,".react-colorful__saturation":{borderRadius:"4px 4px 0 0"},".react-colorful__hue":{boxShadow:"inset 0 0 0 1px rgb(0 0 0 / 5%)"},".react-colorful__last-control":{borderRadius:"0 0 4px 4px"}}),q=f(z)(({theme:o})=>({fontFamily:o.typography.fonts.base})),D=f.div({display:"grid",gridTemplateColumns:"repeat(9, 16px)",gap:6,padding:3,marginTop:5,width:200}),J=f.div(({theme:o,active:t})=>({width:16,height:16,boxShadow:t?`${o.appBorderColor} 0 0 0 1px inset, ${o.textMutedColor}50 0 0 0 4px`:`${o.appBorderColor} 0 0 0 1px inset`,borderRadius:o.appBorderRadius})),K=`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,P=({value:o,active:t,onClick:e,style:r,...a})=>{let s=`linear-gradient(${o}, ${o}), ${K}, linear-gradient(#fff, #fff)`;return d.createElement(J,{...a,...{active:t,onClick:e},style:{...r,backgroundImage:s}})},Q=f(W.Input)(({theme:o})=>({width:"100%",paddingLeft:30,paddingRight:30,boxSizing:"border-box",fontFamily:o.typography.fonts.base})),U=f(M)(({theme:o})=>({position:"absolute",zIndex:1,top:6,right:7,width:20,height:20,padding:4,boxSizing:"border-box",cursor:"pointer",color:o.input.color})),G=(r=>(r.RGB="rgb",r.HSL="hsl",r.HEX="hex",r))(G||{}),m=Object.values(G),Y=/\(([0-9]+),\s*([0-9]+)%?,\s*([0-9]+)%?,?\s*([0-9.]+)?\)/,Z=/^\s*rgba?\(([0-9]+),\s*([0-9]+),\s*([0-9]+),?\s*([0-9.]+)?\)\s*$/i,oo=/^\s*hsla?\(([0-9]+),\s*([0-9]+)%,\s*([0-9]+)%,?\s*([0-9.]+)?\)\s*$/i,v=/^\s*#?([0-9a-f]{3}|[0-9a-f]{6})\s*$/i,to=/^\s*#?([0-9a-f]{3})\s*$/i,eo={["hex"]:I,["rgb"]:F,["hsl"]:O},x={["hex"]:"transparent",["rgb"]:"rgba(0, 0, 0, 0)",["hsl"]:"hsla(0, 0%, 0%, 0)"},H=o=>{let t=o?.match(Y);if(!t)return[0,0,0,1];let[,e,r,a,s=1]=t;return[e,r,a,s].map(Number)},S=o=>{if(!o)return;let t=!0;if(Z.test(o)){let[l,i,n,C]=H(o),[h,p,c]=u.rgb.hsl([l,i,n])||[0,0,0];return{valid:t,value:o,keyword:u.rgb.keyword([l,i,n]),colorSpace:"rgb",["rgb"]:o,["hsl"]:`hsla(${h}, ${p}%, ${c}%, ${C})`,["hex"]:`#${u.rgb.hex([l,i,n]).toLowerCase()}`}}if(oo.test(o)){let[l,i,n,C]=H(o),[h,p,c]=u.hsl.rgb([l,i,n])||[0,0,0];return{valid:t,value:o,keyword:u.hsl.keyword([l,i,n]),colorSpace:"hsl",["rgb"]:`rgba(${h}, ${p}, ${c}, ${C})`,["hsl"]:o,["hex"]:`#${u.hsl.hex([l,i,n]).toLowerCase()}`}}let e=o.replace("#",""),r=u.keyword.rgb(e)||u.hex.rgb(e),a=u.rgb.hsl(r),s=o;if(/[^#a-f0-9]/i.test(o)?s=e:v.test(o)&&(s=`#${e}`),s.startsWith("#"))t=v.test(s);else try{u.keyword.hex(s)}catch{t=!1}return{valid:t,value:s,keyword:u.rgb.keyword(r),colorSpace:"hex",["rgb"]:`rgba(${r[0]}, ${r[1]}, ${r[2]}, 1)`,["hsl"]:`hsla(${a[0]}, ${a[1]}%, ${a[2]}%, 1)`,["hex"]:s}},ro=(o,t,e)=>{if(!o||!t?.valid)return x[e];if(e!=="hex")return t?.[e]||x[e];if(!t.hex.startsWith("#"))try{return`#${u.keyword.hex(t.hex)}`}catch{return x.hex}let r=t.hex.match(to);if(!r)return v.test(t.hex)?t.hex:x.hex;let[a,s,l]=r[1].split("");return`#${a}${a}${s}${s}${l}${l}`},so=(o,t)=>{let[e,r]=y(o||""),[a,s]=y(()=>S(e)),[l,i]=y(a?.colorSpace||"hex");L(()=>{o===void 0&&(r(""),s(void 0),i("hex"))},[o]);let n=X(()=>ro(e,a,l).toLowerCase(),[e,a,l]),C=$(p=>{let c=S(p),b=c?.value||p||"";r(b),b===""&&(s(void 0),t(void 0)),c&&(s(c),i(c.colorSpace),t(c.value))},[t]),h=$(()=>{let p=m.indexOf(l)+1;p>=m.length&&(p=0),i(m[p]);let c=a?.[m[p]]||"";r(c),t(c)},[a,l,t]);return{value:e,realValue:n,updateValue:C,color:a,colorSpace:l,cycleColorSpace:h}},w=o=>o.replace(/\s*/,"").toLowerCase(),no=(o,t,e)=>{let[r,a]=y(t?.valid?[t]:[]);L(()=>{t===void 0&&a([])},[t]);let s=X(()=>(o||[]).map(n=>typeof n=="string"?S(n):n.title?{...S(n.color),keyword:n.title}:S(n.color)).concat(r).filter(Boolean).slice(-27),[o,r]),l=$(i=>{!i?.valid||s.some(n=>w(n[e])===w(i[e]))||a(n=>n.concat(i))},[e,s]);return{presets:s,addPreset:l}},ao=({name:o,value:t,onChange:e,onFocus:r,onBlur:a,presetColors:s,startOpen:l=!1})=>{let i=$(V(e,200),[e]),{value:n,realValue:C,updateValue:h,color:p,colorSpace:c,cycleColorSpace:b}=so(t,i),{presets:k,addPreset:T}=no(s,p,c),R=eo[c];return d.createElement(N,null,d.createElement(j,{trigger:"click",startOpen:l,closeOnClick:!0,onVisibilityChange:()=>T(p),tooltip:d.createElement(A,null,d.createElement(R,{color:C==="transparent"?"#000000":C,...{onChange:h,onFocus:r,onBlur:a}}),k.length>0&&d.createElement(D,null,k.map((g,_)=>d.createElement(B,{key:`${g.value}-${_}`,hasChrome:!1,tooltip:d.createElement(q,{note:g.keyword||g.value})},d.createElement(P,{value:g[c],active:p&&w(g[c])===w(p[c]),onClick:()=>h(g.value)})))))},d.createElement(P,{value:C,style:{margin:4}})),d.createElement(Q,{id:E(o),value:n,onChange:g=>h(g.target.value),onFocus:g=>g.target.select(),placeholder:"Choose color..."}),n?d.createElement(U,{icon:"markup",onClick:b}):null)},fo=ao;export{ao as ColorControl,fo as default};
