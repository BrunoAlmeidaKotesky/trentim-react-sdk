"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createViteServer = createViteServer;

var _vite = require("vite");

var _viteConfig = require("./vite-config");

var _optimizeDeps = require("./optimizeDeps");

async function createViteServer(options, devServer) {
  const {
    presets
  } = options;
  const commonCfg = await (0, _viteConfig.commonConfig)(options, 'development');
  const config = Object.assign({}, commonCfg, {
    // Set up dev server
    server: {
      middlewareMode: true,
      hmr: {
        port: options.port,
        server: devServer
      },
      fs: {
        strict: true
      }
    },
    appType: 'custom',
    optimizeDeps: await (0, _optimizeDeps.getOptimizeDeps)(commonCfg, options)
  });
  const finalConfig = await presets.apply('viteFinal', config, options);
  return (0, _vite.createServer)(finalConfig);
}